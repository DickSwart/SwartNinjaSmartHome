[{"id":"cae3de91.cc172","type":"tab","label":"House Mode","disabled":false,"info":""},{"id":"665eecf8.0e9db4","type":"tab","label":"Bathroom","disabled":false,"info":""},{"id":"67513eed.6b35b","type":"tab","label":"Hall","disabled":false,"info":""},{"id":"b715c3d5.53027","type":"tab","label":"Dining Room","disabled":false,"info":""},{"id":"9e300652.e09258","type":"tab","label":"Office","disabled":false,"info":""},{"id":"827aa7bb.e776e8","type":"tab","label":"Living room","disabled":false,"info":""},{"id":"7be81a90.d7d494","type":"tab","label":"Kitchen","disabled":false,"info":""},{"id":"7e73eced.d8a9cc","type":"tab","label":"Man cave","disabled":false,"info":"# Man cave\nControl man cave computer light"},{"id":"88e98901.be25b8","type":"tab","label":"Man Cave Kitchen","disabled":false,"info":""},{"id":"d1ecbf2b.eea86","type":"tab","label":"KR: Night Light","disabled":false,"info":"# Kids bedrooms\nAutomation for the kids rooms to turn on night light (Multisensor)."},{"id":"738f0112.d0a3e","type":"tab","label":"Electric Blankets","disabled":false,"info":"# Electric Blankets\nAll electric blankets sequinses"},{"id":"211f6eb6.d4fab2","type":"tab","label":"Scheduled routine","disabled":false,"info":"Kids routines\n- Bed and shower time"},{"id":"cf31d5a7.9b9f88","type":"tab","label":"Notifications","disabled":false,"info":""},{"id":"bf3a5eec.89f97","type":"tab","label":"Blue Iris","disabled":false,"info":""},{"id":"841dd090.abafb","type":"tab","label":"AI","disabled":false,"info":""},{"id":"69ac7f72.c2662","type":"tab","label":"Alarm","disabled":false,"info":""},{"id":"98513c22.80cb9","type":"tab","label":"iOS Events","disabled":false,"info":""},{"id":"84b86f62.4bafe","type":"tab","label":"Docker","disabled":false,"info":""},{"id":"1214089.774b8f7","type":"tab","label":"Fish Tank","disabled":true,"info":""},{"id":"4a7b0289.9d915c","type":"tab","label":"Home Study","disabled":true,"info":""},{"id":"fe0fe1f5.2651","type":"tab","label":"Examples","disabled":true,"info":""},{"id":"6159802b.d3238","type":"subflow","name":"Motion Lights","info":"","category":"","in":[{"x":65,"y":240,"wires":[{"id":"ff36d8a2.72aed8"}]}],"out":[{"x":1790,"y":225,"wires":[{"id":"38651f74.b423","port":0},{"id":"8591a5da.12c5d8","port":0},{"id":"5c32f34f.31682c","port":0}]}],"env":[{"name":"LIGHT","type":"str","value":"","ui":{"icon":"font-awesome/fa-lightbulb-o","label":{"en-US":"Light Entity"},"type":"input","opts":{"types":["str"]}}},{"name":"WAIT_TIME","type":"num","value":"3","ui":{"icon":"font-awesome/fa-clock-o","label":{"en-US":"Wait Time"},"type":"input","opts":{"types":["num"]}}},{"name":"IS_DIMM","type":"bool","value":"false","ui":{"icon":"font-awesome/fa-adjust","label":{"en-US":"Dim Light"},"type":"input","opts":{"types":["bool"]}}},{"name":"LUX_SENSOR","type":"str","value":"","ui":{"label":{"en-US":"Lux Sensor"},"type":"input","opts":{"types":["str"]}}},{"name":"LUX_VALUE","type":"num","value":"","ui":{"label":{"en-US":"Lux value"},"type":"input","opts":{"types":["num"]}}}],"color":"#FDF0C2","icon":"node-red/light.svg","status":{"x":355,"y":390,"wires":[{"id":"48ad9bf8.8f34c4","port":0}]}},{"id":"34adfc8d.987374","type":"subflow","name":"Hyperion Controller","info":"# Hyperion Controller\n\n**media player** - home assistant media player entity id.\n\n**lux sensor** - home assistant luminance sensor entity id.\n\n**lux value** - luminance threshold.\n","category":"","in":[],"out":[{"x":1025,"y":30,"wires":[{"id":"a653ed53.aea6","port":0}]},{"x":1025,"y":120,"wires":[{"id":"a653ed53.aea6","port":1}]}],"env":[{"name":"MEDIA_PLAYER","type":"str","value":"","ui":{"label":{"en-US":"media player"},"type":"input","opts":{"types":["str"]}}},{"name":"LUX_SENSOR","type":"str","value":"","ui":{"label":{"en-US":"lux sensor"},"type":"input","opts":{"types":["str"]}}},{"name":"LUX_VALUE","type":"num","value":"","ui":{"label":{"en-US":"lux value"},"type":"input","opts":{"types":["num"]}}}],"color":"#DDAA99","outputLabels":["on","off"]},{"id":"aabc4094.fa7ea","type":"group","z":"cae3de91.cc172","name":"Away Mode","style":{"stroke":"#ffC000","fill":"#ffcf3f","fill-opacity":"0.5","label":true,"color":"#000000"},"nodes":["72432883.58e2a8","c071a182.eccbd","b7a6a20b.713da","c1cbd36c.780a7","c86af17c.470b4","2fd2d44d.b8129c","e7cfbc01.0806","76d17d7e.221084","b169c641.3d3588","39dd6dfd.918cf2","e8b082c0.2029d","2c2163fb.6da72c","ddc6b832.d0afd8","e6d5e82e.7dc058","c032ebf6.8319c8","1c038676.ad2a4a","ae79e4e4.e35508","fcdd77c.600c188","7093c3a2.deadfc","be2a0583.2a33c8","468a3b11.20aa44","140045da.2c0dca","4eeea039.7b00c","b3c08824.11a828","857111e7.7f752","b2f54843.8d6288","b1e504c5.0faf28"],"x":34,"y":319,"w":1322,"h":682},{"id":"4a94f2a1.94235c","type":"group","z":"cae3de91.cc172","name":"Holiday Mode","style":{"stroke":"#0070c0","fill":"#3f93cf","fill-opacity":"0.5","label":true,"color":"#000000"},"nodes":["dd2fb304.6a841","5adf4e69.05a4c","8ef3ec12.77b13","8aff36be.1cfea8","755df0e3.2cf2e","142875d8.01700a","a330fd84.e75f1","56efb5c4.97dcac","4283856f.76ec1c","89a7b93c.0d5fa8","368763fc.0feccc","5f6547c1.2c1fe8","993777e2.1196f8","374d93e3.0833fc","9246aa78.e5ebe8","30c3292c.5fc0f6","35406b30.5631f4","5f5b84b6.522d6c","c69b3759.3b4078","de93f29.4596e1","59bb1526.3936bc","377216c7.08bbca","18557aee.204745","cd3b63c4.6af59","4472af1c.0323a","ed3b905c.6135d","91cf1c71.7b203","628b423d.9d554c","305ab587.0cca2a","bdbb1ddf.17cae","45583d92.2e4de4","d6ea405c.3b4ea","c173b40.3e06f5","a5da5a2.3709ca8","ea603bd8.6aec88","336c6ba7.6f9f84","5234af17.1ef31"],"x":34,"y":1039,"w":1152,"h":1252},{"id":"c406c797.04a108","type":"group","z":"fe0fe1f5.2651","name":"Global variables","style":{"fill":"#bfdbef","label":true,"color":"#000000"},"nodes":["bcc49512.6b0888","ae393bae.487188","f70489cb.fb57b8","a56185f9.12d4e8","7db2aac.7443d54","b9304c37.5c342","b4a5fc14.e8e5a","d4010fb3.5571d","336c6ea8.5dee52","8f2660d1.07be9","39ef9f0c.11af5","b237460a.4b8e28","25d2a95c.ee9886","f9d4d31.e235e3","421b96d1.66b398","ce06cd07.32599","2bba2950.22af16","eae0701e.ceec9","fa2e9476.ef2cc8"],"x":34,"y":3289},{"id":"48728dbf.fb4df4","type":"group","z":"cae3de91.cc172","name":"Guest Mode","style":{"stroke":"#92d04f","fill":"#92d04f","fill-opacity":"0.5","label":true,"color":"#000000"},"nodes":["63d1b472.a9adbc","bd68572f.15d698","df53440.54e1cc","130a79db.b26d66","93b2a52d.ed7c68"],"x":34,"y":2314,"w":962,"h":157},{"id":"4b19c391.e6820c","type":"group","z":"cae3de91.cc172","name":"Kids Sleep In Man Cave Mode","style":{"stroke":"#92d04f","fill":"#92d04f","fill-opacity":"0.5","label":true,"color":"#000000"},"nodes":["479d7dfd.72e714","d8d1d7a8.d20d48","63c583f9.af06ec","d97ec0c4.fc134","c26b3cf1.ddda"],"x":34,"y":2509,"w":962,"h":157},{"id":"d2144d44.18e","type":"server","name":"Home Assistant","addon":true},{"id":"48e140b0.c7063","type":"mqtt-broker","name":"Mosquitto","broker":"192.168.1.211","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"fc2a6602.88cb38","type":"light-scheduler-settings","name":"Home","latitude":"-41.168705","longitude":"174.818557"},{"id":"865bcfc2.91c85","type":"telegram bot","botname":"SN_NodeRedBot","usernames":"","chatids":"1082374373, -1001277388155","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":true},{"id":"36a05985.8f4f16","type":"server-state-changed","z":"7be81a90.d7d494","name":"Enter Kitchen","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Kitchen Lights"},{"property":"icon","value":"mdi:fridge"}],"entityidfilter":"binary_sensor.kitchen_multisensor_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":115,"y":90,"wires":[["5c635ae.df7aea4"],[]]},{"id":"5c635ae.df7aea4","type":"time-range-switch","z":"7be81a90.d7d494","name":"00:00 - nightEnd","lat":"-41.168701","lon":"174.818679","startTime":"00:00","endTime":"nightEnd","startOffset":0,"endOffset":0,"x":320,"y":90,"wires":[["ab11d716.1f1028"],["68f0ea11.fd39b4"]],"outputLabels":["true","false"]},{"id":"256db0ce.2f5de","type":"server-state-changed","z":"7be81a90.d7d494","name":"No Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":105,"y":240,"wires":[["22fac42f.bd95dc"],["22fac42f.bd95dc"]]},{"id":"c8618a17.7703a8","type":"server-state-changed","z":"7be81a90.d7d494","name":"Kitchen Ceiling Light","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.kitchen_ceiling","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":420,"wires":[["66323b5e.539954"],["5511f95e.506e18"]]},{"id":"66c2efb9.eed86","type":"server-state-changed","z":"d1ecbf2b.eea86","name":"Luminance < 30","server":"d2144d44.18e","version":1,"entityidfilter":"sensor.ampersand_multisensor_luminance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"30","halt_if_type":"num","halt_if_compare":"lt","outputs":2,"output_only_on_state_change":true,"x":110,"y":105,"wires":[["a4b92403.a57138"],["6ad7ef4e.c245c"]]},{"id":"31e92feb.50d2c8","type":"server-state-changed","z":"d1ecbf2b.eea86","name":"Luminance < 30","server":"d2144d44.18e","version":"1","entityidfilter":"sensor.bedroom_nico_multisensor_luminance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"30","halt_if_type":"num","halt_if_compare":"lt","outputs":2,"output_only_on_state_change":true,"x":110,"y":300,"wires":[["73c5ff4.cc079"],["f923fad8.f876f8"]]},{"id":"9cf7e42a.3bdee8","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":105,"y":240,"wires":[["f08f0b22.656b48"]]},{"id":"bda6dd4c.17efe","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":210,"wires":[]},{"id":"f08f0b22.656b48","type":"function","z":"fe0fe1f5.2651","name":"Random RGB Light Color Object","func":"// https://github.com/davidmerfield/randomColor\nvar randomColor = global.get('randomColor');// import the script\nvar color = randomColor({\n   format: 'rgb' // e.g. 'rgb(225,200,20)'\n});\n\nvar match = color.match(/rgba?\\((\\d{1,3}), ?(\\d{1,3}), ?(\\d{1,3})\\)?(?:, ?(\\d(?:\\.\\d+?))\\))?/);\n\nvar colorObject = match ? {\n  \"rgb_color\": [Number(match[1]),Number(match[2]),Number(match[3])]\n} : {};\n  \nnode.warn(color);\nmsg.payload = {\n    data:colorObject\n}\nreturn msg;","outputs":1,"noerr":0,"x":365,"y":240,"wires":[["bda6dd4c.17efe","911e91ec.5f5d08"]]},{"id":"911e91ec.5f5d08","type":"api-call-service","z":"fe0fe1f5.2651","name":"Turn On Multisensor light","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_on","entityId":"light.man_cave_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":270,"wires":[[]]},{"id":"bb8483c0.5c2128","type":"api-current-state","z":"738f0112.d0a3e","name":"Is school tomorrow?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.school_tomorrow","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":430,"y":435,"wires":[["c5116e59.335f8"],[]],"outputLabels":["true","false"]},{"id":"ed08d19c.b6622","type":"api-current-state","z":"738f0112.d0a3e","name":"Is cold: ON","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.is_cold","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":775,"y":285,"wires":[["60c6cfc8.e102c"],[]],"outputLabels":["true","false"]},{"id":"321fa1a9.96a59e","type":"server-state-changed","z":"738f0112.d0a3e","name":"Max: ON","server":"d2144d44.18e","version":"1","entityidfilter":"switch.bedroom_max_electric_blanket","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":105,"y":810,"wires":[["5ff8dc37.a5505c"],[]],"outputLabels":["true","false"]},{"id":"97f8b7db.3f4f6","type":"delay","z":"738f0112.d0a3e","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":670,"y":900,"wires":[["14839e38.ff4c0a"]]},{"id":"4220dd26.a1d1b4","type":"api-current-state","z":"738f0112.d0a3e","name":"Is cold: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.is_cold","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":490,"y":855,"wires":[["b859d91f.a21d"],["97f8b7db.3f4f6"]],"outputLabels":["true","false"]},{"id":"b859d91f.a21d","type":"delay","z":"738f0112.d0a3e","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":660,"y":810,"wires":[["14839e38.ff4c0a"]]},{"id":"f02caa71.2eb798","type":"server-state-changed","z":"738f0112.d0a3e","name":"Nico: ON","server":"d2144d44.18e","version":"1","entityidfilter":"switch.bedroom_nico_electric_blanket","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":105,"y":750,"wires":[["f8d861b.f2b3aa"],[]],"outputLabels":["true","false"]},{"id":"f8d861b.f2b3aa","type":"change","z":"738f0112.d0a3e","name":"Set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"entity_id\":\"switch.bedroom_nico_electric_blanket\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":750,"wires":[["4220dd26.a1d1b4"]]},{"id":"5ff8dc37.a5505c","type":"change","z":"738f0112.d0a3e","name":"Set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"entity_id\":\"switch.bedroom_max_electric_blanket\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":810,"wires":[["4220dd26.a1d1b4"]]},{"id":"644f579d.68c7d","type":"comment","z":"738f0112.d0a3e","name":"Electric blankets: OFF","info":"","x":115,"y":705,"wires":[]},{"id":"20760999.ce0fc6","type":"server-state-changed","z":"738f0112.d0a3e","name":"Dick: ON","server":"d2144d44.18e","version":"1","entityidfilter":"switch.bedroom_master_electric_blanket_dick","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":105,"y":950,"wires":[["7e6649b9.910818"],[]],"outputLabels":["true","false"]},{"id":"d415cfd6.c0bc78","type":"server-state-changed","z":"738f0112.d0a3e","name":"Tamara: ON","server":"d2144d44.18e","version":"1","entityidfilter":"switch.bedroom_master_electric_blanket_tamara","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":115,"y":890,"wires":[["407f9b74.96cf6c"],[]],"outputLabels":["true","false"]},{"id":"407f9b74.96cf6c","type":"change","z":"738f0112.d0a3e","name":"Set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"entity_id\":\"switch.bedroom_master_electric_blanket_tamara\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":890,"wires":[["4220dd26.a1d1b4"]]},{"id":"7e6649b9.910818","type":"change","z":"738f0112.d0a3e","name":"Set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"entity_id\":\"switch.bedroom_master_electric_blanket_dick\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":950,"wires":[["4220dd26.a1d1b4"]]},{"id":"8983eb9b.99905","type":"api-current-state","z":"738f0112.d0a3e","name":"Is work tomorrow?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.workday_tomorrow","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":420,"y":555,"wires":[["d27c0024.77211"],[]],"outputLabels":["true","false"]},{"id":"24ee2466.60fef4","type":"inject","z":"738f0112.d0a3e","name":"Master Bedroom: Week night at 20:30","props":[],"repeat":"","crontab":"30 20 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","x":205,"y":105,"wires":[["6f1f9da1.047694","ea5ad31.2e5e13"]]},{"id":"31f082f1.cd0f66","type":"link in","z":"738f0112.d0a3e","name":"Dick","links":["c09345b5.fb38d8","f4538451.f208b8"],"x":60,"y":555,"wires":[["44708934.1ebdf"]]},{"id":"44708934.1ebdf","type":"api-current-state","z":"738f0112.d0a3e","name":"Dick: Home","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.presence_location_dick","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":190,"y":555,"wires":[["8983eb9b.99905"],[]],"outputLabels":["true","false"]},{"id":"9b206fa0.4bf76","type":"comment","z":"738f0112.d0a3e","name":"Electric blankets: Event","info":"","x":115,"y":195,"wires":[]},{"id":"15d7be88.50bd91","type":"link in","z":"738f0112.d0a3e","name":"Tamara","links":["c09345b5.fb38d8","43bae0a9.e5649"],"x":60,"y":615,"wires":[["5c8e2b30.a6d4fc"]]},{"id":"5c8e2b30.a6d4fc","type":"api-current-state","z":"738f0112.d0a3e","name":"Tamara: Home","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.presence_location_tamara","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":200,"y":615,"wires":[["f515aa60.53f108"],[]],"outputLabels":["true","false"]},{"id":"14839e38.ff4c0a","type":"api-current-state","z":"738f0112.d0a3e","name":"Switch: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":865,"y":855,"wires":[["784ccefc.372a18"],[]],"outputLabels":["true","false"]},{"id":"784ccefc.372a18","type":"function","z":"738f0112.d0a3e","name":"Format msg","func":"const message = {};\nmessage.payload = {\n    data : {\n        entity_id : msg.data.entity_id\n    }\n}\nreturn message;","outputs":1,"noerr":0,"x":1045,"y":855,"wires":[["29cd8d10.107a0a"]]},{"id":"29cd8d10.107a0a","type":"api-call-service","z":"738f0112.d0a3e","name":"Switch: turn_off","server":"d2144d44.18e","version":1,"service_domain":"switch","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1235,"y":855,"wires":[[]]},{"id":"c5886636.488bd8","type":"comment","z":"d1ecbf2b.eea86","name":"Luminance: Max","info":"**Turn On: **If luminance drop below 30 and it is between dusk and the end of sun rise\n\n**Turn Off: **If luminance is equal or above 30\n","x":95,"y":45,"wires":[]},{"id":"c2face8a.b603b","type":"comment","z":"d1ecbf2b.eea86","name":"Sun Events","info":"**night: **Turn on both night lights\n\n**sunriseEnd: **Turn off both night lights\n","x":85,"y":425,"wires":[]},{"id":"f6684789.ea88b8","type":"inject","z":"cf31d5a7.9b9f88","name":"At 20:30:00","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":145,"y":90,"wires":[["42418ff3.fb63a"]]},{"id":"2d62c740.94fc98","type":"comment","z":"cf31d5a7.9b9f88","name":"Audio notifications off at night","info":"","x":150,"y":45,"wires":[]},{"id":"b0b30c9d.2a0a2","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Audio Notifications: OFF","server":"d2144d44.18e","version":"1","service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.notifications_audio","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":635,"y":90,"wires":[[]]},{"id":"42418ff3.fb63a","type":"api-current-state","z":"cf31d5a7.9b9f88","name":"Audio Notifications: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.notifications_audio","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":365,"y":90,"wires":[["b0b30c9d.2a0a2"],[]],"outputLabels":["true","false"]},{"id":"f5b0f011.c57dc","type":"inject","z":"cf31d5a7.9b9f88","name":"At 7:30:00","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":135,"y":195,"wires":[["b58ffda9.4d9bf"]]},{"id":"6b211e2.cc7e1e","type":"comment","z":"cf31d5a7.9b9f88","name":"Audio notifications on in the morning","info":"","x":170,"y":150,"wires":[]},{"id":"67bc492a.15e668","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Audio Notifications: ON","server":"d2144d44.18e","version":"1","service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.notifications_audio","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":635,"y":195,"wires":[[]]},{"id":"b58ffda9.4d9bf","type":"api-current-state","z":"cf31d5a7.9b9f88","name":"Audio Notifications: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.notifications_audio","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":365,"y":195,"wires":[[],["67bc492a.15e668"]],"outputLabels":["true","false"]},{"id":"98cc479f.b28738","type":"function","z":"211f6eb6.d4fab2","name":"What Time?","func":"const dateFns = global.get('dateFns');// import the script\n\nconst showerTimeMin = 30;\nconst showerTimeNotifyMin = 15;\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now,'d MMM, HH:mm:ss');\n\nif (!msg.kids_bedtime || msg.kids_bedtime == '00:00:00') {\n    node.status({fill:\"grey\",shape:\"dot\",text:\"no config\" + nodeStatus});\n    return [ null, null, null, null ];\n} else {\n    \n    const bedtime = dateFns.parse(msg.kids_bedtime, 'HH:mm:ss', new Date());\n    const showerTime = dateFns.subMinutes(bedtime, showerTimeMin);\n    const showerTimeNotify = dateFns.subMinutes(showerTime, showerTimeNotifyMin);\n    \n    const isBedTime = dateFns.isSameHour(now,bedtime) && dateFns.isSameMinute(now,bedtime);\n    const isShowerTime = dateFns.isSameHour(now,showerTime) && dateFns.isSameMinute(now,showerTime);\n    const isShowerTimeNotify = dateFns.isSameHour(now,showerTimeNotify) && dateFns.isSameMinute(now,showerTimeNotify);\n    \n    msg.payload = {\n        \"showerTimeMin\":showerTimeMin,\n        \"showerTimeNotifyMin\":showerTimeNotifyMin,\n        \"states\":{\n            \"bedTime\": dateFns.format(bedtime,'MM/dd/yyyy HH:mm:ss'),\n            \"showerTime\": dateFns.format(showerTime,'MM/dd/yyyy HH:mm:ss'),\n            \"showerTimeNotify\": dateFns.format(showerTimeNotify,'MM/dd/yyyy HH:mm:ss')\n        },\n    }\n    \n    if (isBedTime) {\n        node.status({fill:\"green\",shape:\"dot\",text:\"bed time\" + nodeStatus});\n        return [ msg, null, null, null ];\n    } else if (isShowerTime) {\n        node.status({fill:\"green\",shape:\"dot\",text:\"shower time\" + nodeStatus});\n        return [ null, msg, null, null ];\n    } else if (isShowerTimeNotify) {\n        node.status({fill:\"green\",shape:\"dot\",text:\"shower time notify\" + nodeStatus});\n        return [ null, null, msg, null ];\n    } else {\n       node.status({fill:\"green\",shape:\"dot\",text:\"other\" + nodeStatus});\n       return [ null, null, null, msg ];\n    }\n}","outputs":4,"noerr":0,"x":730,"y":135,"wires":[["979f3ce4.e502a"],["fea1ebbc.b66b98","697b0fcd.6615a"],["dc20726a.3cb8c"],[]],"outputLabels":["bed time","shower time","shower time notify","other"]},{"id":"dc20726a.3cb8c","type":"function","z":"211f6eb6.d4fab2","name":"Data","func":"/*\n * Speech Synthesis Markup Language (SSML) Reference\n * URL: https://developer.amazon.com/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html#speak\n */\n// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = { payload: \"\" };\nconst voices = [\n  // English, Australian (en-AU)\n  \"Nicole\", \"Russell\",\n  // English, British (en-GB)\n  \"Amy\", \"Brian\", \"Emma\",\n  // English, American (en-US)\n  \"Joanna\", \"Joey\", \"Justin\", \"Kendra\", \"Kimberly\", \"Matthew\", \"Salli\"\n];\n\nfunction getRandomText() {\n    const texts = [\n    \"15 minutes to shower time. Get ready!\",\n    \"Boys listen up. 15 minutes to shower time, start cleaning up!\",\n    \"Nico and Max, in 15 minutes it is shower time.\",\n    \"It's 15 minutes before shower time!\",\n    \"Nico and Max, shower time in 15 minutes.\"\n    ];\n    return texts[Math.floor(Math.random() * texts.length)]\n}\n\nfunction getMessage() {\n  const voice_name = voices[Math.floor(Math.random() * voices.length)];\n  const messages = [\n    \"<say-as interpret-as=\\\"interjection\\\">ahoy matey</say-as>,<voice name='\" + voice_name + \"'> \"+ getRandomText() +\"</voice>\",\n    \"<say-as interpret-as=\\\"interjection\\\">beep beep</say-as>,<voice name='\" + voice_name + \"'> \"+ getRandomText() +\"</voice>\",\n    \"<say-as interpret-as=\\\"interjection\\\">cock a doodle doo</say-as>. <voice name='\" + voice_name + \"'>\"+ getRandomText() +\"</voice>\",\n    \"<say-as interpret-as=\\\"interjection\\\">heads up</say-as><voice name='\" + voice_name + \"'>it's 15 minutes before shower time!</voice>\",\n    \"<voice name='\" + voice_name + \"'>\"+ getRandomText() +\"</voice> <say-as interpret-as=\\\"interjection\\\">tick tock</say-as> are you ready?\"\n  ];\n  return messages[Math.floor(Math.random() * messages.length)]\n}\n\nmessage.alexa = {\n  message: \"<prosody volume=\\\"x-loud\\\">\" + getMessage() + \"</prosody>\",\n  data: { \"type\": \"announce\", \"method\": \"speak\" },\n  target:[\"media_player.living_room_alexa_tv\", \"media_player.man_cave_echo_dot\"]\n}\nmessage.notify = {\n    title: \"Shower Time\",\n    message: getRandomText()\n}\nnode.status({ fill: \"green\", shape: \"dot\", text: \"OK\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":920,"y":225,"wires":[["57852a4e.9b49c4"]]},{"id":"25497a88.86b656","type":"api-call-service","z":"fe0fe1f5.2651","name":"Alexa: Man cave","server":"d2144d44.18e","version":"1","service_domain":"notify","service":"alexa_media_man_cave_echo_dot","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":710,"y":90,"wires":[[]]},{"id":"349f32f9.6938fe","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":105,"y":90,"wires":[["cd15669c.3e1338"]]},{"id":"41ba50.554ff5b","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":680,"y":45,"wires":[]},{"id":"cd15669c.3e1338","type":"function","z":"fe0fe1f5.2651","name":"Set Message","func":"const messages = [\n    \"15 minutes to shower time. Get ready!\",\n    \"Boys listen up. 15 minutes to shower time, start cleaning up!\",\n    \"Nico and Max, in 15 minutes it is shower time.\",\n    \"It's 15 minutes before shower time!\" ,\n    \"Nico and Max, shower time in 15 minutes. Are you ready?\"\n];\n\nmsg.payload = {\n    message: messages[Math.floor(Math.random() * messages.length)],\n    intro: true,\n    voice: 'random'\n}\nreturn msg;","outputs":1,"noerr":0,"x":295,"y":90,"wires":[["8a0c1c7d.3545"]]},{"id":"8a0c1c7d.3545","type":"function","z":"fe0fe1f5.2651","name":"Data","func":"\n//msg.payload = {\n//    message: messages[Math.floor(Math.random() * messages.length)],\n//    intro: true,\n//    voice: 'random'\n//}\n\nfunction getIntro(intro){\n    const payload = msg.payload;\n    const intros = [\n        \"ahoy matey\",\n        \"beep beep\",\n        \"cock a doodle doo\",\n        \"heads up\" ,\n        \"tick tock\"\n    ];\n    let message = null;\n    \n    if (!intro) {\n        return null;\n    }\n    \n    return \"<say-as interpret-as=\\\"interjection\\\">\" + intros[Math.floor(Math.random() * intros.length)] + \"</say-as>.\";\n}\n\nfunction getVoice(voice_name, message){\n    /*\n     * Speech Synthesis Markup Language (SSML) Reference\n     * URL: https://developer.amazon.com/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html#speak\n     */\n    const voices = [\n        // English, Australian (en-AU)\n        \"Nicole\", \"Russell\",\n        // English, British (en-GB)\n        \"Amy\", \"Brian\", \"Emma\",\n        // German (de-DE)\n        \"Hans\", \"Marlene\", \"Vicki\",\n        // Spanish, Castilian (es-ES):\n        \"Conchita\", \"Enrique\",\n        // English, American (en-US)\n        \"Joanna\", \"Joey\", \"Justin\",\"Kendra\", \"Kimberly\", \"Matthew\", \"Salli\"\n    ];\n    \n    if (!voice_name) {\n        return message;\n    }\n    \n    if (voice_name === 'random'){\n        voice_name = voices[Math.floor(Math.random() * voices.length)]\n    }\n    \n    return \"<voice name='\" + voice_name + \"'>\" + message + \"</voice>\"\n}\n\n\nfunction getMessage() {\n    const payload = msg.payload;\n    return getIntro(payload.intro) + getVoice(payload.voice,payload.message)\n}\n\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"<prosody volume=\\\"x-loud\\\">\" + getMessage() + \"</prosody>\",\n    \"data\":{\"type\":\"announce\", \"method\":\"speak\"},\n\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":485,"y":90,"wires":[["41ba50.554ff5b","25497a88.86b656"]]},{"id":"eed155ed.f41018","type":"server-state-changed","z":"211f6eb6.d4fab2","name":"Time","server":"d2144d44.18e","version":1,"entityidfilter":"sensor.time","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":95,"y":135,"wires":[["c0a14e3c.4b44"]]},{"id":"9edc60d2.8d105","type":"comment","z":"665eecf8.0e9db4","name":"Motion","info":"","x":65,"y":30,"wires":[]},{"id":"3e7c6fbc.ee7ef","type":"comment","z":"7be81a90.d7d494","name":"Motion","info":"","x":65,"y":30,"wires":[]},{"id":"dae7d97d.5009c8","type":"comment","z":"7be81a90.d7d494","name":"Cupboard LED's","info":"","x":95,"y":360,"wires":[]},{"id":"dc5c6798.4ef858","type":"comment","z":"211f6eb6.d4fab2","name":"Shower Time","info":"","x":85,"y":510,"wires":[]},{"id":"b864fbdc.11c028","type":"comment","z":"211f6eb6.d4fab2","name":"Bed Time","info":"","x":75,"y":1020,"wires":[]},{"id":"ff66a64e.057da8","type":"comment","z":"fe0fe1f5.2651","name":"Motion Example","info":"","x":95,"y":525,"wires":[]},{"id":"6fe7c46c.60335c","type":"inject","z":"fe0fe1f5.2651","name":"Motion: OFF","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"False","payload":"false","payloadType":"bool","x":115,"y":630,"wires":[["829fea57.82fc38"]]},{"id":"fbbcdffc.e15a5","type":"inject","z":"fe0fe1f5.2651","name":"Motion: ON","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"True","payload":"true","payloadType":"bool","x":115,"y":585,"wires":[["829fea57.82fc38","19e27878.5f6c88"]]},{"id":"40a19715.633d78","type":"inject","z":"fe0fe1f5.2651","name":"Reset","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"reset","payloadType":"str","x":95,"y":675,"wires":[["f95e6ead.a3cb1"]]},{"id":"829fea57.82fc38","type":"trigger","z":"fe0fe1f5.2651","name":"trigger (2min)","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"2","extend":true,"units":"min","reset":"true","bytopic":"all","outputs":1,"x":535,"y":645,"wires":[["618df3b.c3e860c"]]},{"id":"19e27878.5f6c88","type":"debug","z":"fe0fe1f5.2651","name":"Turn: ON","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":525,"y":585,"wires":[]},{"id":"618df3b.c3e860c","type":"debug","z":"fe0fe1f5.2651","name":"Turn: OFF","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":645,"wires":[]},{"id":"f95e6ead.a3cb1","type":"change","z":"fe0fe1f5.2651","name":"Reset Timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":265,"y":675,"wires":[["829fea57.82fc38"]]},{"id":"1ebb7887.e01bc7","type":"server-state-changed","z":"67513eed.6b35b","name":"Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Hall Lights"},{"property":"icon","value":"mdi:highway"}],"entityidfilter":"binary_sensor.hall_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":75,"wires":[["bfe0019f.015b4"],["bfe0019f.015b4"]]},{"id":"aae62aa7.36b7d8","type":"api-current-state","z":"fe0fe1f5.2651","name":"sun","server":"d2144d44.18e","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sun.sun","state_type":"str","state_location":"state","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":275,"y":870,"wires":[["15b176da.1f9279"]]},{"id":"31d28734.49cd98","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":105,"y":825,"wires":[["aae62aa7.36b7d8"]]},{"id":"1a73aa18.920856","type":"comment","z":"fe0fe1f5.2651","name":"Example: Write to csv file","info":"","x":125,"y":765,"wires":[]},{"id":"77cddac4.b7fef4","type":"server-state-changed","z":"fe0fe1f5.2651","name":"is dark","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.dark_outside","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":95,"y":915,"wires":[["aae62aa7.36b7d8"]]},{"id":"2cb327d6.58ae78","type":"server-state-changed","z":"827aa7bb.e776e8","name":"Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Living Room Lights"},{"property":"icon","value":"mdi:sofa"}],"entityidfilter":"binary_sensor.living_room_motion","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":75,"wires":[["f81b0a19.8c6d38"],["f81b0a19.8c6d38"]]},{"id":"a66bd434.8a4fd8","type":"comment","z":"827aa7bb.e776e8","name":"Motion","info":"","x":65,"y":30,"wires":[]},{"id":"20e0e5a1.91d79a","type":"server-state-changed","z":"827aa7bb.e776e8","name":"Luminance > 70","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.living_room_multisensor_luminance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"70","halt_if_type":"num","halt_if_compare":"gte","outputs":2,"output_only_on_state_change":true,"x":125,"y":315,"wires":[["81c0eebe.ece3a"],[]]},{"id":"7078f3c6.40314c","type":"comment","z":"827aa7bb.e776e8","name":"Luminance","info":"","x":75,"y":270,"wires":[]},{"id":"b5433348.063e8","type":"server-state-changed","z":"665eecf8.0e9db4","name":"Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Bathroom Lights"},{"property":"icon","value":"mdi:shower"}],"entityidfilter":"binary_sensor.bathroom_multisensor_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":75,"wires":[["b51a38dd.109e88"],["b51a38dd.109e88"]]},{"id":"73ad32a1.ac85dc","type":"comment","z":"67513eed.6b35b","name":"Motion","info":"","x":65,"y":30,"wires":[]},{"id":"ce885ffa.d2ef8","type":"comment","z":"fe0fe1f5.2651","name":"Alexa Announce Example","info":"","x":125,"y":30,"wires":[]},{"id":"5e5eda4f.960924","type":"delay","z":"211f6eb6.d4fab2","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":750,"wires":[["3b383cc3.2397e4"]]},{"id":"d79f0b63.605418","type":"change","z":"fe0fe1f5.2651","name":"Set Log Payload","rules":[{"t":"set","p":"logData.sunEvent","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"logData.elevation","pt":"msg","to":"data.attributes.elevation","tot":"msg"},{"t":"set","p":"fileName","pt":"msg","to":"sun_events","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":870,"wires":[["f523b6e6.16ed78"]]},{"id":"15b176da.1f9279","type":"switch","z":"fe0fe1f5.2651","name":"","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"msg.payload in [\"goldenHourEnd\", \"solarNoon\", \"goldenHour\", \"nadir\"]","vt":"jsonata"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":425,"y":870,"wires":[[],["d79f0b63.605418"]]},{"id":"5e47ac49.70fd64","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn bathroom light: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.bathroom_zw111_nano_dimmer","data":"{\"brightness\":255}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":980,"y":555,"wires":[[]]},{"id":"18a0b59c.dd8d7a","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn hall light: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.hall_zw111_nano_dimmer","data":"{\"brightness\":255}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":960,"y":615,"wires":[[]]},{"id":"3b383cc3.2397e4","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn bathroom fan: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"fan.bathroom","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":535,"y":750,"wires":[[]]},{"id":"81851c64.49dcb","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Bathroom fan: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"fan.bathroom","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":360,"y":1245,"wires":[["6107416d.c9074"],[]]},{"id":"6107416d.c9074","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn bathroom fan: OFF","server":"d2144d44.18e","version":"1","service_domain":"switch","service":"turn_off","entityId":"fan.bathroom","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":635,"y":1245,"wires":[[]]},{"id":"ca22ae55.46b8f","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Max night light: OFF?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.ampersand_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":370,"y":1125,"wires":[["141bdd21.5b0353"],[]],"outputLabels":["false","true"]},{"id":"141bdd21.5b0353","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn Max night light: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ampersand_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":635,"y":1125,"wires":[[]]},{"id":"83c81ebc.5e3d8","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Nico night light: OFF?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_nico_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":370,"y":1185,"wires":[["f20e63a8.376a4"],[]],"outputLabels":["false","true"]},{"id":"a5d2d264.5ce19","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn Nico night light: ON","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_on","entityId":"light.bedroom_nico_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":890,"y":1185,"wires":[[]]},{"id":"f20e63a8.376a4","type":"function","z":"211f6eb6.d4fab2","name":"Random Color","func":"var randomColor = global.get('randomColor');// import the script\nvar color = randomColor({\n   format: 'rgb'\n});\n\nvar match = color.match(/rgba?\\((\\d{1,3}), ?(\\d{1,3}), ?(\\d{1,3})\\)?(?:, ?(\\d(?:\\.\\d+?))\\))?/);\n\nvar colorObject = match ? {\n  \"rgb_color\": [Number(match[1]),Number(match[2]),Number(match[3])]\n} : {};\n  \n\nmsg.payload = {\n    data:colorObject\n}\nreturn msg;","outputs":1,"noerr":0,"x":605,"y":1185,"wires":[["a5d2d264.5ce19"]]},{"id":"e02750fc.9452","type":"api-current-state","z":"7be81a90.d7d494","name":"Side light: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.kitchen_side","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":770,"y":60,"wires":[["c1d38626.d5df18"],[]],"outputLabels":["false","true"]},{"id":"c1d38626.d5df18","type":"api-call-service","z":"7be81a90.d7d494","name":"Turn: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.kitchen_side","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":990,"y":60,"wires":[[]]},{"id":"ab11d716.1f1028","type":"api-current-state","z":"7be81a90.d7d494","name":"Luminance <= 40","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"40","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"sensor.kitchen_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":555,"y":60,"wires":[["e02750fc.9452"],[]],"outputLabels":["true","false"]},{"id":"de5d766c.28f2b8","type":"api-current-state","z":"7be81a90.d7d494","name":"Main light: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.kitchen_ceiling","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":770,"y":120,"wires":[["be1eb927.0657c8"],[]]},{"id":"be1eb927.0657c8","type":"api-call-service","z":"7be81a90.d7d494","name":"Turn: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.kitchen_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":990,"y":120,"wires":[[]]},{"id":"68f0ea11.fd39b4","type":"api-current-state","z":"7be81a90.d7d494","name":"Luminance <= 40","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"40","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"sensor.kitchen_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":555,"y":120,"wires":[["de5d766c.28f2b8"],[]],"outputLabels":["true","false"]},{"id":"291cb5d4.e438fa","type":"api-current-state","z":"7be81a90.d7d494","name":"Main light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.kitchen_ceiling","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":785,"y":270,"wires":[["3536f1fa.a798fe"],[]]},{"id":"e0c44706.a3c4a8","type":"api-current-state","z":"7be81a90.d7d494","name":"Side light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.kitchen_side","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":785,"y":210,"wires":[["6141236a.06bd9c"],[]],"outputLabels":["false","true"]},{"id":"3536f1fa.a798fe","type":"api-call-service","z":"7be81a90.d7d494","name":"Turn: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.kitchen_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1005,"y":270,"wires":[[]]},{"id":"6141236a.06bd9c","type":"api-call-service","z":"7be81a90.d7d494","name":"Turn: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.kitchen_side","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1005,"y":210,"wires":[[]]},{"id":"b2544587.73bc18","type":"api-current-state","z":"7be81a90.d7d494","name":"Cupboard light: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.kitchen_cupboard","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":880,"y":420,"wires":[["afc609af.8aa4d8"],[]],"outputLabels":["false","true"]},{"id":"afc609af.8aa4d8","type":"api-call-service","z":"7be81a90.d7d494","name":"Cupboard light: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.kitchen_cupboard","data":"{\"brightness\":127,\"transition\":5}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1125,"y":420,"wires":[[]]},{"id":"5511f95e.506e18","type":"api-current-state","z":"7be81a90.d7d494","name":"Cupboard light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.kitchen_cupboard","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":645,"y":495,"wires":[["9560fedf.3ee4a"],[]],"outputLabels":["false","true"]},{"id":"9560fedf.3ee4a","type":"api-call-service","z":"7be81a90.d7d494","name":"Cupboard light: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.kitchen_cupboard","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":880,"y":495,"wires":[[]]},{"id":"b42deaba.b44938","type":"api-call-service","z":"827aa7bb.e776e8","name":"Turn: OFF","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_off","entityId":"light.living_room_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":805,"y":315,"wires":[[]]},{"id":"c61406bf.327118","type":"api-current-state","z":"827aa7bb.e776e8","name":"Lights: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.living_room_ceiling","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":620,"y":315,"wires":[["b42deaba.b44938"],[]]},{"id":"6ad7ef4e.c245c","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Max light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.ampersand_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":320,"y":135,"wires":[["ff8c9278.48e54"],[]]},{"id":"ff8c9278.48e54","type":"api-call-service","z":"d1ecbf2b.eea86","name":"Turn: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ampersand_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":540,"y":135,"wires":[[]]},{"id":"f923fad8.f876f8","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Nico light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_nico_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":320,"y":330,"wires":[["afcb9353.1a25a"],[]]},{"id":"afcb9353.1a25a","type":"api-call-service","z":"d1ecbf2b.eea86","name":"Turn: OFF","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_off","entityId":"light.bedroom_nico_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":540,"y":330,"wires":[[]]},{"id":"2208647.076479c","type":"api-render-template","z":"211f6eb6.d4fab2","name":"Get Kids Bedtime","server":"d2144d44.18e","template":"{% if is_state('binary_sensor.school_tomorrow','on') %}\n    {{ states('input_datetime.kids_bedtime_school_nights') }}\n{% else %}\n    {{ states('input_datetime.kids_bedtime_other_nights') }}\n{% endif %}","resultsLocation":"kids_bedtime","resultsLocationType":"msg","templateLocation":"","templateLocationType":"none","x":525,"y":135,"wires":[["98cc479f.b28738"]]},{"id":"6dc846ad.d43768","type":"function","z":"d1ecbf2b.eea86","name":"Is after bedtime?","func":"const dateFns = global.get('dateFns');// import the script\n\nconst message = {};\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now,'d MMM, HH:mm:ss');\n\n// If no bedtime set, use a default of 9pm\nif (!msg.kids_bedtime || msg.kids_bedtime == '00:00:00') {\n    msg.kids_bedtime = \"21:00:00\";\n}\n\nconst bedtime = dateFns.parse(msg.kids_bedtime, 'HH:mm:ss', new Date());\nconst lightsOnTime = dateFns.subMinutes(bedtime, 15);\n\n\nif (dateFns.isAfter(now, lightsOnTime)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"true\" + nodeStatus});\n    message.payload = true;\n    return message;\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"false\" + nodeStatus});\n    return null;\n}","outputs":1,"noerr":0,"x":570,"y":75,"wires":[["30822f9d.ad52"]],"outputLabels":["bed time"]},{"id":"a4b92403.a57138","type":"api-render-template","z":"d1ecbf2b.eea86","name":"Get Kids Bedtime","server":"d2144d44.18e","template":"{% if is_state('binary_sensor.school_tomorrow','on') %}\n    {{ states('input_datetime.kids_bedtime_school_nights') }}\n{% else %}\n    {{ states('input_datetime.kids_bedtime_other_nights') }}\n{% endif %}","resultsLocation":"kids_bedtime","resultsLocationType":"msg","templateLocation":"","templateLocationType":"none","x":330,"y":75,"wires":[["6dc846ad.d43768"]]},{"id":"9056f6bc.805a98","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Max light: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.ampersand_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1070,"y":75,"wires":[["f7a7cd78.517a1"],[]],"outputLabels":["false","true"]},{"id":"f7a7cd78.517a1","type":"api-call-service","z":"d1ecbf2b.eea86","name":"Turn: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ampersand_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1260,"y":75,"wires":[[]]},{"id":"1347d992.76b1e6","type":"function","z":"d1ecbf2b.eea86","name":"Is after bedtime?","func":"const dateFns = global.get('dateFns');// import the script\n\nconst message = {};\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now,'d MMM, HH:mm:ss');\n\n// If no bedtime set, use a default of 9pm\nif (!msg.kids_bedtime || msg.kids_bedtime == '00:00:00') {\n    msg.kids_bedtime = \"21:00:00\";\n}\n\nconst bedtime = dateFns.parse(msg.kids_bedtime, 'HH:mm:ss', new Date());\nconst lightsOnTime = dateFns.subMinutes(bedtime, 15);\n\n\nif (dateFns.isAfter(now, lightsOnTime)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"true\" + nodeStatus});\n    message.payload = true;\n    return message;\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"false\" + nodeStatus});\n    return null;\n}","outputs":1,"noerr":0,"x":570,"y":270,"wires":[["1d2ed638.df077a"]],"outputLabels":["bed time"]},{"id":"73c5ff4.cc079","type":"api-render-template","z":"d1ecbf2b.eea86","name":"Get Kids Bedtime","server":"d2144d44.18e","template":"{% if is_state('binary_sensor.school_tomorrow','on') %}\n    {{ states('input_datetime.kids_bedtime_school_nights') }}\n{% else %}\n    {{ states('input_datetime.kids_bedtime_other_nights') }}\n{% endif %}","resultsLocation":"kids_bedtime","resultsLocationType":"msg","templateLocation":"","templateLocationType":"none","x":330,"y":270,"wires":[["1347d992.76b1e6"]]},{"id":"a6e20041.02c1c","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Nico light: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_nico_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1070,"y":270,"wires":[["d6cb0561.48c0e8"],[]],"outputLabels":["false","true"]},{"id":"c0a6f3cf.dbb38","type":"api-call-service","z":"d1ecbf2b.eea86","name":"Turn: ON","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_on","entityId":"light.bedroom_nico_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1440,"y":270,"wires":[[]]},{"id":"d6cb0561.48c0e8","type":"function","z":"d1ecbf2b.eea86","name":"Random Color","func":"var randomColor = global.get('randomColor');// import the script\nconst dateFns = global.get('dateFns');// import the script\n\nconst message = {};\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now,'d MMM, HH:mm:ss');\n\nvar color = randomColor({\n   format: 'rgb'\n});\n\nvar match = color.match(/rgba?\\((\\d{1,3}), ?(\\d{1,3}), ?(\\d{1,3})\\)?(?:, ?(\\d(?:\\.\\d+?))\\))?/);\n\nvar colorObject = match ? {\n  \"rgb_color\": [Number(match[1]),Number(match[2]),Number(match[3])]\n} : {};\n  \n\nmessage.payload = {\n    data:colorObject\n}\nnode.status({fill:\"green\",shape:\"dot\",text:colorObject.rgb_color + nodeStatus});\nreturn message;","outputs":1,"noerr":0,"x":1265,"y":270,"wires":[["c0a6f3cf.dbb38"]]},{"id":"6dc47203.07dd4c","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Max light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.ampersand_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":305,"y":450,"wires":[["8a213eba.ff9e1"],[]]},{"id":"8a213eba.ff9e1","type":"api-call-service","z":"d1ecbf2b.eea86","name":"Turn: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ampersand_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":495,"y":450,"wires":[[]]},{"id":"db8dcf.7c89b23","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Nico light: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_nico_multisensor","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":305,"y":510,"wires":[["e34028d3.927d88"],[]]},{"id":"e34028d3.927d88","type":"api-call-service","z":"d1ecbf2b.eea86","name":"Turn: OFF","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_off","entityId":"light.bedroom_nico_multisensor","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":495,"y":510,"wires":[[]]},{"id":"2a6e1a0f.67bca6","type":"comment","z":"d1ecbf2b.eea86","name":"Luminance: Nico","info":"**Turn On: **If luminance drop below 30 and it is between dusk and the end of sun rise\n\n**Turn Off: **If luminance is equal or above 30\n","x":95,"y":240,"wires":[]},{"id":"d636c5e7.957548","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":105,"y":375,"wires":[["6c197343.bb159c","f6f4d636.df7b88"]]},{"id":"f6f4d636.df7b88","type":"delay","z":"fe0fe1f5.2651","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":135,"y":450,"wires":[["3b7e5438.3d311c"]]},{"id":"3b7e5438.3d311c","type":"change","z":"fe0fe1f5.2651","name":"","rules":[{"t":"set","p":"paths[\"other_path\"]","pt":"msg","to":"{\"pepe\":\"true\",\"camino\":\"2\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":450,"wires":[["8f6215b0.7ad0b8"]]},{"id":"6c197343.bb159c","type":"change","z":"fe0fe1f5.2651","name":"","rules":[{"t":"set","p":"paths[\"path_1\"]","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":375,"wires":[["8f6215b0.7ad0b8"]]},{"id":"8f6215b0.7ad0b8","type":"wait-paths","z":"fe0fe1f5.2651","name":"","paths":"[\"path_1\",\"other_path\"]","timeout":"15000","finalTimeout":"60000","x":580,"y":405,"wires":[["d3f98061.31349"]]},{"id":"d3f98061.31349","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"console":"false","complete":"true","x":740,"y":405,"wires":[]},{"id":"a6f8119d.159c8","type":"comment","z":"fe0fe1f5.2651","name":"Paths Example","info":"","x":95,"y":315,"wires":[]},{"id":"f6d9dc7e.5f34c","type":"comment","z":"fe0fe1f5.2651","name":"Random RGB Colour Example","info":"","x":145,"y":195,"wires":[]},{"id":"9f11d5c1.27d0d8","type":"api-current-state","z":"7e73eced.d8a9cc","name":"luminance < 80","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"80","halt_if_type":"num","halt_if_compare":"lt","override_topic":false,"entity_id":"sensor.man_cave_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":305,"y":90,"wires":[["3364055f.a46c2a"],[]],"outputLabels":["Yes","No"]},{"id":"d1a2e2e.904d42","type":"change","z":"7e73eced.d8a9cc","name":"Stop Timer","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":225,"wires":[["86d7c79e.bb4ee8"]]},{"id":"6d9581c9.27c7a","type":"link in","z":"7e73eced.d8a9cc","name":"Stop Main light timer","links":["5233e848.bb2788"],"x":210,"y":270,"wires":[["d1a2e2e.904d42"]]},{"id":"5a72e269.e29d3c","type":"comment","z":"7e73eced.d8a9cc","name":"Man cave: Main Light Motion Flow","info":"","x":155,"y":30,"wires":[]},{"id":"d84720d3.6a4c3","type":"comment","z":"7e73eced.d8a9cc","name":"Man cave ceiling light off","info":"","x":125,"y":375,"wires":[]},{"id":"b3541089.da682","type":"adv ping","z":"7e73eced.d8a9cc","name":"Ping TV","host":"192.168.20.210","x":720,"y":150,"wires":[["c5616e52.58e37"]]},{"id":"c5616e52.58e37","type":"switch","z":"7e73eced.d8a9cc","name":"TV: OFF?","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"istype","v":"number","vt":"number"}],"checkall":"false","repair":false,"outputs":2,"x":890,"y":150,"wires":[["d9a0d69e.0a9598"],["5233e848.bb2788"]],"outputLabels":["true","false"]},{"id":"5233e848.bb2788","type":"link out","z":"7e73eced.d8a9cc","name":"TV is on","links":["6d9581c9.27c7a"],"x":1005,"y":180,"wires":[]},{"id":"d9a0d69e.0a9598","type":"api-call-service","z":"7e73eced.d8a9cc","name":"Main Light: OFF","server":"d2144d44.18e","version":1,"service_domain":"light","service":"turn_off","entityId":"light.man_cave_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1070,"y":120,"wires":[[]]},{"id":"71f65df5.585754","type":"api-current-state","z":"7e73eced.d8a9cc","name":"Main Light: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"light.man_cave_ceiling","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":530,"y":150,"wires":[["b3541089.da682"],[]],"outputLabels":["Yes","No"]},{"id":"edf9fe8b.7049a","type":"api-call-service","z":"7e73eced.d8a9cc","name":"Main Light: ON","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_on","entityId":"light.man_cave_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":740,"y":90,"wires":[[]]},{"id":"3364055f.a46c2a","type":"api-current-state","z":"7e73eced.d8a9cc","name":"Main Light: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"light.man_cave_ceiling","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":530,"y":90,"wires":[[],["edf9fe8b.7049a"]],"outputLabels":["Yes","No"]},{"id":"d7b23812.87a6c8","type":"api-call-service","z":"7e73eced.d8a9cc","name":"Main Light: OFF","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_off","entityId":"light.man_cave_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":815,"y":465,"wires":[[]]},{"id":"e8a4c818.fc6948","type":"api-current-state","z":"7e73eced.d8a9cc","name":"Main Light: ON?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"light.man_cave_ceiling","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":605,"y":465,"wires":[["d7b23812.87a6c8"],[]],"outputLabels":["Yes","No"]},{"id":"5b013c95.e296d4","type":"server-events","z":"cf31d5a7.9b9f88","name":"All","server":"d2144d44.18e","event_type":"ios.notification_action_fired","x":110,"y":540,"wires":[["53f8080c.b89388"]]},{"id":"53f8080c.b89388","type":"switch","z":"cf31d5a7.9b9f88","name":"What Action","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"HEAT_PUMP_OFF","vt":"str"},{"t":"eq","v":"ALARM_SILENT","vt":"str"},{"t":"eq","v":"ALARM_LOUD","vt":"str"},{"t":"eq","v":"ALARM_TRIGGERED_NOTIFY_FRIENDS","vt":"str"},{"t":"eq","v":"ALARM_TRIGGERED_NOTIFY_SOCIAL_MEDIA","vt":"str"},{"t":"eq","v":"ALARM_TRIGGERED_NOTIFY_BOTH","vt":"str"},{"t":"eq","v":"ALARM_TRIGGERED_OFF","vt":"str"},{"t":"eq","v":"GUEST_MODE_OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":280,"y":540,"wires":[["3bc88467.27a09c","a3714422.0ee768"],["52a46f46.20e7d"],["95f37499.b725a8"],["b50374f.d669488"],["2ff9898f.40cdc6"],["83c578a8.a7ac58"],["f804cb93.dc0ca8"],["3b379b83.1ae734"]],"outputLabels":["","","","NOTIFY_FRIENDS","NOTIFY_SOCIAL_MEDIA","NOTIFY_BOTH","ALARM_OFF",null]},{"id":"3bc88467.27a09c","type":"api-current-state","z":"cf31d5a7.9b9f88","name":"Man cave: Heat pump","server":"d2144d44.18e","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"climate.man_cave","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":595,"y":360,"wires":[["24238699.025a3a"]],"outputLabels":["true","false"]},{"id":"24238699.025a3a","type":"switch","z":"cf31d5a7.9b9f88","name":"Is Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":360,"wires":[[],["978bb711.29e868"]],"outputLabels":["Off","On"]},{"id":"978bb711.29e868","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Turn: OFF","server":"d2144d44.18e","version":"1","service_domain":"climate","service":"turn_off","entityId":"climate.man_cave","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":960,"y":360,"wires":[[]]},{"id":"a3714422.0ee768","type":"api-current-state","z":"cf31d5a7.9b9f88","name":"Livingroom: Heat pump","server":"d2144d44.18e","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"climate.living_room","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":605,"y":420,"wires":[["7ab10e9d.1d1ee"]],"outputLabels":["true"]},{"id":"7ab10e9d.1d1ee","type":"switch","z":"cf31d5a7.9b9f88","name":"Is Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":420,"wires":[[],["b2fd5cd6.c7f7c"]],"outputLabels":["Off","On"]},{"id":"b2fd5cd6.c7f7c","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Turn: OFF","server":"d2144d44.18e","version":1,"service_domain":"climate","service":"turn_off","entityId":"climate.living_room","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":960,"y":420,"wires":[[]]},{"id":"9af090a5.de5d3","type":"comment","z":"cf31d5a7.9b9f88","name":"Actionable notifications","info":"","x":130,"y":300,"wires":[]},{"id":"f50ad2b5.9efe4","type":"api-call-service","z":"fe0fe1f5.2651","name":"Notify parents","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_parents","entityId":"","data":"{\"title\":\"Test\",\"message\":\"Test Notification\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":395,"y":1305,"wires":[[]]},{"id":"64151648.614218","type":"inject","z":"fe0fe1f5.2651","name":"Trigger Notification","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":135,"y":1305,"wires":[["f50ad2b5.9efe4"]]},{"id":"df85d89d.552418","type":"server-events","z":"fe0fe1f5.2651","name":"All","server":"d2144d44.18e","event_type":"ios.notification_action_fired","x":95,"y":1095,"wires":[["b86b1e08.3eaf2"]]},{"id":"b86b1e08.3eaf2","type":"switch","z":"fe0fe1f5.2651","name":"What Action","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"SNOOZE","vt":"str"},{"t":"eq","v":"ALREADY_TAKEN","vt":"str"},{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":310,"y":1095,"wires":[["bfbe9fb0.e1174"],["4d0a8c7a.f218d4"],["badf5ab3.7ea988"]]},{"id":"bfbe9fb0.e1174","type":"trigger","z":"fe0fe1f5.2651","name":"","op1":"","op2":"on","op1type":"nul","op2type":"str","duration":"2","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":550,"y":1035,"wires":[["f321f595.a1a538"]]},{"id":"621faacc.3231c4","type":"change","z":"fe0fe1f5.2651","name":"trigger","rules":[{"t":"set","p":"trigger","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":1170,"wires":[["badf5ab3.7ea988"]]},{"id":"ee368067.41812","type":"change","z":"fe0fe1f5.2651","name":"Delete Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1230,"wires":[["badf5ab3.7ea988"]]},{"id":"d756f03.aa9191","type":"switch","z":"fe0fe1f5.2651","name":"","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":1155,"wires":[["f321f595.a1a538"]]},{"id":"badf5ab3.7ea988","type":"hold","z":"fe0fe1f5.2651","name":"Hold until home","x":560,"y":1155,"wires":[["ee368067.41812","d756f03.aa9191"]]},{"id":"8334d069.ba477","type":"inject","z":"fe0fe1f5.2651","name":"Simulate got home","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":135,"y":1170,"wires":[["621faacc.3231c4"]]},{"id":"f321f595.a1a538","type":"api-call-service","z":"fe0fe1f5.2651","name":"Notify Dick","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"message\":\"Good Morning! Remember your meds!\",\"data\":{\"push\":{\"badge\":5,\"category\":\"medicine\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":790,"y":1035,"wires":[[]]},{"id":"4d0a8c7a.f218d4","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":1095,"wires":[]},{"id":"89b503e8.54665","type":"comment","z":"fe0fe1f5.2651","name":"Actionable notifications","info":"","x":115,"y":990,"wires":[]},{"id":"86d7c79e.bb4ee8","type":"trigger","z":"7e73eced.d8a9cc","name":"trigger (15min)","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"15","extend":false,"units":"min","reset":"true","bytopic":"all","outputs":1,"x":305,"y":150,"wires":[["71f65df5.585754"]]},{"id":"7095d823.45aba8","type":"server-state-changed","z":"7e73eced.d8a9cc","name":"Disable Automation","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_man_cave_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":225,"wires":[["d1a2e2e.904d42"],[]]},{"id":"77d1f721.9454c8","type":"mqtt in","z":"fe0fe1f5.2651","name":"","topic":"/SwartNinja/Routine/ShowerTime","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":175,"y":1800,"wires":[["3cdf073c.a31a18"]]},{"id":"3cdf073c.a31a18","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":445,"y":1800,"wires":[]},{"id":"7a39ef7c.5e275","type":"server-state-changed","z":"211f6eb6.d4fab2","name":"Shower time","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.routine_kids_shower_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":115,"y":795,"wires":[["5e5eda4f.960924","44a3e38e.73976c","eaec1736.ecd298","ebff35f6.bafc08"],["92770110.a453a","17cf3a6d.657c56"]]},{"id":"17cf3a6d.657c56","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Hall and Bathroom Automation: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.nodered_hall_lights, switch.nodered_bathroom_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":915,"wires":[["774eb886.316898","1a74f6f6.d01389"]]},{"id":"774eb886.316898","type":"api-current-state","z":"211f6eb6.d4fab2","name":"No Motion in bathroom","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.bathroom_motion","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":710,"y":915,"wires":[["777dd720.c1a518"],[]]},{"id":"1a74f6f6.d01389","type":"api-current-state","z":"211f6eb6.d4fab2","name":"No motion in hall","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.hall_motion","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":705,"y":975,"wires":[["3a591897.7a1f38"],[]]},{"id":"fd15c320.6261d","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn bathroom light: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.bathroom_zw111_nano_dimmer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1235,"y":915,"wires":[[]]},{"id":"777dd720.c1a518","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Bathroom light: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.bathroom_zw111_nano_dimmer","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":970,"y":915,"wires":[["fd15c320.6261d"],[]]},{"id":"67ecb19.26b595","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn hall light: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.hall_zw111_nano_dimmer","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1215,"y":975,"wires":[[]]},{"id":"3a591897.7a1f38","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Hall light: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.hall_zw111_nano_dimmer","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":950,"y":975,"wires":[["67ecb19.26b595"],[]],"outputLabels":["yes","no"]},{"id":"fea1ebbc.b66b98","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn on shower time","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.routine_kids_shower_time","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":105,"wires":[[]]},{"id":"669f4c76.573964","type":"server-state-changed","z":"211f6eb6.d4fab2","name":"Kids bedtime","server":"d2144d44.18e","version":1,"entityidfilter":"input_boolean.routine_kids_bedtime","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":115,"y":1170,"wires":[["ca22ae55.46b8f","83c81ebc.5e3d8","81851c64.49dcb","bba4f60b.cf1b58","7460c091.ab633"],[]]},{"id":"bba4f60b.cf1b58","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn off kids shower time","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.routine_kids_shower_time","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":380,"y":1065,"wires":[[]]},{"id":"fd82ed82.47e53","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn off kids bedtime","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.routine_kids_bedtime","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":625,"y":1305,"wires":[[]]},{"id":"7460c091.ab633","type":"delay","z":"211f6eb6.d4fab2","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":1305,"wires":[["fd82ed82.47e53"]]},{"id":"979f3ce4.e502a","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn on kids bedtime","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.routine_kids_bedtime","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":45,"wires":[[]]},{"id":"92770110.a453a","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Turn bathroom fan: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"fan.bathroom","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":380,"y":840,"wires":[[]]},{"id":"ad8b0f56.2e2ce","type":"api-current-state","z":"7e73eced.d8a9cc","name":"Automation Enabled?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_man_cave_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":370,"y":465,"wires":[["e8a4c818.fc6948"],[]],"outputLabels":["yes","no"]},{"id":"2c543b58.3244b4","type":"inject","z":"bf3a5eec.89f97","name":"At 05:01","repeat":"","crontab":"01 05 * * *","once":false,"onceDelay":0.1,"topic":"Unarmed","payload":"false","payloadType":"bool","x":105,"y":225,"wires":[["934478ec.bf1468"]]},{"id":"dbda284b.151078","type":"api-current-state","z":"bf3a5eec.89f97","name":"Anyone Home: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.presence_anyone_home","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":780,"y":255,"wires":[["c5cd7182.249bf"],[]],"outputLabels":["true","false"]},{"id":"63fc9b29.ca5044","type":"inject","z":"bf3a5eec.89f97","name":"At 23:01","repeat":"","crontab":"01 23 * * *","once":false,"onceDelay":0.1,"topic":"Armed","payload":"true","payloadType":"bool","x":105,"y":285,"wires":[["354bb9b2.fb0b06"]]},{"id":"6acfae9c.b5231","type":"comment","z":"bf3a5eec.89f97","name":"Set Blue Iris profile at a specific time.","info":"","x":165,"y":30,"wires":[]},{"id":"706cb373.4bfb3c","type":"server-state-changed","z":"b715c3d5.53027","name":"Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Dining Room Lights"},{"property":"icon","value":"mdi:silverware-fork-knife"}],"entityidfilter":"binary_sensor.dining_room_motion","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":75,"wires":[["21d00dd9.51beb2"],["21d00dd9.51beb2"]]},{"id":"d421efe1.52c47","type":"comment","z":"b715c3d5.53027","name":"Motion","info":"","x":65,"y":30,"wires":[]},{"id":"6cad6973.b81498","type":"mqtt in","z":"fe0fe1f5.2651","name":"","topic":"BlueIris/status","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":120,"y":1875,"wires":[["2a97212b.5657ae"]]},{"id":"2a97212b.5657ae","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":445,"y":1875,"wires":[]},{"id":"22eca89.2714b58","type":"mqtt in","z":"fe0fe1f5.2651","name":"","topic":"blue_iris/signal/#","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":130,"y":1950,"wires":[["f3c58fb7.051b"]]},{"id":"f3c58fb7.051b","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":445,"y":1950,"wires":[]},{"id":"52a46f46.20e7d","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Silent Alarm: ON","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_alarm_silent","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":575,"y":480,"wires":[[]]},{"id":"95f37499.b725a8","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Loud Alarm: ON","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_alarm_loud","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":575,"y":540,"wires":[[]]},{"id":"322cb66.dd62f4a","type":"api-call-service","z":"69ac7f72.c2662","name":"TV Stand Light: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.living_room_tv_backlight","data":"{\"effect\":\"Strobe\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":360,"y":615,"wires":[[]]},{"id":"a74cc79b.dd40c8","type":"server-state-changed","z":"69ac7f72.c2662","name":"Silent Alarm","server":"d2144d44.18e","version":1,"entityidfilter":"input_boolean.house_alarm_silent","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":115,"y":615,"wires":[["322cb66.dd62f4a","195ce773.087409"],["ab3bba1f.008e38"]]},{"id":"ab3bba1f.008e38","type":"api-call-service","z":"69ac7f72.c2662","name":"TV Stand Light: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.living_room_tv_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":675,"wires":[[]]},{"id":"3b951463.c7d21c","type":"adv ping","z":"fe0fe1f5.2651","name":"Ping Living room TV","host":"192.168.1.200","x":420,"y":1725,"wires":[["15da287e.232bd8"]]},{"id":"10d3aabd.766435","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Living room TV","payload":"","payloadType":"date","x":160,"y":1725,"wires":[["3b951463.c7d21c"]]},{"id":"15da287e.232bd8","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":655,"y":1695,"wires":[]},{"id":"894f8459.a710b8","type":"adv ping","z":"fe0fe1f5.2651","name":"Ping Man Cave TV","host":"192.168.20.210","x":410,"y":1665,"wires":[["15da287e.232bd8"]]},{"id":"43216685.51a5a8","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Man Cave: TV","payload":"","payloadType":"date","x":160,"y":1665,"wires":[["894f8459.a710b8"]]},{"id":"fd913e5f.c91d3","type":"mqtt out","z":"fe0fe1f5.2651","name":"","topic":"cmnd/53542B/position","qos":"2","retain":"true","broker":"48e140b0.c7063","x":490,"y":2220,"wires":[]},{"id":"a5531988.426548","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"57","payloadType":"num","x":145,"y":2220,"wires":[["fd913e5f.c91d3"]]},{"id":"954d182f.c64ac8","type":"inject","z":"fe0fe1f5.2651","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":115,"y":2310,"wires":[["fd913e5f.c91d3"]]},{"id":"b38dd512.7ee4e8","type":"debug","z":"fe0fe1f5.2651","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":2100,"wires":[]},{"id":"c445b824.b38d08","type":"mqtt in","z":"fe0fe1f5.2651","name":"","topic":"53542B/sensor/position","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":175,"y":2100,"wires":[["b38dd512.7ee4e8"]]},{"id":"c5cd7182.249bf","type":"api-call-service","z":"bf3a5eec.89f97","name":"Update Blue Iris Profile","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1030,"y":255,"wires":[[]]},{"id":"51bf3a81.511bc4","type":"change","z":"bf3a5eec.89f97","name":"Blue Iris: Armed","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.service","pt":"msg","to":"turn_on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":285,"wires":[["dbda284b.151078"]]},{"id":"a45f46bc.a5bcd8","type":"change","z":"bf3a5eec.89f97","name":"Blue Iris: Unarmed","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.service","pt":"msg","to":"turn_off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":225,"wires":[["dbda284b.151078"]]},{"id":"250a1714.7b9bf8","type":"server-state-changed","z":"bf3a5eec.89f97","name":"Blue Iris Profile","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.blue_iris","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":125,"y":120,"wires":[["483be8e1.0d1088"],["c528c73f.a7f598"]]},{"id":"a343da2b.60a8e8","type":"mqtt out","z":"bf3a5eec.89f97","name":"","topic":"BlueIris/admin","qos":"","retain":"","broker":"48e140b0.c7063","x":605,"y":120,"wires":[]},{"id":"483be8e1.0d1088","type":"change","z":"bf3a5eec.89f97","name":"Profile: Armed","rules":[{"t":"set","p":"payload","pt":"msg","to":"profile=1&lock=2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":335,"y":90,"wires":[["a343da2b.60a8e8"]]},{"id":"c528c73f.a7f598","type":"change","z":"bf3a5eec.89f97","name":"Profile: Unarmed","rules":[{"t":"set","p":"payload","pt":"msg","to":"profile=2&lock=2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":345,"y":150,"wires":[["a343da2b.60a8e8"]]},{"id":"2d65dd5b.990832","type":"mqtt in","z":"bf3a5eec.89f97","name":"","topic":"BlueIris/status","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":115,"y":435,"wires":[["66182174.707f","f4fa21e3.56814"]]},{"id":"66182174.707f","type":"switch","z":"bf3a5eec.89f97","name":"What Profile","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"profile=1","vt":"str"},{"t":"eq","v":"profile=2","vt":"str"},{"t":"regex","v":"profile=([0]|[3-7])","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":3,"x":310,"y":435,"wires":[["9576fcd1.e0fc4"],["8c27baed.e480d8"],["f450adf2.e5e79"]]},{"id":"9576fcd1.e0fc4","type":"api-current-state","z":"bf3a5eec.89f97","name":"Armed","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.blue_iris","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":515,"y":375,"wires":[[],["b4d3f4ef.4cf158"]],"outputLabels":["true","false"]},{"id":"8c27baed.e480d8","type":"api-current-state","z":"bf3a5eec.89f97","name":"Unarmed","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.blue_iris","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":525,"y":435,"wires":[[],["a6be6430.c0f238"]],"outputLabels":["true","false"]},{"id":"b4d3f4ef.4cf158","type":"api-call-service","z":"bf3a5eec.89f97","name":"Update Profile: Armed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":745,"y":375,"wires":[[]]},{"id":"a6be6430.c0f238","type":"api-call-service","z":"bf3a5eec.89f97","name":"Update Profile: Unarmed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":755,"y":435,"wires":[[]]},{"id":"f450adf2.e5e79","type":"debug","z":"bf3a5eec.89f97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":515,"y":495,"wires":[]},{"id":"75834878.7d5dc8","type":"mqtt in","z":"bf3a5eec.89f97","name":"","topic":"BlueIris/app","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":115,"y":660,"wires":[["32792ab0.419e66","21204836.dd6958"]]},{"id":"32792ab0.419e66","type":"switch","z":"bf3a5eec.89f97","name":"Event","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"starting","vt":"str"},{"t":"eq","v":"unexpected stop","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":660,"wires":[["657f1696.90fde8"],["84364456.e46ff8"]]},{"id":"86be2bab.1be378","type":"api-call-service","z":"bf3a5eec.89f97","name":"Update Profile: Armed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":715,"y":585,"wires":[[]]},{"id":"bca3de3e.cd678","type":"api-call-service","z":"bf3a5eec.89f97","name":"Update Profile: Unarmed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":690,"wires":[[]]},{"id":"84364456.e46ff8","type":"function","z":"bf3a5eec.89f97","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"data\": {\n        \"title\": \"Blue Iris Alerts\",\n        \"message\": \"Unexpected stop\"\n    }\n  },\n  \"topic\": \"Blue Iris Alerts\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Person Detected\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":465,"y":705,"wires":[["49d09556.3a4fdc"]]},{"id":"49d09556.3a4fdc","type":"api-call-service","z":"bf3a5eec.89f97","name":"Notify Dick","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":640,"y":705,"wires":[[]]},{"id":"8f1387ce.8d0168","type":"time-range-switch","z":"bf3a5eec.89f97","name":"Between 23:00 - 05:00","lat":"-41.168701","lon":"174.818557","startTime":"23:00","endTime":"05:00","startOffset":0,"endOffset":0,"x":715,"y":660,"wires":[["ad262d7c.5dbf6"],["bca3de3e.cd678"]]},{"id":"ad262d7c.5dbf6","type":"api-call-service","z":"bf3a5eec.89f97","name":"Update Profile: Armed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":630,"wires":[[]]},{"id":"f24a2eee.def41","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Alexa","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1280,"y":315,"wires":[["e47a5f94.50afa"]]},{"id":"e47a5f94.50afa","type":"change","z":"211f6eb6.d4fab2","name":"Clear Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":390,"wires":[["a87f2d7c.f62f1"]]},{"id":"a87f2d7c.f62f1","type":"delay","z":"211f6eb6.d4fab2","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":390,"wires":[["f303641f.ace628"]]},{"id":"207db2c8.617c6e","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Set Volume: 0.5","server":"d2144d44.18e","version":1,"service_domain":"media_player","service":"volume_set","entityId":"media_player.living_room_alexa_tv, media_player.man_cave_echo_dot","data":"{\"volume_level\":0.5}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1295,"y":390,"wires":[[]]},{"id":"697b0fcd.6615a","type":"function","z":"211f6eb6.d4fab2","name":"Data","func":"/*\n * Speech Synthesis Markup Language (SSML) Reference\n * URL: https://developer.amazon.com/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html#speak\n */\n// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = { payload: \"\" };\nconst voices = [\n  // English, Australian (en-AU)\n  \"Nicole\", \"Russell\",\n  // English, British (en-GB)\n  \"Amy\", \"Brian\", \"Emma\",\n  // English, American (en-US)\n  \"Joanna\", \"Joey\", \"Justin\", \"Kendra\", \"Kimberly\", \"Matthew\", \"Salli\"\n];\n\nfunction getMessage() {\n  const voice_name = voices[Math.floor(Math.random() * voices.length)];\n  return \"<voice name='\" + voice_name + \"'><prosody rate=\\\"x-fast\\\">Time's up!</prosody>, It's time to go shower.</voice>\"\n}\n\nmessage.alexa = {\n  message: \"<prosody volume=\\\"x-loud\\\">\" + getMessage() + \"</prosody>\",\n  data: { \"type\": \"announce\", \"method\": \"speak\" },\n  target:[\"media_player.man_cave_echo_dot\"]\n}\nmessage.notify = {\n    title: \"Shower Time\",\n    message: \"Time's up!, It's time to go shower.\"\n}\nnode.status({ fill: \"green\", shape: \"dot\", text: \"OK\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":920,"y":165,"wires":[["57852a4e.9b49c4"]]},{"id":"f303641f.ace628","type":"change","z":"211f6eb6.d4fab2","name":"delete payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1085,"y":390,"wires":[["207db2c8.617c6e"]]},{"id":"6004dcc9.31cc34","type":"change","z":"211f6eb6.d4fab2","name":"Set Payload.data","rules":[{"t":"set","p":"payload.data","pt":"msg","to":"alexa","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1095,"y":315,"wires":[["f24a2eee.def41"]]},{"id":"2af91de4.97bfe2","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Set Volume: 1","server":"d2144d44.18e","version":1,"service_domain":"media_player","service":"volume_set","entityId":"media_player.living_room_alexa_tv, media_player.man_cave_echo_dot","data":"{\"volume_level\":1}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":710,"y":315,"wires":[["b8a16c52.d0f11"]]},{"id":"b8a16c52.d0f11","type":"delay","z":"211f6eb6.d4fab2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":315,"wires":[["6004dcc9.31cc34"]]},{"id":"57852a4e.9b49c4","type":"change","z":"211f6eb6.d4fab2","name":"Clear Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":195,"wires":[["2af91de4.97bfe2","d464d256.67b5f"]]},{"id":"22fac42f.bd95dc","type":"api-current-state","z":"7be81a90.d7d494","name":"Automation Enabled?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_kitchen_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":340,"y":240,"wires":[["491f6fc6.da932"],[]],"outputLabels":["ON","OFF"]},{"id":"81c0eebe.ece3a","type":"api-current-state","z":"827aa7bb.e776e8","name":"Automation Enabled?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_living_room_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":385,"y":315,"wires":[["c61406bf.327118"],[]],"outputLabels":["yes","no"]},{"id":"92e537f7.e949f8","type":"server-state-changed","z":"69ac7f72.c2662","name":"Loud Alarm","server":"d2144d44.18e","version":1,"entityidfilter":"input_boolean.house_alarm_loud","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":115,"y":210,"wires":[["ceb0abb9.399988","8e7c92b6.c99ae","d03ae8eb.ff3eb8","f0260cd5.d43c5","77080a78.4f8df4"],["39c85e8b.312532","ad0c6c3d.6f25","69d84e1f.c8bc8","f0260cd5.d43c5","77080a78.4f8df4"]]},{"id":"ceb0abb9.399988","type":"api-call-service","z":"69ac7f72.c2662","name":"Silent Alarm: ON","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_alarm_silent","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":360,"y":45,"wires":[[]]},{"id":"39c85e8b.312532","type":"api-call-service","z":"69ac7f72.c2662","name":"Silent Alarm: OFF","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.house_alarm_silent","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":360,"y":300,"wires":[[]]},{"id":"28379792.574df8","type":"delay","z":"69ac7f72.c2662","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":555,"y":480,"wires":[["cfb2c953.b10688"]]},{"id":"191f433e.6e846d","type":"delay","z":"69ac7f72.c2662","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":945,"y":480,"wires":[["981a4d8d.16d74"]]},{"id":"981a4d8d.16d74","type":"api-current-state","z":"69ac7f72.c2662","name":"Silent Alarm ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_alarm_silent","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":600,"y":555,"wires":[["195ce773.087409"],[]]},{"id":"8f4ad42b.d39948","type":"function","z":"69ac7f72.c2662","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst triggered = \"Triggered \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": \"House Alarm\",\n      \"message\": triggered,\n      \"data\": {\n        \"push\": {\n          \"category\": \"alarm_triggered\",\n          \"sound\": {\n            \"name\": \"Update.caf\",\n            \"critical\": 1,\n            \"volume\": 1.0\n          }\n        },\n      }\n    }\n  },\n  \"topic\": \"Door State Changed\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: triggered });\nreturn message;","outputs":1,"noerr":0,"x":555,"y":195,"wires":[["9755a9b.cc34358"]]},{"id":"b3b7db46.f08958","type":"csv","z":"fe0fe1f5.2651","name":"","sep":",","hdrin":"","hdrout":false,"multi":"one","ret":"\\n","temp":"date, time, day, location, service","skip":"0","x":995,"y":870,"wires":[["35922623.4c521a"]]},{"id":"35922623.4c521a","type":"file","z":"fe0fe1f5.2651","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"false","x":1145,"y":870,"wires":[[]]},{"id":"f523b6e6.16ed78","type":"function","z":"fe0fe1f5.2651","name":"Format Data","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst _ = global.get('lodash');\n\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now,'d MMM HH:mm:ss');\nconst message = {};\n\nconst date = dateFns.format(now,'yyyy/MM/dd');\nconst time = dateFns.format(now,'HH:mm:ss');\nconst day = dateFns.format(now,'EEEE');\n\nif (!msg.logData) {\n    node.error(\"Invalid Message, no logData property\", msg);\n    node.status({fill:\"red\",shape:\"ring\",text:\"error\" + nodeStatus});\n    return;\n}\n\nconst timeData = {\n    date: date,\n    time: time,\n    day: day\n}\n\nconst unordered = _.cloneDeep(msg.logData)\nconst ordered = {};\nObject.keys(unordered).sort().forEach(function(key) {\n  ordered[key] = unordered[key];\n});\n\nlet fileName = msg.fileName || dateFns.format(now,'yyyy_MM_dd');\nmessage.filename = '/data/logs/' + fileName + '.csv';\nmessage.payload = _.merge(timeData, ordered);\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"data formatted\"+nodeStatus});\nreturn message;\n","outputs":1,"noerr":0,"x":820,"y":870,"wires":[["b3b7db46.f08958"]]},{"id":"c0a14e3c.4b44","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":290,"y":135,"wires":[[],["2208647.076479c"]]},{"id":"854ff464.bff9e8","type":"api-current-state","z":"738f0112.d0a3e","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":575,"y":285,"wires":[[],["ed08d19c.b6622"]]},{"id":"b50374f.d669488","type":"debug","z":"cf31d5a7.9b9f88","name":"Notify Friends","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":575,"y":600,"wires":[]},{"id":"9755a9b.cc34358","type":"api-call-service","z":"69ac7f72.c2662","name":"Notify: Parents","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_parents","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":965,"y":195,"wires":[[]]},{"id":"195ce773.087409","type":"api-call-service","z":"69ac7f72.c2662","name":"Alarm Lights: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.alarm_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":360,"y":480,"wires":[["28379792.574df8"]]},{"id":"cfb2c953.b10688","type":"api-call-service","z":"69ac7f72.c2662","name":"Alarm Lights: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.alarm_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":480,"wires":[["191f433e.6e846d"]]},{"id":"d926801c.9dc58","type":"server-state-changed","z":"67513eed.6b35b","name":"Door","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.front_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":285,"wires":[["2892ca92.24b7b6"],[]]},{"id":"2892ca92.24b7b6","type":"api-current-state","z":"67513eed.6b35b","name":"NodeRed: Hall Motion Lights","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_hall_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":315,"y":285,"wires":[["44c29a18.b1ca24"],[]],"outputLabels":["yes","no"]},{"id":"44c29a18.b1ca24","type":"api-current-state","z":"67513eed.6b35b","name":"Luminance <= 15","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"15","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"sensor.hall_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":570,"y":285,"wires":[["b836bfa0.53a31"],[]]},{"id":"b836bfa0.53a31","type":"api-call-service","z":"67513eed.6b35b","name":"Turn: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.hall_zw111_nano_dimmer","data":"{\"brightness\":255}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":780,"y":285,"wires":[[]]},{"id":"8e7c92b6.c99ae","type":"api-call-service","z":"69ac7f72.c2662","name":"Front Door Siren: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.hall_multisensor_siren","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":90,"wires":[[]]},{"id":"ad0c6c3d.6f25","type":"api-call-service","z":"69ac7f72.c2662","name":"Front Door Siren: OFF","server":"d2144d44.18e","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.hall_multisensor_siren","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":345,"wires":[[]]},{"id":"2ff9898f.40cdc6","type":"debug","z":"cf31d5a7.9b9f88","name":"Social Media Post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":585,"y":660,"wires":[]},{"id":"83c578a8.a7ac58","type":"debug","z":"cf31d5a7.9b9f88","name":"Notify both","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":565,"y":720,"wires":[]},{"id":"e6d5d548.d13ba8","type":"server-state-changed","z":"67513eed.6b35b","name":"Doorbell","server":"d2144d44.18e","version":"1","entityidfilter":"binary_sensor.doorbell","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":105,"y":420,"wires":[["585c967c.c01e48"],[]],"outputLabels":["true","false"]},{"id":"7222c2ef.afc49c","type":"api-current-state","z":"67513eed.6b35b","name":"Text Notifications","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.notifications_text","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":555,"y":390,"wires":[["23fb8293.46ca4e"],[]],"outputLabels":["true","false"]},{"id":"f4958ec0.d1107","type":"api-call-service","z":"67513eed.6b35b","name":"Notify Parents","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_parents","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":1160,"y":390,"wires":[[]]},{"id":"bc2e4c75.76582","type":"api-current-state","z":"67513eed.6b35b","name":"Audio Notifications","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.notifications_audio","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":555,"y":450,"wires":[["35752f7a.adfe5"],[]],"outputLabels":["true","false"]},{"id":"35af6cf3.844c24","type":"comment","z":"67513eed.6b35b","name":"Front door open","info":"","x":95,"y":240,"wires":[]},{"id":"23fb8293.46ca4e","type":"api-call-service","z":"67513eed.6b35b","name":"Snapshot","server":"d2144d44.18e","version":1,"service_domain":"camera","service":"snapshot","entityId":"camera.fdc","data":"{\"filename\":\"/config/www/images/camera_snapshots/snapshot_fdc.jpg\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":390,"wires":[["45ab1aa8.ba54a4"]]},{"id":"45ab1aa8.ba54a4","type":"function","z":"67513eed.6b35b","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"message\": \"Ding! Someone rang the doorbell.\",\n      \"data\": {\n        \"attachment\": {\n            \"url\": \"https://swart.ninja/camera_snapshot/snapshot_fdc.jpg\",\n            \"content-type\": \"jpeg\",\n            \"hide-thumbnail\": false\n        }\n      }\n    }\n  },\n  \"topic\": \"Doorbell notification\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Person Detected\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":960,"y":390,"wires":[["f4958ec0.d1107"]]},{"id":"585c967c.c01e48","type":"api-current-state","z":"67513eed.6b35b","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":320,"y":420,"wires":[["7222c2ef.afc49c"],["bc2e4c75.76582"]]},{"id":"d03ae8eb.ff3eb8","type":"api-call-service","z":"69ac7f72.c2662","name":"Man Cave Siren: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.office_door_system_siren","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":135,"wires":[[]]},{"id":"69d84e1f.c8bc8","type":"api-call-service","z":"69ac7f72.c2662","name":"Man Cave Siren: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.office_door_system_siren","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":390,"wires":[[]]},{"id":"a839bace.a28be8","type":"inject","z":"fe0fe1f5.2651","name":"Trigger Notification","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":135,"y":1365,"wires":[["ad5fd765.339748"]]},{"id":"ad5fd765.339748","type":"api-call-service","z":"fe0fe1f5.2651","name":"Notify parents","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_parents","entityId":"SwartNinjaAdmin","data":"{\"title\":\"Test\",\"message\":\"Test Notification\",\"data\":{\"push\":{\"category\":\"alarm_triggered\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":395,"y":1365,"wires":[[]]},{"id":"f0260cd5.d43c5","type":"trigger","z":"69ac7f72.c2662","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-5","extend":false,"units":"min","reset":"false","bytopic":"all","outputs":1,"x":360,"y":195,"wires":[["8f4ad42b.d39948"]]},{"id":"934478ec.bf1468","type":"api-current-state","z":"bf3a5eec.89f97","name":"Away Mode: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":300,"y":225,"wires":[["a45f46bc.a5bcd8"],[]]},{"id":"354bb9b2.fb0b06","type":"api-current-state","z":"bf3a5eec.89f97","name":"Away Mode: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":300,"y":285,"wires":[["51bf3a81.511bc4"],[]]},{"id":"657f1696.90fde8","type":"api-current-state","z":"bf3a5eec.89f97","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":470,"y":630,"wires":[["86be2bab.1be378"],["8f1387ce.8d0168"]]},{"id":"4248beac.dd699","type":"comment","z":"69ac7f72.c2662","name":"Loud Alarm","info":"","x":85,"y":30,"wires":[]},{"id":"5de0dbac.0d3c54","type":"comment","z":"69ac7f72.c2662","name":"Silent Alarm","info":"","x":85,"y":435,"wires":[]},{"id":"8843892f.904488","type":"server-state-changed","z":"69ac7f72.c2662","name":"Man cave: Back door","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.man_cave_door01","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":145,"y":855,"wires":[["ca7e40a8.c3a4c"],[]],"outputLabels":["OPEN","CLOSE"]},{"id":"3afb8681.48103a","type":"server-state-changed","z":"69ac7f72.c2662","name":"Man cave: Stairs door","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.man_cave_door02","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":145,"y":915,"wires":[["ca7e40a8.c3a4c"],[]],"outputLabels":["OPEN","CLOSE"]},{"id":"f0c15885.015b98","type":"comment","z":"69ac7f72.c2662","name":"Door Sensors","info":"","x":85,"y":795,"wires":[]},{"id":"bc6ed2ec.ec64c","type":"api-call-service","z":"69ac7f72.c2662","name":"Notify: Parents","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_parents","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":1265,"y":990,"wires":[[]]},{"id":"a0e4d5d8.f60eb8","type":"function","z":"69ac7f72.c2662","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst triggered = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": \"Door Opened\",\n      \"message\": msg.data.new_state.attributes.friendly_name + \" opened \" + triggered,\n      \"data\": {\n        \"push\": {\n          \"category\": \"alarm\"\n        },\n        \"attachment\": {\n            \"url\": msg.data.imageUrl,\n            \"content-type\": \"jpeg\",\n            \"hide-thumbnail\": false\n        }\n      }\n    }\n  },\n  \"topic\": \"Door State Changed\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Door opened\" + triggered });\nreturn message;","outputs":1,"noerr":0,"x":1065,"y":990,"wires":[["bc6ed2ec.ec64c"]]},{"id":"cd2f55a3.7d8a98","type":"change","z":"69ac7f72.c2662","name":"Convert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.camera","pt":"msg","to":"\"camera.\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.image_processing","pt":"msg","to":"\"image_processing.rekognition_person_\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.camera_snapshot","pt":"msg","to":"\"/config/www/images/camera_snapshots/snapshot_\" & $.data.base_id & \".jpg\"","tot":"jsonata"},{"t":"set","p":"payload.entity_id","pt":"msg","to":"\"image_processing.rekognition_person_\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.imageUrl","pt":"msg","to":"\"https://swart.ninja/camera_snapshot/snapshot_\" & $.data.base_id & \".jpg\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":915,"wires":[["51e41279.0d658c"]]},{"id":"51e41279.0d658c","type":"template","z":"69ac7f72.c2662","name":"Set Snapshot","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\t\"data\": {\n\t\t\"entity_id\": \"{{data.camera}}\",\n\t\t\"filename\": \"/config/www/images/camera_snapshots/snapshot_{{data.base_id}}.jpg\"\n\t}\n}","output":"json","x":1100,"y":915,"wires":[["24939971.8c8e16"]]},{"id":"24939971.8c8e16","type":"api-call-service","z":"69ac7f72.c2662","name":"Snapshot","server":"d2144d44.18e","version":1,"service_domain":"camera","service":"snapshot","entityId":"{{data.camera}}","data":"{\"filename\":\"{{data.camera_snapshot}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1305,"y":915,"wires":[["7a9a9820.5fb8a8"]]},{"id":"7a9a9820.5fb8a8","type":"delay","z":"69ac7f72.c2662","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":990,"wires":[["a0e4d5d8.f60eb8"]]},{"id":"f1cc995f.99a1b8","type":"api-current-state","z":"69ac7f72.c2662","name":"Away mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":680,"y":915,"wires":[["cd2f55a3.7d8a98","9e67836f.e28b1"],[]]},{"id":"d2ac3cb4.22448","type":"server-state-changed","z":"69ac7f72.c2662","name":"Man cave: Office door","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.man_cave_office_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":145,"y":975,"wires":[["ca7e40a8.c3a4c"],[]],"outputLabels":["OPEN","CLOSE"]},{"id":"6adea694.114748","type":"api-call-service","z":"69ac7f72.c2662","name":"Trigger Alarm","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_alarm_loud","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1135,"y":855,"wires":[[]]},{"id":"f4e7b899.361578","type":"server-state-changed","z":"69ac7f72.c2662","name":"Front Door","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.front_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":180,"y":1035,"wires":[["e677d3b1.f5f22"],[]],"outputLabels":["OPEN","CLOSE"]},{"id":"ca7e40a8.c3a4c","type":"change","z":"69ac7f72.c2662","name":"Camera: MCC","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.base_id","pt":"msg","to":"mcc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":915,"wires":[["f1cc995f.99a1b8"]]},{"id":"e677d3b1.f5f22","type":"change","z":"69ac7f72.c2662","name":"Camera: FDC","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.base_id","pt":"msg","to":"fdc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":975,"wires":[["f1cc995f.99a1b8"]]},{"id":"ba19d32c.66924","type":"inject","z":"69ac7f72.c2662","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"data\":{\"new_state\":{\"attributes\":{\"friendly_name\":\"Test Door\"}}}}","payloadType":"json","x":185,"y":1110,"wires":[["34bca11b.cbf77e"]]},{"id":"f804cb93.dc0ca8","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Loud Alarm: OFF","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.house_alarm_loud","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":585,"y":780,"wires":[[]]},{"id":"cff8ffc3.a29cf","type":"inject","z":"fe0fe1f5.2651","name":"Trigger Notification","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":135,"y":1425,"wires":[["3f060f73.8f239"]]},{"id":"1cc08bae.2968d4","type":"api-call-service","z":"fe0fe1f5.2651","name":"Notify Dick","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":580,"y":1425,"wires":[[]]},{"id":"3f060f73.8f239","type":"function","z":"fe0fe1f5.2651","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst triggered = \"Triggered \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": \"Test\",\n      \"message\": \"Live stream test\",\n      \"data\": {\n        \"attachment\": {\n          \"content-type\": \"jpeg\",\n          \"url\": \"https://30egb3d13en0lpin3ucp0u0onyxaap1y.ui.nabu.casa/local/camera_snapshot/deepstack_object_mcc_latest.jpg\"\n        },\n        \"push\": {\n          \"sound\": {\n            \"name\": \"Update.caf\",\n            \"critical\": 1,\n            \"volume\": 1.0\n          }\n        },\n        \"entity_id\": \"camera.mcc\",\n      }\n    }\n  },\n  \"topic\": \"Some magic topic\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: triggered });\nreturn message;","outputs":1,"noerr":0,"x":360,"y":1425,"wires":[["1cc08bae.2968d4"]]},{"id":"77080a78.4f8df4","type":"trigger","z":"69ac7f72.c2662","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"30","extend":false,"units":"min","reset":"false","bytopic":"all","outputs":1,"x":340,"y":240,"wires":[["3d84e5ac.95261a"]]},{"id":"3d84e5ac.95261a","type":"api-call-service","z":"69ac7f72.c2662","name":"Loud Alarm: OFF","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.house_alarm_loud","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":585,"y":240,"wires":[["d38abf07.df54e"]]},{"id":"d38abf07.df54e","type":"function","z":"69ac7f72.c2662","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst messageText = \"Auto off at \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": \"House Alarm\",\n      \"message\": messageText\n    }\n  },\n  \"topic\": \"Door State Changed\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: messageText });\nreturn message;","outputs":1,"noerr":0,"x":780,"y":240,"wires":[["9755a9b.cc34358"]]},{"id":"34bca11b.cbf77e","type":"change","z":"69ac7f72.c2662","name":"set data payload","rules":[{"t":"set","p":"data.new_state.attributes.friendly_name","pt":"msg","to":"Test Door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":365,"y":1110,"wires":[["c203bb13.1466c8"]]},{"id":"c203bb13.1466c8","type":"change","z":"69ac7f72.c2662","name":"Camera: FDC","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.base_id","pt":"msg","to":"fdc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1110,"wires":[["cd2f55a3.7d8a98"]]},{"id":"c7e66616.aeb088","type":"server-state-changed","z":"69ac7f72.c2662","name":"Man cave: Office door","server":"d2144d44.18e","version":1,"entityidfilter":"binary_sensor.man_cave_office_door","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":145,"y":1215,"wires":[["2831c8f7.422d18"],[]],"outputLabels":["OPEN","CLOSE"]},{"id":"483fd037.96ecb","type":"api-current-state","z":"69ac7f72.c2662","name":"Away mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":665,"y":1245,"wires":[["74b1295e.23c5b8"],[]]},{"id":"2831c8f7.422d18","type":"api-current-state","z":"69ac7f72.c2662","name":"Man cave door position","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"locked","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"lock.man_cave_office_door_lock","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":410,"y":1215,"wires":[["483fd037.96ecb","803e799b.24f0d8"],[]]},{"id":"c95c3eb6.6ce1b","type":"api-call-service","z":"69ac7f72.c2662","name":"Trigger Alarm","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_alarm_loud","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1090,"y":1275,"wires":[[]]},{"id":"803e799b.24f0d8","type":"api-call-service","z":"69ac7f72.c2662","name":"Notify: Dick","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"title\":\"Office Door Opened\",\"message\":\"Office door forced open!\",\"data\":{\"push\":{\"category\":\"alarm\"}}}","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":655,"y":1185,"wires":[[]]},{"id":"f7c6f2e0.fbe81","type":"server-events","z":"98513c22.80cb9","name":"All","server":"d2144d44.18e","event_type":"ios.action_fired","x":110,"y":120,"wires":[["5194a24f.1a963c"]]},{"id":"5194a24f.1a963c","type":"switch","z":"98513c22.80cb9","name":"What Action","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"ToggleOfficeDoor","vt":"str"},{"t":"eq","v":"MCLightsAutomation","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":340,"y":120,"wires":[["80d4ee6c.c6b16"],["951963cb.5610f"],["64a2726.326e18c"]],"outputLabels":["","","ALARM_OFF"]},{"id":"64a2726.326e18c","type":"debug","z":"98513c22.80cb9","name":"Other","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":545,"y":180,"wires":[]},{"id":"80d4ee6c.c6b16","type":"api-call-service","z":"98513c22.80cb9","name":"Toggle Office Door","server":"d2144d44.18e","version":1,"service_domain":"cover","service":"toggle","entityId":"cover.man_cave_office_door","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":585,"y":60,"wires":[[]]},{"id":"951963cb.5610f","type":"api-call-service","z":"98513c22.80cb9","name":"MC Lights Automation","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"toggle","entityId":"switch.nodered_man_cave_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":595,"y":120,"wires":[[]]},{"id":"a793d450.0edec8","type":"api-call-service","z":"1214089.774b8f7","name":"Fish tank main light","server":"d2144d44.18e","version":1,"service_domain":"light","service":"","entityId":"light.smart_fish_tank_01_main_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":90,"wires":[[]]},{"id":"e46ff4d5.533728","type":"light-scheduler","z":"1214089.774b8f7","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":480},\"end\":{\"dow\":1,\"mod\":1200}},{\"start\":{\"dow\":2,\"mod\":480},\"end\":{\"dow\":2,\"mod\":1200}},{\"start\":{\"dow\":3,\"mod\":480},\"end\":{\"dow\":3,\"mod\":1200}},{\"start\":{\"dow\":4,\"mod\":480},\"end\":{\"dow\":4,\"mod\":1200}},{\"start\":{\"dow\":5,\"mod\":480},\"end\":{\"dow\":5,\"mod\":1200}},{\"start\":{\"dow\":6,\"mod\":480},\"end\":{\"dow\":6,\"mod\":1200}},{\"start\":{\"dow\":0,\"mod\":480},\"end\":{\"dow\":0,\"mod\":1200}}]","topic":"smart_fish_tank_light_schedule","name":"Main light schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"str","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":570,"y":90,"wires":[["a793d450.0edec8"]]},{"id":"f98a9bef.94e098","type":"comment","z":"1214089.774b8f7","name":"Fish Tank Main Light","info":"","x":105,"y":30,"wires":[]},{"id":"1f48d89b.367d87","type":"server-state-changed","z":"1214089.774b8f7","name":"Light Schedule","server":"d2144d44.18e","version":1,"entityidfilter":"input_boolean.smart_fish_tank_01_light_schedule","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":125,"y":90,"wires":[["9092fcc2.bf473"],["4cb6d0f1.94623"]]},{"id":"5afd8f3.06b207","type":"api-call-service","z":"1214089.774b8f7","name":"Turn: ON","server":"d2144d44.18e","version":1,"service_domain":"light","service":"turn_on","entityId":"light.smart_fish_tank_01_color_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":960,"y":195,"wires":[[]]},{"id":"e8575401.da3fb8","type":"api-call-service","z":"1214089.774b8f7","name":"Turn: OFF","server":"d2144d44.18e","version":1,"service_domain":"light","service":"turn_off","entityId":"light.smart_fish_tank_01_color_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":760,"y":255,"wires":[[]]},{"id":"bfaf66a4.ef89b8","type":"function","z":"1214089.774b8f7","name":"Random Color","func":"var randomColor = global.get('randomColor');// import the script\nconst dateFns = global.get('dateFns');// import the script\n\nconst message = {};\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now,'d MMM, HH:mm:ss');\n\nvar color = randomColor({\n   format: 'rgb'\n});\n\nvar match = color.match(/rgba?\\((\\d{1,3}), ?(\\d{1,3}), ?(\\d{1,3})\\)?(?:, ?(\\d(?:\\.\\d+?))\\))?/);\n\nvar colorObject = match ? {\n  rgb_color: [Number(match[1]),Number(match[2]),Number(match[3])],\n  brightness: 255,\n  effect: \"none\"\n} : {};\n  \n\nmessage.payload = {\n    data:colorObject\n}\nnode.status({fill:\"green\",shape:\"dot\",text:colorObject.rgb_color + nodeStatus});\nreturn message;","outputs":1,"noerr":0,"x":770,"y":195,"wires":[["5afd8f3.06b207"]]},{"id":"a0cb03a3.93281","type":"switch","z":"1214089.774b8f7","name":"On or Off","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":225,"wires":[["bfaf66a4.ef89b8"],["e8575401.da3fb8"]]},{"id":"495e9b82.7c0ca4","type":"inject","z":"1214089.774b8f7","name":"Turn on color light","repeat":"","crontab":"59 19 * * *","once":false,"onceDelay":0.1,"topic":"smart_fish_tank_color_light_schedule","payload":"true","payloadType":"bool","x":135,"y":195,"wires":[["2617fa34.b70886"]]},{"id":"37355d0f.a980d2","type":"inject","z":"1214089.774b8f7","name":"Turn off color light","repeat":"","crontab":"30 21 * * *","once":false,"onceDelay":0.1,"topic":"smart_fish_tank_color_light_schedule","payload":"false","payloadType":"bool","x":135,"y":255,"wires":[["2617fa34.b70886"]]},{"id":"2617fa34.b70886","type":"api-current-state","z":"1214089.774b8f7","name":"Light Schedule","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.smart_fish_tank_01_light_schedule","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":365,"y":225,"wires":[["a0cb03a3.93281"],[]]},{"id":"d4f864a1.862178","type":"change","z":"4a7b0289.9d915c","name":"Set Subjects","rules":[{"t":"set","p":"subjects","pt":"msg","to":"[\"Reading\",\"Maths\",\"Writing\",\"Spelling\",\"Science\",\"Steam\"]","tot":"json"},{"t":"set","p":"breakTime","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"isDone","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"counter","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"numSubjects","pt":"msg","to":"$count(msg.subjects)\t","tot":"jsonata"},{"t":"set","p":"alexa","pt":"msg","to":"{\"data\":{\"type\":\"announce\",\"method\":\"speak\"},\"target\":[\"media_player.living_room_alexa_tv\",\"media_player.man_cave_echo_dot\"]}","tot":"json"},{"t":"set","p":"studyDuration","pt":"msg","to":"30","tot":"num"},{"t":"set","p":"getReadyDuration","pt":"msg","to":"5","tot":"str"},{"t":"set","p":"schoolStartTime","pt":"msg","to":"9:00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":130,"y":180,"wires":[["2c26f006.12bbe"]]},{"id":"2c26f006.12bbe","type":"function","z":"4a7b0289.9d915c","name":"Set Message","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(new Date(), 'd MMM, HH:mm:ss');\nconst randomIndex = Math.floor(Math.random() * msg.subjects.length);\n\nlet message = \"\";\nif (msg.isDone) {\n  message = \"Thats a wrap, great work guys. You are done for the day.\"\n} else if (msg.breakTime) {\n  message = \"Well done! It's time for a 30 minute break.\"\n} else {\n  msg.currentSubject = msg.subjects.splice(randomIndex, 1)[0];\n  msg.counter++;\n  message = (msg.counter === 1) ? \"First subject for the day is, \" + msg.currentSubject : \"Times Up! Next Subject is \" + msg.currentSubject;\n  message += \". Please get ready.\"\n}\n\n\nmsg.alexaMsg = \"<prosody volume=\\\"x-loud\\\">\" + message + \"</prosody>\";\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"OK\" + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":325,"y":180,"wires":[["27aa719f.c85bbe","a5f24cd4.c26fd"]]},{"id":"9007054d.dbfb98","type":"delay","z":"4a7b0289.9d915c","name":"5 min break before next subject","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":345,"wires":[["c22c9bff.b7f8a8"]]},{"id":"27aa719f.c85bbe","type":"api-call-service","z":"4a7b0289.9d915c","name":"Set Volume: 1","server":"d2144d44.18e","version":1,"service_domain":"media_player","service":"volume_set","entityId":"media_player.living_room_alexa_tv, media_player.man_cave_echo_dot","data":"{\"volume_level\":1}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":545,"y":210,"wires":[["41196a1b.361f94"]]},{"id":"41196a1b.361f94","type":"delay","z":"4a7b0289.9d915c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":735,"y":210,"wires":[["cdffae32.7d0d"]]},{"id":"dd48511.4eb47b","type":"api-call-service","z":"4a7b0289.9d915c","name":"Alexa","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":575,"y":270,"wires":[["12abbd0d.6f31b3"]]},{"id":"73313047.c0c46","type":"change","z":"4a7b0289.9d915c","name":"Clear Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1145,"y":345,"wires":[["68316db.41e6f94"]]},{"id":"68316db.41e6f94","type":"delay","z":"4a7b0289.9d915c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":435,"wires":[["6044202c.8c34b"]]},{"id":"6044202c.8c34b","type":"api-call-service","z":"4a7b0289.9d915c","name":"Set Volume: 0.5","server":"d2144d44.18e","version":1,"service_domain":"media_player","service":"volume_set","entityId":"media_player.living_room_alexa_tv, media_player.man_cave_echo_dot","data":"{\"volume_level\":0.5}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":635,"y":435,"wires":[["505e99c6.69e768"]]},{"id":"305ce420.d89cfc","type":"delay","z":"4a7b0289.9d915c","name":"30 min Studdy Time","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":430,"y":540,"wires":[["9b604369.8423c"]]},{"id":"50942004.745c5","type":"link in","z":"4a7b0289.9d915c","name":"","links":["9e93abea.4cb9b8","a237f0d9.ff987"],"x":180,"y":240,"wires":[["2c26f006.12bbe"]]},{"id":"9e93abea.4cb9b8","type":"link out","z":"4a7b0289.9d915c","name":"","links":["50942004.745c5"],"x":1005,"y":540,"wires":[]},{"id":"203a7ef2.814dc2","type":"debug","z":"4a7b0289.9d915c","name":"Completed","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1045,"y":420,"wires":[]},{"id":"cdffae32.7d0d","type":"change","z":"4a7b0289.9d915c","name":"Set Payload","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data","pt":"msg","to":"alexa","tot":"msg"},{"t":"set","p":"payload.data.message","pt":"msg","to":"alexaMsg","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":270,"wires":[["dd48511.4eb47b"]]},{"id":"70bd0edb.ee4a4","type":"function","z":"4a7b0289.9d915c","name":"Set Variables","func":"/*\n * Speech Synthesis Markup Language (SSML) Reference\n * URL: https://developer.amazon.com/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html#speak\n */\n// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nmsg.isDone = (msg.counter === msg.numSubjects);\n\nif (msg.isDone) {\n    msg.breakTime = true;\n} else {\n    msg.breakTime = (msg.counter % 2 === 0) && !msg.breakTime;\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"OK\" + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":865,"y":540,"wires":[["9e93abea.4cb9b8"]]},{"id":"a5f24cd4.c26fd","type":"debug","z":"4a7b0289.9d915c","name":"Send Message","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":545,"y":150,"wires":[]},{"id":"5238bbde.ec3454","type":"switch","z":"4a7b0289.9d915c","name":"Is Break Time","property":"breakTime","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":965,"y":270,"wires":[["d70d3024.6d158"],["9007054d.dbfb98"]]},{"id":"c22c9bff.b7f8a8","type":"api-current-state","z":"4a7b0289.9d915c","name":"Home School","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_school","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":725,"y":345,"wires":[["cc38811d.ead91"],[]]},{"id":"9b604369.8423c","type":"api-current-state","z":"4a7b0289.9d915c","name":"Home School","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_school","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":665,"y":540,"wires":[["70bd0edb.ee4a4"],[]]},{"id":"cc38811d.ead91","type":"api-call-service","z":"4a7b0289.9d915c","name":"Alexa buzzers","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.man_cave_echo_dot, media_player.living_room_alexa_tv","data":"{\"media_content_id\":\"buzzers_pistols_01\",\"media_content_type\":\"sound\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":935,"y":345,"wires":[["73313047.c0c46"]]},{"id":"2f6d051c.1a354a","type":"inject","z":"4a7b0289.9d915c","name":"Trigger at 8:55","repeat":"","crontab":"55 08 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":125,"y":45,"wires":[["d035a095.f4559"]]},{"id":"d035a095.f4559","type":"api-current-state","z":"4a7b0289.9d915c","name":"Home School","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_school","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":335,"y":45,"wires":[["9beb7410.19a258"],[]]},{"id":"9beb7410.19a258","type":"api-current-state","z":"4a7b0289.9d915c","name":"Is School Today","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.school_today","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":545,"y":45,"wires":[["d4f864a1.862178"],[]]},{"id":"12abbd0d.6f31b3","type":"change","z":"4a7b0289.9d915c","name":"Clear Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":755,"y":270,"wires":[["5238bbde.ec3454"]]},{"id":"11852f41.31e851","type":"link in","z":"4a7b0289.9d915c","name":"Skip buzzer","links":["d70d3024.6d158"],"x":435,"y":480,"wires":[["6044202c.8c34b"]]},{"id":"d70d3024.6d158","type":"link out","z":"4a7b0289.9d915c","name":"Skip Buzzer - OUT","links":["11852f41.31e851"],"x":1110,"y":240,"wires":[]},{"id":"2bb508a3.b0a818","type":"api-call-service","z":"67513eed.6b35b","name":"Alexa doorbell chime","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.man_cave_echo_dot","data":"{\"media_content_id\":\"amzn_sfx_doorbell_chime_02\",\"media_content_type\":\"sound\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1180,"y":450,"wires":[["ca8f8884.138ce8"]]},{"id":"9092fcc2.bf473","type":"change","z":"1214089.774b8f7","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":365,"y":60,"wires":[["e46ff4d5.533728"]]},{"id":"4cb6d0f1.94623","type":"change","z":"1214089.774b8f7","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":365,"y":120,"wires":[["e46ff4d5.533728"]]},{"id":"505e99c6.69e768","type":"switch","z":"4a7b0289.9d915c","name":"Is Done","property":"isDone","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":855,"y":435,"wires":[["203a7ef2.814dc2"],["305ce420.d89cfc"]]},{"id":"9d7a98e4.8375b8","type":"inject","z":"4a7b0289.9d915c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Override","payload":"true","payloadType":"bool","x":130,"y":645,"wires":[["cc31783c.270818"]]},{"id":"cc31783c.270818","type":"change","z":"4a7b0289.9d915c","name":"Set Subjects","rules":[{"t":"set","p":"subjects","pt":"msg","to":"[\"Maths\",\"Writing\",\"Science\",\"Steam\"]","tot":"json"},{"t":"set","p":"breakTime","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"isDone","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"counter","pt":"msg","to":"2","tot":"num"},{"t":"set","p":"numSubjects","pt":"msg","to":"6","tot":"jsonata"},{"t":"set","p":"alexa","pt":"msg","to":"{\"data\":{\"type\":\"announce\",\"method\":\"speak\"},\"target\":[\"media_player.living_room_alexa_tv\",\"media_player.man_cave_echo_dot\"]}","tot":"json"},{"t":"set","p":"studyDuration","pt":"msg","to":"30","tot":"num"},{"t":"set","p":"getReadyDuration","pt":"msg","to":"5","tot":"str"},{"t":"set","p":"schoolStartTime","pt":"msg","to":"9:00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":325,"y":645,"wires":[["a237f0d9.ff987"]]},{"id":"a237f0d9.ff987","type":"link out","z":"4a7b0289.9d915c","name":"","links":["50942004.745c5"],"x":465,"y":645,"wires":[]},{"id":"491f6fc6.da932","type":"trigger","z":"7be81a90.d7d494","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"true","bytopic":"all","topic":"topic","outputs":1,"x":580,"y":240,"wires":[["e0c44706.a3c4a8","291cb5d4.e438fa"]]},{"id":"99e00c9.4fedff","type":"switch","z":"841dd090.abafb","name":"What Camera","property":"data.base_id","propertyType":"msg","rules":[{"t":"eq","v":"byc","vt":"str"},{"t":"eq","v":"dec","vt":"str"},{"t":"eq","v":"drc","vt":"str"},{"t":"eq","v":"fdc","vt":"str"},{"t":"eq","v":"hlc","vt":"str"},{"t":"eq","v":"hsc","vt":"str"},{"t":"eq","v":"lrc","vt":"str"},{"t":"eq","v":"mcc","vt":"str"},{"t":"eq","v":"ofc","vt":"str"},{"t":"eq","v":"all","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":11,"x":1235,"y":285,"wires":[["b1757f7.f70a48"],["e3b9a52f.a655f8"],["84ae88d8.7b6e48"],["bf0ad1b0.7c95"],["103dfa58.233f86"],["b6d22c34.13ce6"],["6fa06193.3028f"],["7f6bcf37.0b99a"],["4782993e.99edd8"],["b1757f7.f70a48","e3b9a52f.a655f8","84ae88d8.7b6e48","bf0ad1b0.7c95","103dfa58.233f86","b6d22c34.13ce6","6fa06193.3028f","7f6bcf37.0b99a","4782993e.99edd8","6ba77a43.f6d584"],["6ba77a43.f6d584"]]},{"id":"6ba77a43.f6d584","type":"debug","z":"841dd090.abafb","name":"OTHER","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1545,"y":585,"wires":[]},{"id":"7f6bcf37.0b99a","type":"ha-entity","z":"841dd090.abafb","name":"mcc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"mcc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":465,"wires":[[]]},{"id":"b1757f7.f70a48","type":"ha-entity","z":"841dd090.abafb","name":"byc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"byc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":45,"wires":[[]]},{"id":"e3b9a52f.a655f8","type":"ha-entity","z":"841dd090.abafb","name":"dec_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"dec_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":105,"wires":[[]]},{"id":"84ae88d8.7b6e48","type":"ha-entity","z":"841dd090.abafb","name":"drc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"drc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":165,"wires":[[]]},{"id":"bf0ad1b0.7c95","type":"ha-entity","z":"841dd090.abafb","name":"fdc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"fdc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":225,"wires":[[]]},{"id":"103dfa58.233f86","type":"ha-entity","z":"841dd090.abafb","name":"hlc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"hlc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":285,"wires":[[]]},{"id":"b6d22c34.13ce6","type":"ha-entity","z":"841dd090.abafb","name":"hsc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"hsc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":345,"wires":[[]]},{"id":"6fa06193.3028f","type":"ha-entity","z":"841dd090.abafb","name":"lrc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"lrc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1555,"y":405,"wires":[[]]},{"id":"4782993e.99edd8","type":"ha-entity","z":"841dd090.abafb","name":"ofc_ai_motion","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"ofc_ai_motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"targets","value":"data.targets","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1565,"y":525,"wires":[[]]},{"id":"b8f92df8.91ce8","type":"catch","z":"4a7b0289.9d915c","name":"","scope":null,"uncaught":false,"x":90,"y":750,"wires":[["f71422a1.670dc","d2707415.161b08"]]},{"id":"f71422a1.670dc","type":"debug","z":"4a7b0289.9d915c","name":"Debug","active":false,"console":"false","complete":"payload","x":305,"y":810,"wires":[]},{"id":"d2707415.161b08","type":"function","z":"4a7b0289.9d915c","name":"send to specific chat - group","func":"\nmsg.payload = {\n    chatId : -1001277388155, \n    type : 'message',\n    content : 'Error in ' + node.name + '<br>message: ' + error.message + \n              '<br>id: ' + error.source.id + '<br>name: ' + error.source.name + \n              '<br>type: ' + error.source.type\n}\nreturn msg;","outputs":1,"noerr":0,"x":375,"y":750,"wires":[["ac0d94c3.537a78"]]},{"id":"ac0d94c3.537a78","type":"telegram sender","z":"4a7b0289.9d915c","name":"send response","bot":"865bcfc2.91c85","outputs":1,"x":665,"y":750,"wires":[[]]},{"id":"20c5282e.3fb898","type":"server-state-changed","z":"841dd090.abafb","name":"Camera Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.\\w{3}_motion","entityidfiltertype":"regex","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":110,"y":330,"wires":[["f2acc733.547548"],["d3c23f64.88cc6"]]},{"id":"f2acc733.547548","type":"change","z":"841dd090.abafb","name":"Convert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.base_id","pt":"msg","to":"$match(topic, /binary_sensor.(\\w{3})_motion/).groups[0].$string()","tot":"jsonata"},{"t":"set","p":"data.camera","pt":"msg","to":"\"camera.\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.image_processor","pt":"msg","to":"\"image_processing.deepstack_object_\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.camera_snapshot","pt":"msg","to":"\"/config/www/images/camera_snapshots/deepstack_object_\" & $.data.base_id & \"_latest.jpg\"","tot":"jsonata"},{"t":"set","p":"data.chatId","pt":"msg","to":"telegram.chatId.swart_ninja_smart_home_group","tot":"global"},{"t":"set","p":"data.notifyTitle","pt":"msg","to":"($.data.new_state.attributes.friendly_name) ? $.data.new_state.attributes.friendly_name : $uppercase($.data.base_id)\t","tot":"jsonata"},{"t":"set","p":"data.imageUrl","pt":"msg","to":"\"https://30egb3d13en0lpin3ucp0u0onyxaap1y.ui.nabu.casa/local/images/camera_snapshots/deepstack_object_\" & $.data.base_id & \"_latest.jpg\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":285,"wires":[["1a1748ff.986c07"]]},{"id":"940c748d.37d8b8","type":"api-current-state","z":"841dd090.abafb","name":"Person Check","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"gt","override_topic":false,"entity_id":"{{data.image_processor}}","state_type":"num","state_location":"data.personCheck.state","override_payload":"msg","entity_location":"data.personCheck.entity","override_data":"msg","blockInputOverrides":false,"x":830,"y":195,"wires":[["3edcc17a.d64f6e","7ff097f8.bcfb68"],["5f793ae0.3546e4","76244f18.192a9"]]},{"id":"d87e5f7d.e541","type":"api-call-service","z":"841dd090.abafb","name":"Deepstack","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"image_processing","service":"scan","entityId":"","data":"{\"entity_id\":\"{{data.image_processor}}\"}","dataType":"json","mergecontext":"","output_location":"data.deepstack","output_location_type":"msg","mustacheAltTags":false,"x":565,"y":150,"wires":[["940c748d.37d8b8"]]},{"id":"3edcc17a.d64f6e","type":"change","z":"841dd090.abafb","name":"True","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1025,"y":165,"wires":[["99e00c9.4fedff"]]},{"id":"5f793ae0.3546e4","type":"change","z":"841dd090.abafb","name":"False","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1025,"y":225,"wires":[["99e00c9.4fedff"]]},{"id":"d3c23f64.88cc6","type":"change","z":"841dd090.abafb","name":"Convert","rules":[{"t":"set","p":"data.base_id","pt":"msg","to":"$match(topic, /binary_sensor.(\\w{3})_motion/).groups[0].$string()","tot":"jsonata"},{"t":"set","p":"data.targets","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1035,"y":345,"wires":[["99e00c9.4fedff"]]},{"id":"35752f7a.adfe5","type":"api-call-service","z":"67513eed.6b35b","name":"Set Volume: 1","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.man_cave_echo_dot","data":"{\"volume_level\":1}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":770,"y":450,"wires":[["789ce3f3.5e892c"]]},{"id":"789ce3f3.5e892c","type":"delay","z":"67513eed.6b35b","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":450,"wires":[["2bb508a3.b0a818"]]},{"id":"56736d4a.4de7a4","type":"inject","z":"67513eed.6b35b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Fake Doorbell Ring","payload":"true","payloadType":"bool","x":145,"y":510,"wires":[["585c967c.c01e48"]]},{"id":"ca8f8884.138ce8","type":"delay","z":"67513eed.6b35b","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":525,"y":525,"wires":[["c6b5145a.691988"]]},{"id":"c6b5145a.691988","type":"api-call-service","z":"67513eed.6b35b","name":"Alexa doorbell chime","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.man_cave_echo_dot","data":"{\"media_content_id\":\"amzn_sfx_doorbell_chime_02\",\"media_content_type\":\"sound\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":730,"y":525,"wires":[["a800b0b8.02c77"]]},{"id":"a800b0b8.02c77","type":"delay","z":"67513eed.6b35b","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":930,"y":525,"wires":[["8fb000d5.6a7de"]]},{"id":"8fb000d5.6a7de","type":"api-call-service","z":"67513eed.6b35b","name":"Set Volume: 0.5","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.man_cave_echo_dot","data":"{\"volume_level\":0.5}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1115,"y":525,"wires":[[]]},{"id":"18b4a7b6.0a7a38","type":"inject","z":"841dd090.abafb","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"All","payload":"false","payloadType":"bool","x":875,"y":405,"wires":[["4eb79dac.3a3084"]]},{"id":"4eb79dac.3a3084","type":"change","z":"841dd090.abafb","name":"Convert","rules":[{"t":"set","p":"data.base_id","pt":"msg","to":"all","tot":"str"},{"t":"set","p":"data.targets","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1035,"y":405,"wires":[["99e00c9.4fedff"]]},{"id":"8f0c6df0.b38c2","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Notify Living Room TV","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"living_room_television","entityId":"","data":"$.notify","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1705,"y":195,"wires":[[]]},{"id":"d464d256.67b5f","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Living Room Television: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"media_player.living_room_television","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1425,"y":195,"wires":[["8f0c6df0.b38c2"],[]]},{"id":"412736e5.c11f08","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Luminance <= 50","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"50","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"sensor.bathroom_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":720,"y":555,"wires":[["5e47ac49.70fd64"],[]]},{"id":"7a7f6896.8887c8","type":"api-current-state","z":"211f6eb6.d4fab2","name":"Luminance <= 50","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"50","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"sensor.hall_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":720,"y":615,"wires":[["18a0b59c.dd8d7a"],[]]},{"id":"44a3e38e.73976c","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Bathroom Automated Lights: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.nodered_bathroom_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":555,"wires":[["412736e5.c11f08"]]},{"id":"eaec1736.ecd298","type":"api-call-service","z":"211f6eb6.d4fab2","name":"Hall Automated Lights: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.nodered_hall_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":390,"y":615,"wires":[["7a7f6896.8887c8"]]},{"id":"a4059bf3.fb3fd8","type":"server-state-changed","z":"665eecf8.0e9db4","name":"Disable Automation","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_bathroom_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":135,"y":135,"wires":[["6e70996b.cda418"],[]]},{"id":"7dd9be65.05d8f","type":"inject","z":"841dd090.abafb","name":"Man Cave","props":[{"p":"payload","v":"true","vt":"bool"},{"p":"topic","v":"binary_sensor.mcc_motion","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"binary_sensor.mcc_motion","payload":"true","payloadType":"bool","x":135,"y":195,"wires":[["f2acc733.547548"]]},{"id":"1a15eb15.a5f205","type":"api-call-service","z":"841dd090.abafb","name":"Snapshot","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"camera","service":"snapshot","entityId":"{{data.camera}}","data":"{\"filename\":\"{{data.camera_snapshot}}\"}","dataType":"json","mergecontext":"","output_location":"snapshot","output_location_type":"msg","mustacheAltTags":false,"x":465,"y":525,"wires":[["685e41e0.4f3b1"]]},{"id":"6a08be99.33157","type":"server-state-changed","z":"84b86f62.4bafe","name":"Container State","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.docker_.*(minecraft).*","entityidfiltertype":"regex","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":125,"y":120,"wires":[["cff04284.12152"]]},{"id":"1ee6c58d.a18d2a","type":"trigger","z":"84b86f62.4bafe","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"30","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":760,"y":60,"wires":[["77f72f79.e5658"]]},{"id":"ef8a7400.2eff98","type":"switch","z":"84b86f62.4bafe","name":"What container","property":"data.base_id","propertyType":"msg","rules":[{"t":"eq","v":"minecraft_server_01","vt":"str"},{"t":"eq","v":"minecraft_server_02","vt":"str"},{"t":"eq","v":"minecraft_server_03","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":515,"y":120,"wires":[["1ee6c58d.a18d2a"],["cb8cd894.73cb48"],["33d225c2.39f03a"]]},{"id":"77f72f79.e5658","type":"api-current-state","z":"84b86f62.4bafe","name":"Playing","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"gt","override_topic":false,"entity_id":"{{data.sensor}}","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":975,"y":120,"wires":[["7401b6db.1a50a8"],["439956a6.1d8d28"]]},{"id":"4c964eb3.b4d37","type":"api-call-service","z":"84b86f62.4bafe","name":"Pause Container","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1380,"y":150,"wires":[[]]},{"id":"439956a6.1d8d28","type":"template","z":"84b86f62.4bafe","name":"Set Payload","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\t\"data\": {\n\t\t\"entity_id\": \"{{topic}}\"\n\t}\n}","output":"json","x":1180,"y":150,"wires":[["4c964eb3.b4d37"]]},{"id":"cff04284.12152","type":"change","z":"84b86f62.4bafe","name":"Convert","rules":[{"t":"set","p":"data.base_id","pt":"msg","to":"$match(topic, /switch.docker_(.*.)/).groups[0].$string()\t\t","tot":"jsonata"},{"t":"set","p":"data.sensor","pt":"msg","to":"\"sensor.\" & $.data.base_id & \"_players_online\"","tot":"jsonata"},{"t":"set","p":"data.switch","pt":"msg","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":315,"y":120,"wires":[["ef8a7400.2eff98"]]},{"id":"7401b6db.1a50a8","type":"change","z":"84b86f62.4bafe","name":"Set Payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":90,"wires":[["7ed729b5.5386a8"]]},{"id":"2191cd79.9d8702","type":"link in","z":"84b86f62.4bafe","name":"","links":["7ed729b5.5386a8"],"x":360,"y":75,"wires":[["ef8a7400.2eff98"]]},{"id":"7ed729b5.5386a8","type":"link out","z":"84b86f62.4bafe","name":"","links":["2191cd79.9d8702"],"x":1305,"y":90,"wires":[]},{"id":"cb8cd894.73cb48","type":"trigger","z":"84b86f62.4bafe","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"30","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":760,"y":120,"wires":[["77f72f79.e5658"]]},{"id":"33d225c2.39f03a","type":"trigger","z":"84b86f62.4bafe","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"30","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":760,"y":180,"wires":[["77f72f79.e5658"]]},{"id":"96500501.43f5d8","type":"comment","z":"84b86f62.4bafe","name":"Stop Minecraft servers if not in use","info":"","x":155,"y":30,"wires":[]},{"id":"b4ec3926.62d678","type":"api-call-service","z":"841dd090.abafb","name":"Notify Parents","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_parents","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":1100,"y":855,"wires":[[]]},{"id":"ca491b30.8f7a58","type":"api-current-state","z":"841dd090.abafb","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":170,"y":855,"wires":[["58115cf5.6fea14","1222501c.dc70d"],[]]},{"id":"b5980d28.5bb9c","type":"function","z":"841dd090.abafb","name":"Fallback Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": msg.data.notifyTitle,\n      \"message\": \"Unable to get image from camera.\",\n      \"data\": {\n        \"push\": {\n          \"category\": \"alarm\"\n        }\n      }\n    }\n  },\n  \"topic\": \"Motion Detected\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Person Detected\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":870,"y":915,"wires":[["b4ec3926.62d678"]]},{"id":"5f675642.0d97d8","type":"catch","z":"841dd090.abafb","name":"Payload Error","scope":["2b39117f.ebc94e","1222501c.dc70d"],"uncaught":false,"x":610,"y":915,"wires":[["b5980d28.5bb9c"]]},{"id":"111853f8.bde38c","type":"catch","z":"841dd090.abafb","name":"Notification Failed","scope":["b4ec3926.62d678"],"uncaught":false,"x":630,"y":975,"wires":[["ac0609c5.465088"]]},{"id":"ac0609c5.465088","type":"api-call-service","z":"841dd090.abafb","name":"Notify Dick","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"title\":\"Camera Motion\",\"message\":\"Unable to get camera photo, check cameras there were motion.\"}","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":850,"y":975,"wires":[[]]},{"id":"7ff097f8.bcfb68","type":"link out","z":"841dd090.abafb","name":"Notification","links":["82399248.f0c19"],"x":990,"y":105,"wires":[]},{"id":"82399248.f0c19","type":"link in","z":"841dd090.abafb","name":"Notification","links":["7ff097f8.bcfb68"],"x":45,"y":855,"wires":[["ca491b30.8f7a58"]]},{"id":"2b39117f.ebc94e","type":"function","z":"841dd090.abafb","name":"Second Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": msg.data.notifyTitle,\n      \"message\": \"Person check failed\",\n      \"data\": {\n        \"attachment\": {\n          \"url\": msg.data.imageUrl,\n          \"content-type\": \"jpeg\",\n          \"hide-thumbnail\": false\n        },\n        \"push\": {\n          \"category\": \"alarm\"\n        }\n      }\n    }\n  },\n  \"topic\": \"Motion Detected\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Person Detected\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":860,"y":795,"wires":[["b4ec3926.62d678"]]},{"id":"544dbed5.0be71","type":"catch","z":"841dd090.abafb","name":"Deepstack Error","scope":["940c748d.37d8b8","d87e5f7d.e541"],"uncaught":false,"x":260,"y":795,"wires":[["8a2d3bf2.cc7d78"]]},{"id":"8a2d3bf2.cc7d78","type":"api-current-state","z":"841dd090.abafb","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":455,"y":795,"wires":[["c0a50ff3.4366d","b00a2ad6.2c4d68"],[]]},{"id":"1222501c.dc70d","type":"function","z":"841dd090.abafb","name":"First Payload","func":"// import the script\nconst _ = global.get('lodash');\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet notifytitle = msg.data.notifyTitle;\nlet notifyMsg = \"Person confidence above 80%\";\n\nif (_.has(msg, 'data.personCheck.entity.attributes.objects')){\n    const confidenceLevels = msg.data.personCheck.entity.attributes.objects.map(obj => {\n        if(obj.name === 'person') {\n            return \"- \" + obj.confidence.toFixed(2) + \"%\";\n        }\n    })\n    notifyMsg = (msg.data.personCheck.state > 1)? msg.data.personCheck.state + \" People detected\": \"Person detected\";\n    notifyMsg +=  \", confidence level:\\n\" + confidenceLevels.join('\\n')\n}\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": notifytitle,\n      \"message\": notifyMsg,\n      \"data\": {\n        \"push\": {\n          \"category\": \"alarm\"\n        },\n        \"attachment\": {\n            \"url\": msg.data.imageUrl,\n            \"content-type\": \"jpeg\",\n            \"hide-thumbnail\": false\n        }\n      }\n    }\n  },\n  \"topic\": \"Person Detected\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Person Detected\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":850,"y":855,"wires":[["b4ec3926.62d678"]]},{"id":"7230a05c.e1b1b","type":"inject","z":"841dd090.abafb","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":105,"y":1680,"wires":[["2ec836cc.f34e0a"]]},{"id":"2ec836cc.f34e0a","type":"change","z":"841dd090.abafb","name":"Convert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.base_id","pt":"msg","to":"TST","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":285,"y":1680,"wires":[["2b798362.cd119c"]]},{"id":"b54dbdd3.b4bca","type":"debug","z":"841dd090.abafb","name":"Counter Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":700,"y":1680,"wires":[]},{"id":"2b798362.cd119c","type":"function","z":"841dd090.abafb","name":"Counter","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet camera_trigger_count = global.get('camera_trigger_count') || {};\nif (!camera_trigger_count.totals) {\n    camera_trigger_count.totals = {\n        day: 0,\n        month: 0,\n        year: 0\n    }\n}\ncamera_trigger_count.totals.day += 1;\ncamera_trigger_count.totals.month += 1;\ncamera_trigger_count.totals.year += 1;\n\nif (!camera_trigger_count.cameras) {\n    camera_trigger_count.cameras = {};\n}\n\nif (!camera_trigger_count.cameras[msg.data.base_id]) {\n    camera_trigger_count.cameras[msg.data.base_id] = {\n        day: 0,\n        month: 0,\n        year: 0\n    };\n}\n\ncamera_trigger_count.cameras[msg.data.base_id].day += 1;\ncamera_trigger_count.cameras[msg.data.base_id].month += 1;\ncamera_trigger_count.cameras[msg.data.base_id].year += 1;\n\nglobal.set('camera_trigger_count',camera_trigger_count);\n\nmsg.data.camera_trigger_count = camera_trigger_count;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Count: \" + camera_trigger_count.totals.day + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":465,"y":1680,"wires":[["b54dbdd3.b4bca"]]},{"id":"656d69f7.4cc338","type":"inject","z":"841dd090.abafb","name":"Trigger","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":95,"y":1740,"wires":[["d1527d97.27379"]]},{"id":"7f435c63.2fe064","type":"debug","z":"841dd090.abafb","name":"Reset all counters Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":1740,"wires":[]},{"id":"d1527d97.27379","type":"function","z":"841dd090.abafb","name":"Reset all counters","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet camera_trigger_count = {\n    totals: {\n        day: 0,\n        month: 0,\n        year: 0\n    },\n    \"cameras\":{\n        \"fdc\":{\"day\":0,\"month\":0,\"year\":0},\n        \"byc\":{\"day\":0,\"month\":0,\"year\":0},\n        \"dec\":{\"day\":0,\"month\":0,\"year\":0},\n        \"lrc\":{\"day\":0,\"month\":0,\"year\":0},\n        \n        \"drc\":{\"day\":0,\"month\":0,\"year\":0},\n        \"hlc\":{\"day\":0,\"month\":0,\"year\":0},\n        \"hsc\":{\"day\":0,\"month\":0,\"year\":0},\n        \"mcc\":{\"day\":0,\"month\":0,\"year\":0},\n        \"ofc\":{\"day\":0,\"month\":0,\"year\":0}\n    }\n}\n\nglobal.set('camera_trigger_count',camera_trigger_count);\nmsg.data = {\n    camera_trigger_count: camera_trigger_count\n}\nmsg.data.camera_trigger_count = camera_trigger_count;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Count: \" + camera_trigger_count.totals.day + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":285,"y":1740,"wires":[["7f435c63.2fe064"]]},{"id":"72501fb9.1082c","type":"inject","z":"841dd090.abafb","name":"Trigger: day","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"day","payloadType":"str","x":115,"y":1425,"wires":[["c288f0c3.52fdf"]]},{"id":"c288f0c3.52fdf","type":"function","z":"841dd090.abafb","name":"Reset counter value to zero","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet camera_trigger_count = global.get('camera_trigger_count') || {};\nif (!camera_trigger_count.totals) {\n    camera_trigger_count.totals = {\n        day: 0,\n        month: 0,\n        year: 0\n    }\n}\ncamera_trigger_count.totals[msg.payload] = 0;\n\nif (!camera_trigger_count.cameras) {\n    camera_trigger_count.cameras = {};\n}\n\nfor (const [camera_key, camera_value] of Object.entries(camera_trigger_count.cameras)) {\n    camera_trigger_count.cameras[camera_key][msg.payload] = 0\n}\n\nglobal.set('camera_trigger_count',camera_trigger_count);\n\nmsg.payload = camera_trigger_count;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Count: \" + camera_trigger_count.totals.day + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":1455,"wires":[["a4e2c8ba.84d9d8"]]},{"id":"c2ed8ae4.a78df8","type":"inject","z":"841dd090.abafb","name":"Trigger","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":95,"y":1620,"wires":[["b719387f.9afb48"]]},{"id":"4a5dfc95.26af64","type":"debug","z":"841dd090.abafb","name":"View counters Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":1620,"wires":[]},{"id":"b719387f.9afb48","type":"function","z":"841dd090.abafb","name":"View Counters","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet camera_trigger_count = global.get('camera_trigger_count') || {};\n\nmsg.payload = camera_trigger_count;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Count: \" + camera_trigger_count.totals.day + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":275,"y":1620,"wires":[["4a5dfc95.26af64","a4e2c8ba.84d9d8"]]},{"id":"a586c8b1.df5ed8","type":"inject","z":"841dd090.abafb","name":"Trigger: month","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"month","payloadType":"str","x":125,"y":1485,"wires":[["c288f0c3.52fdf"]]},{"id":"cad723d.5869ae","type":"inject","z":"841dd090.abafb","name":"Trigger: month","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"year","payloadType":"str","x":125,"y":1545,"wires":[["c288f0c3.52fdf"]]},{"id":"404e3fd3.8b555","type":"cronplus","z":"841dd090.abafb","name":"Auto Reset Counter","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"RESET_COUNTER_DAY","topic":"RESET_COUNTER","payloadType":"str","payload":"day","expressionType":"cron","expression":"0 0 * * *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"},{"name":"RESET_COUNTER_MONTH","topic":"RESET_COUNTER","payloadType":"str","payload":"month","expressionType":"cron","expression":"1 0 0 1 * * ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"},{"name":"RESET_COUNTER_YEAR","topic":"RESET_COUNTER","payloadType":"str","payload":"year","expressionType":"cron","expression":"0 0 1 1 *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":135,"y":1365,"wires":[["c288f0c3.52fdf"]]},{"id":"b9b855ea.fcc468","type":"comment","z":"841dd090.abafb","name":"Reset Counters","info":"","x":95,"y":1305,"wires":[]},{"id":"a4e2c8ba.84d9d8","type":"mqtt out","z":"841dd090.abafb","name":"","topic":"BlueIris/TriggerCount","qos":"","retain":"true","broker":"48e140b0.c7063","x":730,"y":1455,"wires":[]},{"id":"f81b9fca.89fc9","type":"inject","z":"841dd090.abafb","name":"Trigger","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":95,"y":1800,"wires":[["7dbe3a94.58f3c4"]]},{"id":"98aa411f.d1999","type":"debug","z":"841dd090.abafb","name":"Reset all counters Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":1800,"wires":[]},{"id":"7dbe3a94.58f3c4","type":"function","z":"841dd090.abafb","name":"Reset all counters","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\nlet camera_trigger_count = global.get('camera_trigger_count') || {};\n\ncamera_trigger_count.cameras.drc = {\"day\":0,\"month\":0,\"year\":0};\ncamera_trigger_count.cameras.hlc = {\"day\":0,\"month\":0,\"year\":0};\ncamera_trigger_count.cameras.hsc = {\"day\":0,\"month\":0,\"year\":0};\ncamera_trigger_count.cameras.mcc = {\"day\":0,\"month\":0,\"year\":0};\ncamera_trigger_count.cameras.ofc = {\"day\":0,\"month\":0,\"year\":0};\n\nglobal.set('camera_trigger_count',camera_trigger_count);\nmsg.data = {\n    camera_trigger_count: camera_trigger_count\n}\nmsg.data.camera_trigger_count = camera_trigger_count;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Count: \" + camera_trigger_count.totals.day + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":285,"y":1800,"wires":[["98aa411f.d1999"]]},{"id":"26a62263.3e01ae","type":"comment","z":"841dd090.abafb","name":"Set Counters","info":"","x":85,"y":1110,"wires":[]},{"id":"6e1b8d9e.2a6944","type":"link in","z":"841dd090.abafb","name":"Set Counters","links":["58115cf5.6fea14"],"x":60,"y":1170,"wires":[["54175479.cae40c"]]},{"id":"54175479.cae40c","type":"function","z":"841dd090.abafb","name":"Counter","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet camera_trigger_count = global.get('camera_trigger_count') || {};\nif (!camera_trigger_count.totals) {\n    camera_trigger_count.totals = {\n        day: 0,\n        month: 0,\n        year: 0\n    }\n}\ncamera_trigger_count.totals.day += 1;\ncamera_trigger_count.totals.month += 1;\ncamera_trigger_count.totals.year += 1;\n\nif (!camera_trigger_count.cameras) {\n    camera_trigger_count.cameras = {};\n}\n\nif (!camera_trigger_count.cameras[msg.data.base_id]) {\n    camera_trigger_count.cameras[msg.data.base_id] = {\n        day: 0,\n        month: 0,\n        year: 0\n    };\n}\n\ncamera_trigger_count.cameras[msg.data.base_id].day += 1;\ncamera_trigger_count.cameras[msg.data.base_id].month += 1;\ncamera_trigger_count.cameras[msg.data.base_id].year += 1;\n\nglobal.set('camera_trigger_count',camera_trigger_count);\n\nmsg.data.camera_trigger_count = camera_trigger_count;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Count: \" + camera_trigger_count.totals.day + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":1170,"wires":[[]]},{"id":"58115cf5.6fea14","type":"link out","z":"841dd090.abafb","name":"Set Counters","links":["6e1b8d9e.2a6944"],"x":330,"y":900,"wires":[]},{"id":"2ccb30c2.69ccd","type":"comment","z":"841dd090.abafb","name":"Motion notifications","info":"","x":105,"y":750,"wires":[]},{"id":"76244f18.192a9","type":"link out","z":"841dd090.abafb","name":"Take Snapshot","links":["52805365.020e1c"],"x":990,"y":285,"wires":[]},{"id":"52805365.020e1c","type":"link in","z":"841dd090.abafb","name":"Take Snapshot","links":["76244f18.192a9"],"x":60,"y":525,"wires":[["16eca0f9.aef08f"]]},{"id":"c0a50ff3.4366d","type":"delay","z":"841dd090.abafb","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":675,"y":795,"wires":[["2b39117f.ebc94e"]]},{"id":"b00a2ad6.2c4d68","type":"link out","z":"841dd090.abafb","name":"Take Snapshot","links":[],"x":630,"y":750,"wires":[]},{"id":"52e4bec0.49cab","type":"comment","z":"841dd090.abafb","name":"Take Camera Snapshot","info":"","x":115,"y":480,"wires":[]},{"id":"f4fa21e3.56814","type":"debug","z":"bf3a5eec.89f97","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":235,"y":555,"wires":[]},{"id":"21204836.dd6958","type":"debug","z":"bf3a5eec.89f97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":235,"y":810,"wires":[]},{"id":"249c2ebc.2b3692","type":"inject","z":"bf3a5eec.89f97","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":75,"wires":[["483be8e1.0d1088"]]},{"id":"bdef35b1.a6a348","type":"mqtt out","z":"bf3a5eec.89f97","name":"","topic":"BlueIris/status","qos":"","retain":"","broker":"48e140b0.c7063","x":590,"y":1050,"wires":[]},{"id":"ed7a6de0.e368b","type":"inject","z":"bf3a5eec.89f97","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"profile=1&lock=2","payloadType":"str","x":125,"y":1005,"wires":[["bdef35b1.a6a348"]]},{"id":"48849da9.743234","type":"inject","z":"bf3a5eec.89f97","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"profile=2&lock=2","payloadType":"str","x":125,"y":1080,"wires":[["bdef35b1.a6a348"]]},{"id":"735e4108.62aa5","type":"mqtt in","z":"bf3a5eec.89f97","name":"","topic":"BlueIris/#","qos":"2","datatype":"auto","broker":"48e140b0.c7063","x":145,"y":930,"wires":[["74611cbc.d2eea4"]]},{"id":"74611cbc.d2eea4","type":"debug","z":"bf3a5eec.89f97","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":365,"y":930,"wires":[]},{"id":"5a198760.1acfe8","type":"function","z":"fe0fe1f5.2651","name":"confirmation message","func":"var opts = {\n  reply_to_message_id: msg.payload.messageId,\n  reply_markup: JSON.stringify({\n    keyboard: [\n      ['Yes'],\n      ['No']],\n      'resize_keyboard' : true, \n      'one_time_keyboard' : true\n  })\n};\n\nmsg.payload.content = 'Really?';\nmsg.payload.options = opts;\n\nreturn [ msg ];\n","outputs":"1","noerr":0,"x":340,"y":2445,"wires":[["41b2f291.49617c"]]},{"id":"629332ea.a50bdc","type":"telegram command","z":"fe0fe1f5.2651","name":"/foo","command":"/foo","bot":"865bcfc2.91c85","strict":false,"hasresponse":true,"outputs":2,"x":110,"y":2475,"wires":[["5a198760.1acfe8"],["6b644ea8.726a4"]]},{"id":"6b644ea8.726a4","type":"function","z":"fe0fe1f5.2651","name":"create response","func":"if(msg.payload.content === 'Yes')\n{\n    msg.payload.content = 'Yes';\n    return [msg, null];   \n}\nelse\n{\n    msg.payload.content = 'No';\n    return [null, msg];   \n}\n","outputs":"2","noerr":0,"x":320,"y":2510,"wires":[["41b2f291.49617c"],[]]},{"id":"41b2f291.49617c","type":"telegram sender","z":"fe0fe1f5.2651","name":"send response","bot":"865bcfc2.91c85","outputs":1,"x":770,"y":2610,"wires":[[]]},{"id":"91840977.13bc68","type":"telegram command","z":"fe0fe1f5.2651","name":"/help","command":"/help","bot":"865bcfc2.91c85","strict":false,"hasresponse":false,"outputs":2,"x":115,"y":2616,"wires":[["88770eb0.fac3c"],[]]},{"id":"88770eb0.fac3c","type":"function","z":"fe0fe1f5.2651","name":"create help text","func":"\nvar helpMessage = \"/help - shows help\\r\\n\";\nhelpMessage += \"/foo - opens a dialog\\r\\n\";\nhelpMessage += \"Your chat id is \" + msg.payload.chatId;\n\nhelpMessage += \"\\r\\n\";\nhelpMessage += \"You are welcome: \"+msg.originalMessage.from.username;\nhelpMessage += \"\\r\\n\";\n\n\n\nmsg.payload.content = helpMessage;\nreturn msg;","outputs":1,"noerr":0,"x":316,"y":2610,"wires":[["41b2f291.49617c"]]},{"id":"6245d0f8.0b72","type":"telegram receiver","z":"fe0fe1f5.2651","name":"location","bot":"865bcfc2.91c85","saveDataDir":"","filterCommands":false,"x":118,"y":2702,"wires":[["c2b10651.44a918"],[]]},{"id":"c2b10651.44a918","type":"function","z":"fe0fe1f5.2651","name":"create location message","func":"if(msg.payload.type == 'location')\n{\n    var lat = msg.payload.content.latitude;\n    var lng = msg.payload.content.longitude;\n    \n    msg.payload.type = 'message';\n    msg.payload.content = 'lat=' + lat + ' lon=' + lng;\n    return msg;\n}\nelse\n{\n    return null;\n}\n","outputs":1,"noerr":0,"x":341,"y":2702,"wires":[["41b2f291.49617c"]]},{"id":"5de22bfa.cf77f4","type":"inject","z":"fe0fe1f5.2651","name":"ping","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"ping","payloadType":"str","x":110,"y":2820,"wires":[["96b2a214.2ccd6"]]},{"id":"96b2a214.2ccd6","type":"function","z":"fe0fe1f5.2651","name":"send to specific chat","func":"\nmsg.payload = {chatId : 1082374373, type : 'message', content : 'ping'}\nreturn msg;","outputs":1,"noerr":0,"x":318,"y":2820,"wires":[["41b2f291.49617c"]]},{"id":"d6ba8c3b.fe062","type":"inject","z":"fe0fe1f5.2651","name":"ping","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"ping","payloadType":"str","x":110,"y":2760,"wires":[["9457b9a9.2b17a8"]]},{"id":"9457b9a9.2b17a8","type":"function","z":"fe0fe1f5.2651","name":"send to specific chat - group","func":"\nmsg.payload = {chatId : -1001277388155, type : 'message', content : 'ping'}\nreturn msg;","outputs":1,"noerr":0,"x":338,"y":2760,"wires":[["41b2f291.49617c"]]},{"id":"ce540aa5.01e868","type":"comment","z":"9e300652.e09258","name":"3 Way Switch for hall light","info":"","x":125,"y":420,"wires":[]},{"id":"d9c26c97.f65f","type":"switch","z":"9e300652.e09258","name":"Event","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"BTN_BOTTOM_SINGLE","vt":"str"},{"t":"eq","v":"BTN_BOTTOM_DOUBLE","vt":"str"},{"t":"eq","v":"BTN_BOTTOM_LONG","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":545,"y":525,"wires":[["fc9315e0.9f4698"],["66b6e482.cf375c"],["3542f8bc.3ed378"]]},{"id":"66b6e482.cf375c","type":"api-call-service","z":"9e300652.e09258","name":"Stop Door","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"cover","service":"stop_cover","entityId":"cover.office_door_system_cover","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":730,"y":525,"wires":[[]]},{"id":"6f7883a8.725d6c","type":"api-call-service","z":"9e300652.e09258","name":"Unlock Door","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"lock","service":"unlock","entityId":"lock.office_door_system_lock","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":970,"y":435,"wires":[["7c6f4abe.2ea5c4"]]},{"id":"d1dd4e57.8e3e1","type":"change","z":"9e300652.e09258","name":"Delete Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1295,"y":435,"wires":[["4efe0921.c58368"]]},{"id":"7c6f4abe.2ea5c4","type":"delay","z":"9e300652.e09258","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1125,"y":435,"wires":[["d1dd4e57.8e3e1"]]},{"id":"fc9315e0.9f4698","type":"api-current-state","z":"9e300652.e09258","name":"Office Door Locked","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"locked","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"lock.office_door_system_lock","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":750,"y":465,"wires":[["6f7883a8.725d6c"],["e93d606c.aab7c"]]},{"id":"9ce0be16.6898d","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Alexa Actionable Notification - Garage Door OPEN","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"script","service":"activate_alexa_actionable_notification","entityId":"","data":"{\"text\":\"Its getting late and the garage is still open. Would you like me to close it?\",\"event_id\":\"actionable_notification_garage\",\"alexa_device\":\"media_player.man_cave_echo_dot\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":610,"y":945,"wires":[[]]},{"id":"31db3956.383aa6","type":"api-current-state","z":"cf31d5a7.9b9f88","name":"Is Garage Open?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"open","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"cover.office_door_system_cover","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":945,"wires":[["9ce0be16.6898d"],[]]},{"id":"90c9347c.550218","type":"inject","z":"cf31d5a7.9b9f88","name":"","repeat":"","crontab":"42 19 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":945,"wires":[["31db3956.383aa6"]]},{"id":"f96a74b0.f6e7e8","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Garage Door - Close","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"cover","service":"close_cover","entityId":"cover.office_door_system_cover","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":880,"y":1035,"wires":[[]]},{"id":"e34fff15.f5c66","type":"switch","z":"cf31d5a7.9b9f88","name":"Notification Response","property":"payload.event.event_response","propertyType":"msg","rules":[{"t":"eq","v":"ResponseYes","vt":"str"},{"t":"eq","v":"ResponseNo","vt":"str"},{"t":"eq","v":"ResponseNone","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":640,"y":1035,"wires":[["f96a74b0.f6e7e8"],[],["f96a74b0.f6e7e8"]]},{"id":"4afcf8a2.67ff58","type":"switch","z":"cf31d5a7.9b9f88","name":"Notification Check","property":"payload.event.event_id","propertyType":"msg","rules":[{"t":"eq","v":"actionable_notification_garage","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":1035,"wires":[["e34fff15.f5c66"]]},{"id":"fc6826ab.ba8378","type":"server-events","z":"cf31d5a7.9b9f88","name":"Alexa Notification Response","server":"d2144d44.18e","event_type":"alexa_actionable_notification","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":160,"y":1035,"wires":[["4afcf8a2.67ff58"]]},{"id":"8fa98cb6.5333e","type":"comment","z":"cf31d5a7.9b9f88","name":"Alexa Actionable notifications","info":"","x":150,"y":885,"wires":[]},{"id":"c3a0845b.7452c8","type":"comment","z":"9e300652.e09258","name":"Motion","info":"","x":65,"y":30,"wires":[]},{"id":"451f575c.cee128","type":"server-state-changed","z":"9e300652.e09258","name":"Luminance > 200","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.office_zw100_multisensor_luminance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"200","halt_if_type":"num","halt_if_compare":"gte","outputs":2,"output_only_on_state_change":true,"x":125,"y":315,"wires":[["76da4c8d.51aee4"],[]]},{"id":"30341386.f13d4c","type":"comment","z":"9e300652.e09258","name":"Luminance","info":"","x":75,"y":270,"wires":[]},{"id":"d22291b8.68224","type":"api-call-service","z":"9e300652.e09258","name":"Turn: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.office_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":765,"y":315,"wires":[[]]},{"id":"e29c81cc.cd478","type":"api-current-state","z":"9e300652.e09258","name":"Lights: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.office_ceiling","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":580,"y":315,"wires":[["d22291b8.68224"],[]]},{"id":"76da4c8d.51aee4","type":"api-current-state","z":"9e300652.e09258","name":"Automation Enabled?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_office_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":355,"y":315,"wires":[["e29c81cc.cd478"],[]],"outputLabels":["yes","no"]},{"id":"97590dbc.67213","type":"change","z":"841dd090.abafb","name":"Convert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"data.base_id","pt":"msg","to":"$match(topic, /binary_sensor.(\\w{3})_motion/).groups[0].$string()","tot":"jsonata"},{"t":"set","p":"data.camera","pt":"msg","to":"\"camera.\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.image_processor","pt":"msg","to":"\"image_processing.deepstack_object_\" & $.data.base_id","tot":"jsonata"},{"t":"set","p":"data.camera_snapshot","pt":"msg","to":"\"/config/www/images/camera_snapshots/deepstack_object_\" & $.data.base_id & \"_latest.jpg\"","tot":"jsonata"},{"t":"set","p":"data.chatId","pt":"msg","to":"telegram.chatId.swart_ninja_smart_home_group","tot":"global"},{"t":"set","p":"data.notifyTitle","pt":"msg","to":"($.data.new_state.attributes.friendly_name) ? $.data.new_state.attributes.friendly_name : $uppercase($.data.base_id)\t","tot":"jsonata"},{"t":"set","p":"data.imageUrl","pt":"msg","to":"\"https://30egb3d13en0lpin3ucp0u0onyxaap1y.ui.nabu.casa/local/images/camera_snapshots/deepstack_object_\" & $.data.base_id & \"_latest.jpg\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":615,"wires":[["16eca0f9.aef08f"]]},{"id":"398e6de3.5019d2","type":"inject","z":"841dd090.abafb","name":"Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"binary_sensor.mcc_motion","payload":"true","payloadType":"bool","x":95,"y":615,"wires":[["97590dbc.67213"]]},{"id":"685e41e0.4f3b1","type":"debug","z":"841dd090.abafb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":510,"wires":[]},{"id":"59bfade4.671774","type":"api-current-state","z":"738f0112.d0a3e","name":"Is school tomorrow?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.school_tomorrow","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":430,"y":495,"wires":[["7d05f8d0.51b528"],[]],"outputLabels":["true","false"]},{"id":"14b3a5b1.801b3a","type":"server-events","z":"738f0112.d0a3e","name":"","server":"d2144d44.18e","event_type":"electric_blankets_on","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":165,"y":285,"wires":[["1c6bbe18.beb282"]]},{"id":"1c6bbe18.beb282","type":"template","z":"738f0112.d0a3e","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{payload.event.name}}","output":"str","x":390,"y":285,"wires":[["854ff464.bff9e8"]]},{"id":"60c6cfc8.e102c","type":"switch","z":"738f0112.d0a3e","name":"Who's Electric blanket","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"kids","vt":"str"},{"t":"eq","v":"nico","vt":"str"},{"t":"eq","v":"max","vt":"str"},{"t":"eq","v":"dick","vt":"str"},{"t":"eq","v":"tamara","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":1000,"y":285,"wires":[["4f9e2493.d0bcdc","7865782.a6fa588"],["4f9e2493.d0bcdc"],["7865782.a6fa588"],["f4538451.f208b8"],["43bae0a9.e5649"]]},{"id":"6faf5ebd.a6cc8","type":"api-current-state","z":"738f0112.d0a3e","name":"Max: Home","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.presence_location_max","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":190,"y":495,"wires":[["59bfade4.671774"],[]],"outputLabels":["true","false"]},{"id":"8cbf5658.9244d8","type":"api-current-state","z":"738f0112.d0a3e","name":"Nico: Home","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.presence_location_nico","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":190,"y":435,"wires":[["bb8483c0.5c2128"],[]],"outputLabels":["true","false"]},{"id":"94ceb8c0.5ce6d8","type":"link in","z":"738f0112.d0a3e","name":"Max","links":["7865782.a6fa588"],"x":60,"y":495,"wires":[["6faf5ebd.a6cc8"]]},{"id":"7fb857a1.cf6a38","type":"link in","z":"738f0112.d0a3e","name":"Nico","links":["4f9e2493.d0bcdc"],"x":60,"y":435,"wires":[["8cbf5658.9244d8"]]},{"id":"f4538451.f208b8","type":"link out","z":"738f0112.d0a3e","name":"Dick","links":["31f082f1.cd0f66"],"x":1200,"y":315,"wires":[]},{"id":"43bae0a9.e5649","type":"link out","z":"738f0112.d0a3e","name":"Tamara","links":["15d7be88.50bd91"],"x":1200,"y":360,"wires":[]},{"id":"4f9e2493.d0bcdc","type":"link out","z":"738f0112.d0a3e","name":"Nico","links":["7fb857a1.cf6a38"],"x":1200,"y":225,"wires":[]},{"id":"7865782.a6fa588","type":"link out","z":"738f0112.d0a3e","name":"Max","links":["94ceb8c0.5ce6d8"],"x":1200,"y":270,"wires":[]},{"id":"310b0b5.b0d58f4","type":"comment","z":"738f0112.d0a3e","name":"Electric blankets: Condition Check","info":"","x":155,"y":390,"wires":[]},{"id":"f515aa60.53f108","type":"api-current-state","z":"738f0112.d0a3e","name":"Is school tomorrow?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.school_tomorrow","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":430,"y":615,"wires":[["ad1fd286.af05e"],[]],"outputLabels":["true","false"]},{"id":"13f83eef.667791","type":"api-current-state","z":"738f0112.d0a3e","name":"Nico electric blanket: ON?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.bedroom_nico_electric_blanket","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":975,"y":435,"wires":[[],["988a219f.661de"]],"outputLabels":["true","false"]},{"id":"440d609c.82c39","type":"api-current-state","z":"738f0112.d0a3e","name":"Max electric blanket: ON?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.bedroom_max_electric_blanket","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":975,"y":495,"wires":[[],["58d28f09.526e4"]],"outputLabels":["true","false"]},{"id":"988a219f.661de","type":"api-call-service","z":"738f0112.d0a3e","name":"Nico electric blanket: ON","server":"d2144d44.18e","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.bedroom_nico_electric_blanket","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1275,"y":435,"wires":[[]]},{"id":"58d28f09.526e4","type":"api-call-service","z":"738f0112.d0a3e","name":"Max electric blanket: ON","server":"d2144d44.18e","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.bedroom_max_electric_blanket","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1275,"y":495,"wires":[[]]},{"id":"d27c0024.77211","type":"api-current-state","z":"738f0112.d0a3e","name":"Dick electric blanket: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.bedroom_master_electric_blanket_dick","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":695,"y":555,"wires":[[],["3c4db76e.8aac88"]],"outputLabels":["true","false"]},{"id":"3c4db76e.8aac88","type":"api-call-service","z":"738f0112.d0a3e","name":"Dick electric blanket: ON","server":"d2144d44.18e","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.bedroom_master_electric_blanket_dick","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":995,"y":555,"wires":[[]]},{"id":"ad1fd286.af05e","type":"api-current-state","z":"738f0112.d0a3e","name":"Tamara electric blanket: ON?","server":"d2144d44.18e","version":"1","outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.bedroom_master_electric_blanket_tamara","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":705,"y":615,"wires":[[],["c9dee2b1.4fc0d"]],"outputLabels":["true","false"]},{"id":"c9dee2b1.4fc0d","type":"api-call-service","z":"738f0112.d0a3e","name":"Tamara electric blanket: ON","server":"d2144d44.18e","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.bedroom_master_electric_blanket_tamara","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1005,"y":615,"wires":[[]]},{"id":"ebff35f6.bafc08","type":"ha-fire-event","z":"211f6eb6.d4fab2","name":"Event: electric_blankets_on (Kids)","server":"d2144d44.18e","event":"electric_blankets_on","data":"{\"name\":\"kids\"}","dataType":"json","x":410,"y":690,"wires":[[]]},{"id":"34d40fb4.289a4","type":"comment","z":"738f0112.d0a3e","name":"Electric blankets: Event","info":"","x":115,"y":45,"wires":[]},{"id":"6f1f9da1.047694","type":"ha-fire-event","z":"738f0112.d0a3e","name":"Event: electric_blankets_on (Dick)","server":"d2144d44.18e","event":"electric_blankets_on","data":"{\"name\":\"dick\"}","dataType":"json","x":560,"y":75,"wires":[[]]},{"id":"ea5ad31.2e5e13","type":"ha-fire-event","z":"738f0112.d0a3e","name":"Event: electric_blankets_on (Tamara)","server":"d2144d44.18e","event":"electric_blankets_on","data":"{\"name\":\"tamara\"}","dataType":"json","x":570,"y":135,"wires":[[]]},{"id":"294947ed.7ec7e8","type":"api-call-service","z":"fe0fe1f5.2651","name":"Notify Dick","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"title\":\"Medicine Reminder\",\"message\":\"Remember your stop smoking meds!\",\"data\":{\"push\":{\"category\":\"dick_medicine_reminder\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1105,"y":3090,"wires":[[]]},{"id":"4c13aa80.a0e3d4","type":"server-events","z":"fe0fe1f5.2651","name":"All","server":"d2144d44.18e","event_type":"","x":110,"y":3015,"wires":[["5f761274.fa249c"]]},{"id":"5f761274.fa249c","type":"switch","z":"fe0fe1f5.2651","name":"What Action?","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"DICK_MEDICINE_SNOOZE","vt":"str"},{"t":"eq","v":"DICK_MEDICINE_ALREADY_TAKEN","vt":"str"},{"t":"eq","v":"DICK_MEDICINE_REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":3015,"wires":[["7bdc2ed1.f762c"],["74d9c2a1.72fecc"],["803b1b1e.fda6c8"]]},{"id":"7bdc2ed1.f762c","type":"trigger","z":"fe0fe1f5.2651","name":"","op1":"","op2":"on","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":535,"y":2970,"wires":[["294947ed.7ec7e8"]]},{"id":"74d9c2a1.72fecc","type":"api-call-service","z":"fe0fe1f5.2651","name":"Turn off","server":"d2144d44.18e","version":"1","service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.medicine_reminder_dick","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":525,"y":3015,"wires":[[]]},{"id":"803b1b1e.fda6c8","type":"hold","z":"fe0fe1f5.2651","name":"Hold until home","x":725,"y":3090,"wires":[["f9c82366.59f48","294947ed.7ec7e8"]]},{"id":"154527c4.39c328","type":"change","z":"fe0fe1f5.2651","name":"trigger","rules":[{"t":"set","p":"trigger","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":3090,"wires":[["803b1b1e.fda6c8"]]},{"id":"5fa4ff96.556ee","type":"server-state-changed","z":"fe0fe1f5.2651","name":"Dick Home","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.presence_location_dick","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":105,"y":3090,"wires":[["7c1324ef.f6f12c"],[]]},{"id":"f9c82366.59f48","type":"change","z":"fe0fe1f5.2651","name":"Delete Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":725,"y":3150,"wires":[["803b1b1e.fda6c8"]]},{"id":"c522a2c6.d737d","type":"comment","z":"fe0fe1f5.2651","name":"Actionable notifications - Medicine Reminder","info":"","x":185,"y":2895,"wires":[]},{"id":"ce8801e4.f6b4","type":"server-state-changed","z":"fe0fe1f5.2651","name":"Medine Reminder","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.medicine_reminder_dick","entityidfiltertype":"substring","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":720,"y":3210,"wires":[["294947ed.7ec7e8"],[]]},{"id":"7c1324ef.f6f12c","type":"api-current-state","z":"fe0fe1f5.2651","name":"Is Reminder on","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.medicine_reminder_dick","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":305,"y":3090,"wires":[["154527c4.39c328"],[]]},{"id":"5b1126e3.1788a8","type":"comment","z":"67513eed.6b35b","name":"Doorbell Pressed","info":"","x":95,"y":375,"wires":[]},{"id":"b82838b7.a80a28","type":"api-current-state","z":"6159802b.d3238","name":"Dark Outside?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.dark_outside","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":true,"x":770,"y":195,"wires":[["44784086.0d328"],[]],"outputLabels":["yes","no"]},{"id":"38651f74.b423","type":"api-call-service","z":"6159802b.d3238","name":"Turn: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"${LIGHT}","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1575,"y":210,"wires":[[]]},{"id":"966b622c.b5a02","type":"trigger","z":"6159802b.d3238","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"${WAIT_TIME}","extend":false,"units":"min","reset":"true","bytopic":"all","topic":"topic","outputs":1,"x":395,"y":300,"wires":[["8aeb2fe1.0df4a"]]},{"id":"ff36d8a2.72aed8","type":"switch","z":"6159802b.d3238","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":185,"y":240,"wires":[["966b622c.b5a02","9f582a18.36c068"],["966b622c.b5a02"],["966b622c.b5a02"]]},{"id":"8591a5da.12c5d8","type":"api-call-service","z":"6159802b.d3238","name":"Turn: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"${LIGHT}","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1575,"y":300,"wires":[[]]},{"id":"8aeb2fe1.0df4a","type":"api-current-state","z":"6159802b.d3238","name":"Light: ON?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"${LIGHT}","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":true,"x":760,"y":300,"wires":[["8591a5da.12c5d8"],[]]},{"id":"48ad9bf8.8f34c4","type":"status","z":"6159802b.d3238","name":"","scope":null,"x":120,"y":390,"wires":[[]]},{"id":"5c32f34f.31682c","type":"api-call-service","z":"6159802b.d3238","name":"Turn: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"${LIGHT}","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1575,"y":120,"wires":[[]]},{"id":"94718395.2e2f2","type":"time-range-switch","z":"6159802b.d3238","name":"Early Morning?","lat":"-41.168701","lon":"174.818679","startTime":"00:00","endTime":"06:15","startOffset":"","endOffset":"","x":1220,"y":120,"wires":[["7895a206.675a6c"],["ddf8e9dc.3a0198"]],"outputLabels":["yes","no"]},{"id":"ddf8e9dc.3a0198","type":"change","z":"6159802b.d3238","name":"Bright","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"data","pt":"msg"},{"t":"set","p":"payload.data","pt":"msg","to":"{\"brightness\":255}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":150,"wires":[["5c32f34f.31682c"]]},{"id":"7895a206.675a6c","type":"change","z":"6159802b.d3238","name":"Dimmed","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"data","pt":"msg"},{"t":"set","p":"payload.data","pt":"msg","to":"{\"brightness\":30}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":90,"wires":[["5c32f34f.31682c"]]},{"id":"b4293422.d43168","type":"api-current-state","z":"6159802b.d3238","name":"Luminance","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"${LUX_VALUE}","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"${LUX_SENSOR}","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":true,"x":760,"y":135,"wires":[["44784086.0d328"],[]]},{"id":"d89aae.1207355","type":"function","z":"6159802b.d3238","name":"Using LUX?","func":"const dateFns = global.get('dateFns');// import the script\n\nconst showerTimeMin = 30;\nconst showerTimeNotifyMin = 15;\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nlet lux_sensor = env.get(\"LUX_SENSOR\");\nlet lux_value = env.get(\"LUX_VALUE\");\n\nif (lux_sensor && lux_value) {\n  node.status({ fill: \"green\", shape: \"dot\", text: \"use is dark\" + nodeStatus });\n  return [msg, null];\n} else {\n  node.status({ fill: \"green\", shape: \"dot\", text: \"use lux\" + nodeStatus });\n  return [null, msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":565,"y":165,"wires":[["b4293422.d43168"],["b82838b7.a80a28"]],"outputLabels":["bed time","shower time"]},{"id":"44784086.0d328","type":"switch","z":"6159802b.d3238","name":"Dim in the morning?","property":"IS_DIMM","propertyType":"env","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1000,"y":165,"wires":[["94718395.2e2f2"],["38651f74.b423"]]},{"id":"5518d684.1caac8","type":"subflow:6159802b.d3238","z":"9e300652.e09258","name":"","env":[{"name":"LIGHT","value":"light.office_ceiling","type":"str"},{"name":"WAIT_TIME","value":"10","type":"num"},{"name":"LUX_SENSOR","value":"sensor.office_zw100_multisensor_luminance","type":"str"},{"name":"LUX_VALUE","value":"20","type":"num"},{"name":"LIGHT_ENTITY","value":"light.office_shelf","type":"str"}],"x":550,"y":75,"wires":[[]]},{"id":"f01128b3.b256f8","type":"server-state-changed","z":"9e300652.e09258","name":"Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Office Lights"},{"property":"icon","value":"mdi:head-lightbulb-outline"}],"entityidfilter":"binary_sensor.office_zw100_multisensor_motion","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":75,"wires":[["5518d684.1caac8"],["5518d684.1caac8"]]},{"id":"88b03e5b.ea756","type":"server-state-changed","z":"9e300652.e09258","name":"Disable Automation","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_office_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":135,"wires":[["fecd2d0c.d941f"],[]]},{"id":"fecd2d0c.d941f","type":"change","z":"9e300652.e09258","name":"Stop Timer","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":135,"wires":[["5518d684.1caac8"]]},{"id":"b51a38dd.109e88","type":"subflow:6159802b.d3238","z":"665eecf8.0e9db4","name":"","env":[{"name":"LIGHT","value":"light.bathroom_zw111_nano_dimmer","type":"str"},{"name":"WAIT_TIME","value":"5","type":"num"},{"name":"IS_DIMM","value":"true","type":"bool"},{"name":"LUX_SENSOR","value":"sensor.bathroom_multisensor_luminance","type":"str"},{"name":"LUX_VALUE","value":"20","type":"num"},{"name":"LIGHT_ENTITY","value":"light.office_shelf","type":"str"}],"x":550,"y":75,"wires":[[]]},{"id":"6e70996b.cda418","type":"change","z":"665eecf8.0e9db4","name":"Stop Timer","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":135,"wires":[["b51a38dd.109e88"]]},{"id":"7bc6cb46.2157b4","type":"server-state-changed","z":"67513eed.6b35b","name":"Disable Automation","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_hall_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":135,"wires":[["234a83cf.b50bcc"],[]]},{"id":"bfe0019f.015b4","type":"subflow:6159802b.d3238","z":"67513eed.6b35b","name":"","env":[{"name":"LIGHT","value":"light.hall_zw111_nano_dimmer","type":"str"},{"name":"WAIT_TIME","value":"2","type":"num"},{"name":"IS_DIMM","value":"true","type":"bool"},{"name":"LUX_SENSOR","value":"sensor.hall_multisensor_luminance","type":"str"},{"name":"LUX_VALUE","value":"10","type":"num"},{"name":"LIGHT_ENTITY","value":"light.office_shelf","type":"str"}],"x":550,"y":75,"wires":[[]]},{"id":"234a83cf.b50bcc","type":"change","z":"67513eed.6b35b","name":"Stop Timer","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":135,"wires":[["bfe0019f.015b4"]]},{"id":"21d00dd9.51beb2","type":"subflow:6159802b.d3238","z":"b715c3d5.53027","name":"","env":[{"name":"LIGHT","value":"light.dining_room_ceiling","type":"str"},{"name":"LIGHT_ENTITY","value":"light.office_shelf","type":"str"}],"x":550,"y":75,"wires":[[]]},{"id":"6b2a8154.0211b","type":"server-state-changed","z":"b715c3d5.53027","name":"Disable Automation","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_dining_room_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":135,"wires":[["d7ce5abf.7a09e8"],[]]},{"id":"d7ce5abf.7a09e8","type":"change","z":"b715c3d5.53027","name":"Stop Timer","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":135,"wires":[["21d00dd9.51beb2"]]},{"id":"f81b0a19.8c6d38","type":"subflow:6159802b.d3238","z":"827aa7bb.e776e8","name":"","env":[{"name":"LIGHT","value":"light.living_room_ceiling","type":"str"},{"name":"WAIT_TIME","value":"20","type":"num"},{"name":"LUX_SENSOR","value":"sensor.living_room_multisensor_luminance","type":"str"},{"name":"LUX_VALUE","value":"20","type":"num"},{"name":"LIGHT_ENTITY","value":"light.office_shelf","type":"str"}],"x":550,"y":75,"wires":[[]]},{"id":"bbd37059.bbcf7","type":"server-state-changed","z":"827aa7bb.e776e8","name":"Disable Automation","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_living_room_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":135,"wires":[["aa2088fd.56c3f8"],[]]},{"id":"aa2088fd.56c3f8","type":"change","z":"827aa7bb.e776e8","name":"Stop Timer","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":135,"wires":[["f81b0a19.8c6d38"]]},{"id":"9f582a18.36c068","type":"api-current-state","z":"6159802b.d3238","name":"Light: OFF?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":true,"entity_id":"${LIGHT}","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":true,"x":385,"y":165,"wires":[["d89aae.1207355"],[]],"outputLabels":["yes","no"]},{"id":"d4b6d3fb.3b83c","type":"api-current-state","z":"7be81a90.d7d494","name":"Below Horizon","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"below_horizon","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sun.sun","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":635,"y":420,"wires":[["b2544587.73bc18"],[]],"outputLabels":["ON","OFF"]},{"id":"d633f30a.537fa","type":"server-state-changed","z":"7be81a90.d7d494","name":"Sun","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sun.sun","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"below_horizon","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":95,"y":495,"wires":[["9d648b1a.483fc8"],["9d648b1a.483fc8"]]},{"id":"9d648b1a.483fc8","type":"api-current-state","z":"7be81a90.d7d494","name":"Automation Enabled?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_kitchen_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":385,"y":495,"wires":[["5511f95e.506e18","d4b6d3fb.3b83c"],[]],"outputLabels":["ON","OFF"]},{"id":"3726a39c.9c2d4c","type":"server-state-changed","z":"7e73eced.d8a9cc","name":"Luminance > 100","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.man_cave_multisensor_luminance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"100","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"x":125,"y":495,"wires":[["ad8b0f56.2e2ce"],[]]},{"id":"67a10cb9.c459e4","type":"link in","z":"88e98901.be25b8","name":"Stop Computer light timer","links":["c6f4c876.28f968","e3c65335.857e6"],"x":450,"y":285,"wires":[["9cea8794.791108"]]},{"id":"c9c7c24e.cc314","type":"comment","z":"88e98901.be25b8","name":"Man Cave Kitchen Light Off","info":"","x":135,"y":45,"wires":[]},{"id":"8b0cebb.5bec218","type":"server-state-changed","z":"88e98901.be25b8","name":"Automation Enabled","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nodered_man_cave_kitchen_lights","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":135,"y":195,"wires":[["696fd0df.5c6f4","4d30bed3.1daaf"],["696fd0df.5c6f4","4d30bed3.1daaf"]]},{"id":"955ac2bd.0c994","type":"trigger","z":"88e98901.be25b8","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"5","extend":true,"units":"min","reset":"false","bytopic":"all","outputs":1,"x":835,"y":105,"wires":[["4b672d8a.511fb4"]]},{"id":"9cea8794.791108","type":"switch","z":"88e98901.be25b8","name":"Light Check","property":"data.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"switch.man_cave_kitchen_ceiling_one","vt":"str"},{"t":"eq","v":"switch.man_cave_kitchen_ceiling_two","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":640,"y":105,"wires":[["955ac2bd.0c994"],["955ac2bd.0c994"]],"outputLabels":["one","two"]},{"id":"6a7b66fe.ac1678","type":"api-call-service","z":"88e98901.be25b8","name":"Lights: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1195,"y":225,"wires":[[]]},{"id":"151db7ee.e2ea38","type":"api-current-state","z":"88e98901.be25b8","name":"3D Printer Power > 15","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"15","halt_if_type":"num","halt_if_compare":"gt","override_topic":false,"entity_id":"sensor.ender_3_power","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1060,"y":165,"wires":[["e3c65335.857e6"],["4d6a11cc.490c5"]],"outputLabels":["true","false"]},{"id":"e3c65335.857e6","type":"link out","z":"88e98901.be25b8","name":"Is Busy","links":["67a10cb9.c459e4"],"x":1290,"y":135,"wires":[]},{"id":"4b672d8a.511fb4","type":"api-current-state","z":"88e98901.be25b8","name":"Computer Desk Power > 15","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"15","halt_if_type":"num","halt_if_compare":"gt","override_topic":true,"entity_id":"sensor.computer_desk_power","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1080,"y":105,"wires":[["e3c65335.857e6"],["151db7ee.e2ea38"]],"outputLabels":["Yes","No"]},{"id":"4d6a11cc.490c5","type":"template","z":"88e98901.be25b8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\t\"data\": {\n\t\t\"entity_id\": \"{{data.entity_id}}\"\n\t}\n}","output":"json","x":1020,"y":225,"wires":[["6a7b66fe.ac1678"]]},{"id":"696fd0df.5c6f4","type":"template","z":"88e98901.be25b8","name":"","field":"data","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\t\t\"entity_id\": \"switch.man_cave_kitchen_ceiling_one\"\n}","output":"json","x":405,"y":165,"wires":[["9cea8794.791108"]]},{"id":"4d30bed3.1daaf","type":"template","z":"88e98901.be25b8","name":"","field":"data","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\t\t\"entity_id\": \"switch.man_cave_kitchen_ceiling_two\"\n\n}","output":"json","x":405,"y":225,"wires":[["9cea8794.791108"]]},{"id":"66323b5e.539954","type":"api-current-state","z":"7be81a90.d7d494","name":"Automation Enabled?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.nodered_kitchen_lights","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":385,"y":420,"wires":[["d4b6d3fb.3b83c"],[]],"outputLabels":["ON","OFF"]},{"id":"a653ed53.aea6","type":"function","z":"34adfc8d.987374","name":"Check If Watching Movie","func":"const dateFns = global.get('dateFns');// import the script\n\nconst showerTimeMin = 30;\nconst showerTimeNotifyMin = 15;\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n// setup data\nlet sourceList = [\"Netflix\", \"Plex for Xbox One\", \"YouTube\"];\nlet state = msg.meta.state;\n\n// test conditions\nlet is_valid_source = sourceList.indexOf(meta.source) != -1;\nlet is_new_source = msg.meta.source_changed;\n\nlet is_valid = is_valid_source && is_new_source && state;\n\n// set payload\nmsg.payload.data = {};\n\nif (is_valid) {\n  node.status({ fill: \"green\", shape: \"dot\", text: \"valid\" + nodeStatus });\n  msg.payload.data.effect = \"HDMI\";\n  return [msg, null];\n} else {\n  node.status({ fill: \"red\", shape: \"dot\", text: \"not valid\" + nodeStatus });\n  return [null, msg];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":830,"y":75,"wires":[[],[]],"outputLabels":["turn_on","turn_off"]},{"id":"40eaa29a.66f5ac","type":"comment","z":"7e73eced.d8a9cc","name":"TV Backlight","info":"","x":85,"y":585,"wires":[]},{"id":"cedf8b4c.4f0138","type":"server-state-changed","z":"cae3de91.cc172","name":"Anyone Home","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.presence_anyone_home","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":115,"y":150,"wires":[["80f93d77.9af5b","aad3b072.e7f25","4042b4d5.90171c"],["80f93d77.9af5b","aad3b072.e7f25"]],"outputLabels":["true","false"]},{"id":"2817705e.d544b","type":"api-call-service","z":"cae3de91.cc172","name":"Holiday Mode: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_mode_holiday","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":870,"y":225,"wires":[[]]},{"id":"1363a7ec.42fb78","type":"api-current-state","z":"cae3de91.cc172","name":"Holiday Mode: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_holiday","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":615,"y":225,"wires":[["2817705e.d544b"],[]],"outputLabels":["true","false"]},{"id":"80f93d77.9af5b","type":"trigger","z":"cae3de91.cc172","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"3","extend":false,"units":"min","reset":"true","bytopic":"all","outputs":1,"x":385,"y":150,"wires":[["73641734.776978"]]},{"id":"aad3b072.e7f25","type":"trigger","z":"cae3de91.cc172","name":"","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"24","extend":false,"units":"hr","reset":"true","bytopic":"all","outputs":1,"x":385,"y":225,"wires":[["1363a7ec.42fb78"]]},{"id":"4042b4d5.90171c","type":"api-call-service","z":"cae3de91.cc172","name":"Away mode: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.house_mode_away","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":405,"y":75,"wires":[[]]},{"id":"73641734.776978","type":"api-call-service","z":"cae3de91.cc172","name":"Away mode: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.house_mode_away","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":605,"y":150,"wires":[[]]},{"id":"72432883.58e2a8","type":"server-state-changed","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Away mode","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.house_mode_away","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":130,"y":780,"wires":[["e7cfbc01.0806","2fd2d44d.b8129c","ddc6b832.d0afd8","e8b082c0.2029d","e6d5e82e.7dc058","4eeea039.7b00c","857111e7.7f752"],["c071a182.eccbd","c1cbd36c.780a7","c86af17c.470b4","4eeea039.7b00c"]]},{"id":"c071a182.eccbd","type":"api-current-state","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Holiday Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_holiday","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":420,"y":840,"wires":[["b7a6a20b.713da"],[]],"outputLabels":["true","false"]},{"id":"b7a6a20b.713da","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Set Holiday Mode: OFF","server":"d2144d44.18e","version":"1","service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.house_mode_holiday","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":840,"wires":[[]]},{"id":"c1cbd36c.780a7","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Set Blue Irus: Unarmed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":440,"y":900,"wires":[[]]},{"id":"c86af17c.470b4","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Alexa Guard: home","server":"d2144d44.18e","version":1,"service_domain":"alarm_control_panel","service":"alarm_disarm","entityId":"alarm_control_panel.alexa_guard_68602","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":420,"y":960,"wires":[[]]},{"id":"2fd2d44d.b8129c","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Lights: OFF","server":"d2144d44.18e","version":"1","service_domain":"light","service":"turn_off","entityId":"group.all_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":415,"y":420,"wires":[["b1e504c5.0faf28"]]},{"id":"e7cfbc01.0806","type":"function","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Turn Off electric blankets","func":"var electricBlankets = [\n  \"switch.bedroom_master_electric_blanket_dick\",\n  \"switch.bedroom_master_electric_blanket_tamara\",\n  \"switch.bedroom_max_electric_blanket\",\n  \"switch.bedroom_nico_electric_blanket\"\n];\n\nlet messages = [];\nfor (let index = 0; index < electricBlankets.length; index++) {\n    const message = {payload:{entity_id: electricBlankets[index]}};\n    node.send(message);\n}\nnode.status({fill:\"green\",shape:\"dot\",text:\"triggered\"});\n\nreturn;","outputs":1,"noerr":0,"x":455,"y":360,"wires":[["76d17d7e.221084"]]},{"id":"76d17d7e.221084","type":"api-current-state","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Is On?","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":665,"y":360,"wires":[["b169c641.3d3588"],[]],"outputLabels":["true","false"]},{"id":"b169c641.3d3588","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Switch: turn_off","server":"d2144d44.18e","version":"1","service_domain":"switch","service":"turn_off","entityId":"{{payload.entity_id}}","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":845,"y":360,"wires":[[]]},{"id":"39dd6dfd.918cf2","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Notify Dick","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"message\":\"Everyone left home and the heat pump is on.\",\"data\":{\"push\":{\"category\":\"heatpump\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":820,"y":540,"wires":[[]]},{"id":"e8b082c0.2029d","type":"api-render-template","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Is any heatpump on?","server":"d2144d44.18e","template":"{% if is_state('climate.living_room','off') and is_state('climate.man_cave','off') %}\n    false\n{% else %}\n    true\n{% endif %}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"","templateLocationType":"none","x":445,"y":540,"wires":[["2c2163fb.6da72c"]]},{"id":"2c2163fb.6da72c","type":"switch","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Is true","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":540,"wires":[["39dd6dfd.918cf2"]]},{"id":"ddc6b832.d0afd8","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Alexa Guard: Away","server":"d2144d44.18e","version":1,"service_domain":"alarm_control_panel","service":"alarm_arm_away","entityId":"alarm_control_panel.alexa_guard_68602","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":435,"y":480,"wires":[[]]},{"id":"e6d5e82e.7dc058","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Set Blue Irus: Armed","server":"d2144d44.18e","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.blue_iris","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":445,"y":660,"wires":[[]]},{"id":"c032ebf6.8319c8","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Bathroom: lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_bathroom_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1190,"y":465,"wires":[[]]},{"id":"1c038676.ad2a4a","type":"comment","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Automations","info":"","x":1150,"y":405,"wires":[]},{"id":"ae79e4e4.e35508","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Dining Room: lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_dining_room_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1200,"y":510,"wires":[[]]},{"id":"fcdd77c.600c188","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Hall: lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_hall_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1180,"y":555,"wires":[[]]},{"id":"7093c3a2.deadfc","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Kitchen: lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1190,"y":600,"wires":[[]]},{"id":"be2a0583.2a33c8","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Living Room: lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_living_room_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1200,"y":645,"wires":[[]]},{"id":"468a3b11.20aa44","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Man Cave Kitchen lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_man_cave_kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1220,"y":690,"wires":[[]]},{"id":"140045da.2c0dca","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Man Cave: Main lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_man_cave_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1210,"y":735,"wires":[[]]},{"id":"4eeea039.7b00c","type":"function","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Automations ON/OFF","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"service\": (msg.payload)? \"turn_off\": \"turn_on\"\n  },\n  \"topic\": \"Automations\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Person Detected\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"x":670,"y":780,"wires":[["c032ebf6.8319c8","ae79e4e4.e35508","fcdd77c.600c188","7093c3a2.deadfc","be2a0583.2a33c8","468a3b11.20aa44","140045da.2c0dca","b3c08824.11a828"]]},{"id":"eccccd6c.573f","type":"comment","z":"cae3de91.cc172","name":"Set house mode based on presence","info":"","x":155,"y":30,"wires":[]},{"id":"b3c08824.11a828","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Office: Lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_office_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1180,"y":780,"wires":[[]]},{"id":"dd2fb304.6a841","type":"server-state-changed","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Holiday Mode","server":"d2144d44.18e","version":1,"entityidfilter":"input_boolean.house_mode_holiday","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":130,"y":1575,"wires":[["5adf4e69.05a4c","755df0e3.2cf2e","89a7b93c.0d5fa8","35406b30.5631f4","91cf1c71.7b203","d6ea405c.3b4ea","ea603bd8.6aec88"],["8ef3ec12.77b13","142875d8.01700a","368763fc.0feccc","5f5b84b6.522d6c","628b423d.9d554c","c173b40.3e06f5","336c6ba7.6f9f84"]]},{"id":"5adf4e69.05a4c","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1125,"wires":[["8aff36be.1cfea8","5234af17.1ef31"]]},{"id":"8ef3ec12.77b13","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1185,"wires":[["8aff36be.1cfea8","5234af17.1ef31"]]},{"id":"8aff36be.1cfea8","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":1230},\"end\":{\"dow\":1,\"mod\":1245}},{\"start\":{\"dow\":1,\"mod\":1260},\"end\":{\"dow\":1,\"mod\":1275}},{\"start\":{\"dow\":2,\"mod\":1230},\"end\":{\"dow\":2,\"mod\":1245}},{\"start\":{\"dow\":3,\"mod\":1230},\"end\":{\"dow\":3,\"mod\":1245}},{\"start\":{\"dow\":4,\"mod\":1230},\"end\":{\"dow\":4,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1230},\"end\":{\"dow\":5,\"mod\":1245}},{\"start\":{\"dow\":6,\"mod\":1230},\"end\":{\"dow\":6,\"mod\":1245}},{\"start\":{\"dow\":0,\"mod\":1230},\"end\":{\"dow\":0,\"mod\":1245}},{\"start\":{\"dow\":1,\"mod\":1245},\"end\":{\"dow\":1,\"mod\":1260}},{\"start\":{\"dow\":2,\"mod\":1245},\"end\":{\"dow\":2,\"mod\":1260}},{\"start\":{\"dow\":3,\"mod\":1245},\"end\":{\"dow\":3,\"mod\":1260}},{\"start\":{\"dow\":4,\"mod\":1245},\"end\":{\"dow\":4,\"mod\":1260}},{\"start\":{\"dow\":6,\"mod\":1245},\"end\":{\"dow\":6,\"mod\":1260}},{\"start\":{\"dow\":0,\"mod\":1215},\"end\":{\"dow\":0,\"mod\":1230}},{\"start\":{\"dow\":0,\"mod\":1245},\"end\":{\"dow\":0,\"mod\":1260}},{\"start\":{\"dow\":1,\"mod\":1275},\"end\":{\"dow\":1,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1215},\"end\":{\"dow\":2,\"mod\":1230}},{\"start\":{\"dow\":4,\"mod\":1215},\"end\":{\"dow\":4,\"mod\":1230}},{\"start\":{\"dow\":5,\"mod\":1215},\"end\":{\"dow\":5,\"mod\":1230}},{\"start\":{\"dow\":6,\"mod\":1215},\"end\":{\"dow\":6,\"mod\":1230}},{\"start\":{\"dow\":3,\"mod\":1215},\"end\":{\"dow\":3,\"mod\":1230}},{\"start\":{\"dow\":1,\"mod\":1215},\"end\":{\"dow\":1,\"mod\":1230}},{\"start\":{\"dow\":2,\"mod\":1260},\"end\":{\"dow\":2,\"mod\":1275}},{\"start\":{\"dow\":2,\"mod\":1275},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":3,\"mod\":1260},\"end\":{\"dow\":3,\"mod\":1275}},{\"start\":{\"dow\":3,\"mod\":1275},\"end\":{\"dow\":3,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1260},\"end\":{\"dow\":4,\"mod\":1275}},{\"start\":{\"dow\":4,\"mod\":1275},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":5,\"mod\":1245},\"end\":{\"dow\":5,\"mod\":1260}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1275}},{\"start\":{\"dow\":5,\"mod\":1275},\"end\":{\"dow\":5,\"mod\":1290}},{\"start\":{\"dow\":6,\"mod\":1260},\"end\":{\"dow\":6,\"mod\":1275}},{\"start\":{\"dow\":6,\"mod\":1275},\"end\":{\"dow\":6,\"mod\":1290}},{\"start\":{\"dow\":0,\"mod\":1260},\"end\":{\"dow\":0,\"mod\":1275}},{\"start\":{\"dow\":0,\"mod\":1275},\"end\":{\"dow\":0,\"mod\":1290}},{\"start\":{\"dow\":1,\"mod\":1305},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":1305},\"end\":{\"dow\":2,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":1320},\"end\":{\"dow\":2,\"mod\":1335}},{\"start\":{\"dow\":3,\"mod\":1305},\"end\":{\"dow\":3,\"mod\":1320}},{\"start\":{\"dow\":3,\"mod\":1290},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":3,\"mod\":1320},\"end\":{\"dow\":3,\"mod\":1335}},{\"start\":{\"dow\":2,\"mod\":1290},\"end\":{\"dow\":2,\"mod\":1305}},{\"start\":{\"dow\":1,\"mod\":1290},\"end\":{\"dow\":1,\"mod\":1305}},{\"start\":{\"dow\":1,\"mod\":1320},\"end\":{\"dow\":1,\"mod\":1335}},{\"start\":{\"dow\":4,\"mod\":1290},\"end\":{\"dow\":4,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1305},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":4,\"mod\":1320},\"end\":{\"dow\":4,\"mod\":1335}},{\"start\":{\"dow\":5,\"mod\":1290},\"end\":{\"dow\":5,\"mod\":1305}},{\"start\":{\"dow\":5,\"mod\":1305},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1320},\"end\":{\"dow\":5,\"mod\":1335}},{\"start\":{\"dow\":6,\"mod\":1290},\"end\":{\"dow\":6,\"mod\":1305}},{\"start\":{\"dow\":6,\"mod\":1305},\"end\":{\"dow\":6,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1320},\"end\":{\"dow\":6,\"mod\":1335}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":0,\"mod\":1305}},{\"start\":{\"dow\":0,\"mod\":1305},\"end\":{\"dow\":0,\"mod\":1320}},{\"start\":{\"dow\":0,\"mod\":1320},\"end\":{\"dow\":0,\"mod\":1335}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"6","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":1125,"wires":[["4472af1c.0323a"]]},{"id":"755df0e3.2cf2e","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1290,"wires":[["a330fd84.e75f1"]]},{"id":"142875d8.01700a","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1350,"wires":[["a330fd84.e75f1"]]},{"id":"a330fd84.e75f1","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":1245},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":1230},\"end\":{\"dow\":2,\"mod\":1305}},{\"start\":{\"dow\":3,\"mod\":1245},\"end\":{\"dow\":3,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1245},\"end\":{\"dow\":6,\"mod\":1320}},{\"start\":{\"dow\":4,\"mod\":1230},\"end\":{\"dow\":4,\"mod\":1290}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"15","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":1320,"wires":[["cd3b63c4.6af59"]]},{"id":"56efb5c4.97dcac","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Hall","info":"","x":395,"y":1080,"wires":[]},{"id":"4283856f.76ec1c","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Living Room","info":"","x":415,"y":1245,"wires":[]},{"id":"89a7b93c.0d5fa8","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1455,"wires":[["5f6547c1.2c1fe8"]]},{"id":"368763fc.0feccc","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1515,"wires":[["5f6547c1.2c1fe8"]]},{"id":"5f6547c1.2c1fe8","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":1245},\"end\":{\"dow\":1,\"mod\":1260}},{\"start\":{\"dow\":1,\"mod\":1305},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":1275},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1305},\"end\":{\"dow\":2,\"mod\":1320}},{\"start\":{\"dow\":3,\"mod\":1230},\"end\":{\"dow\":3,\"mod\":1245}},{\"start\":{\"dow\":3,\"mod\":1260},\"end\":{\"dow\":3,\"mod\":1275}},{\"start\":{\"dow\":3,\"mod\":1290},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1245},\"end\":{\"dow\":4,\"mod\":1260}},{\"start\":{\"dow\":4,\"mod\":1275},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1305},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1305},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1335},\"end\":{\"dow\":6,\"mod\":1350}},{\"start\":{\"dow\":5,\"mod\":1335},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1260},\"end\":{\"dow\":6,\"mod\":1275}},{\"start\":{\"dow\":0,\"mod\":1245},\"end\":{\"dow\":0,\"mod\":1260}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":0,\"mod\":1305}},{\"start\":{\"dow\":2,\"mod\":1230},\"end\":{\"dow\":2,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1230},\"end\":{\"dow\":5,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1275}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"6","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":1485,"wires":[["18557aee.204745"]]},{"id":"993777e2.1196f8","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Master Bedroom","info":"","x":425,"y":1410,"wires":[]},{"id":"374d93e3.0833fc","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Nico Bedroom","info":"","x":415,"y":1575,"wires":[]},{"id":"9246aa78.e5ebe8","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Max Bedroom","info":"","x":415,"y":1755,"wires":[]},{"id":"30c3292c.5fc0f6","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Man Cave","info":"","x":405,"y":1950,"wires":[]},{"id":"35406b30.5631f4","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":2010,"wires":[["c69b3759.3b4078"]]},{"id":"5f5b84b6.522d6c","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":2070,"wires":[["c69b3759.3b4078"]]},{"id":"c69b3759.3b4078","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":2,\"mod\":1215},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":3,\"mod\":1230},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1245},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":1,\"mod\":1260},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1260},\"end\":{\"dow\":6,\"mod\":1350}},{\"start\":{\"dow\":0,\"mod\":1215},\"end\":{\"dow\":0,\"mod\":1275}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"30","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":2040,"wires":[["de93f29.4596e1"]]},{"id":"de93f29.4596e1","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Man Cave Main Light","server":"d2144d44.18e","version":1,"service_domain":"light","service":"","entityId":"light.man_cave_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":2040,"wires":[[]]},{"id":"59bb1526.3936bc","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Max Bedroom Light","server":"d2144d44.18e","version":1,"service_domain":"light","service":"","entityId":"light.max_bedroom_main_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":1830,"wires":[[]]},{"id":"377216c7.08bbca","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Nico Bedroom Light","server":"d2144d44.18e","version":1,"service_domain":"light","service":"","entityId":"light.nico_bedroom_main_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":1650,"wires":[[]]},{"id":"18557aee.204745","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Master Bedroom Light","server":"d2144d44.18e","version":1,"service_domain":"light","service":"","entityId":"light.master_bedroom_main_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":1485,"wires":[[]]},{"id":"cd3b63c4.6af59","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Living Room Light","server":"d2144d44.18e","version":1,"service_domain":"light","service":"","entityId":"light.living_room_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":1320,"wires":[[]]},{"id":"4472af1c.0323a","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Hall Light","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"","entityId":"light.hall_zw111_nano_dimmer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1020,"y":1155,"wires":[[]]},{"id":"ed3b905c.6135d","type":"comment","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Kitchen","info":"","x":395,"y":2130,"wires":[]},{"id":"91cf1c71.7b203","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":2190,"wires":[["305ab587.0cca2a"]]},{"id":"628b423d.9d554c","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":2250,"wires":[["305ab587.0cca2a"]]},{"id":"305ab587.0cca2a","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":2,\"mod\":1215},\"end\":{\"dow\":2,\"mod\":1245}},{\"start\":{\"dow\":3,\"mod\":1215},\"end\":{\"dow\":3,\"mod\":1245}},{\"start\":{\"dow\":4,\"mod\":1215},\"end\":{\"dow\":4,\"mod\":1245}},{\"start\":{\"dow\":1,\"mod\":1215},\"end\":{\"dow\":1,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1215},\"end\":{\"dow\":5,\"mod\":1245}},{\"start\":{\"dow\":6,\"mod\":1215},\"end\":{\"dow\":6,\"mod\":1245}},{\"start\":{\"dow\":0,\"mod\":1215},\"end\":{\"dow\":0,\"mod\":1245}},{\"start\":{\"dow\":1,\"mod\":1260},\"end\":{\"dow\":1,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1260},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":3,\"mod\":1260},\"end\":{\"dow\":3,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1260},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1290}},{\"start\":{\"dow\":6,\"mod\":1260},\"end\":{\"dow\":6,\"mod\":1290}},{\"start\":{\"dow\":0,\"mod\":1260},\"end\":{\"dow\":0,\"mod\":1290}},{\"start\":{\"dow\":1,\"mod\":1320},\"end\":{\"dow\":1,\"mod\":1350}},{\"start\":{\"dow\":2,\"mod\":1305},\"end\":{\"dow\":2,\"mod\":1335}},{\"start\":{\"dow\":3,\"mod\":1320},\"end\":{\"dow\":3,\"mod\":1350}},{\"start\":{\"dow\":4,\"mod\":1305},\"end\":{\"dow\":4,\"mod\":1335}},{\"start\":{\"dow\":5,\"mod\":1320},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1305},\"end\":{\"dow\":6,\"mod\":1335}},{\"start\":{\"dow\":0,\"mod\":1320},\"end\":{\"dow\":0,\"mod\":1350}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"20","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":2220,"wires":[["bdbb1ddf.17cae"]]},{"id":"bdbb1ddf.17cae","type":"api-call-service","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Kitchen Main Light","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.kitchen_ceiling","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":2220,"wires":[[]]},{"id":"45583d92.2e4de4","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":1245},\"end\":{\"dow\":1,\"mod\":1260}},{\"start\":{\"dow\":1,\"mod\":1305},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":1275},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1305},\"end\":{\"dow\":2,\"mod\":1320}},{\"start\":{\"dow\":3,\"mod\":1230},\"end\":{\"dow\":3,\"mod\":1245}},{\"start\":{\"dow\":3,\"mod\":1260},\"end\":{\"dow\":3,\"mod\":1275}},{\"start\":{\"dow\":3,\"mod\":1290},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1245},\"end\":{\"dow\":4,\"mod\":1260}},{\"start\":{\"dow\":4,\"mod\":1275},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1305},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1305},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1335},\"end\":{\"dow\":6,\"mod\":1350}},{\"start\":{\"dow\":5,\"mod\":1335},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1260},\"end\":{\"dow\":6,\"mod\":1275}},{\"start\":{\"dow\":0,\"mod\":1245},\"end\":{\"dow\":0,\"mod\":1260}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":0,\"mod\":1305}},{\"start\":{\"dow\":2,\"mod\":1230},\"end\":{\"dow\":2,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1230},\"end\":{\"dow\":5,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1275}},{\"start\":{\"dow\":1,\"mod\":525},\"end\":{\"dow\":1,\"mod\":570}},{\"start\":{\"dow\":2,\"mod\":540},\"end\":{\"dow\":2,\"mod\":570}},{\"start\":{\"dow\":3,\"mod\":510},\"end\":{\"dow\":3,\"mod\":555}},{\"start\":{\"dow\":4,\"mod\":525},\"end\":{\"dow\":4,\"mod\":570}},{\"start\":{\"dow\":5,\"mod\":555},\"end\":{\"dow\":5,\"mod\":585}},{\"start\":{\"dow\":6,\"mod\":540},\"end\":{\"dow\":6,\"mod\":570}},{\"start\":{\"dow\":0,\"mod\":540},\"end\":{\"dow\":0,\"mod\":585}},{\"start\":{\"dow\":1,\"mod\":600},\"end\":{\"dow\":1,\"mod\":615}},{\"start\":{\"dow\":3,\"mod\":615},\"end\":{\"dow\":3,\"mod\":630}},{\"start\":{\"dow\":5,\"mod\":615},\"end\":{\"dow\":5,\"mod\":630}},{\"start\":{\"dow\":0,\"mod\":615},\"end\":{\"dow\":0,\"mod\":630}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"10","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":1650,"wires":[["377216c7.08bbca"]]},{"id":"d6ea405c.3b4ea","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1620,"wires":[["45583d92.2e4de4"]]},{"id":"c173b40.3e06f5","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1680,"wires":[["45583d92.2e4de4"]]},{"id":"a5da5a2.3709ca8","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":1245},\"end\":{\"dow\":1,\"mod\":1260}},{\"start\":{\"dow\":1,\"mod\":1305},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":1275},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1305},\"end\":{\"dow\":2,\"mod\":1320}},{\"start\":{\"dow\":3,\"mod\":1230},\"end\":{\"dow\":3,\"mod\":1245}},{\"start\":{\"dow\":3,\"mod\":1260},\"end\":{\"dow\":3,\"mod\":1275}},{\"start\":{\"dow\":3,\"mod\":1290},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1245},\"end\":{\"dow\":4,\"mod\":1260}},{\"start\":{\"dow\":4,\"mod\":1275},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1305},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1305},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1335},\"end\":{\"dow\":6,\"mod\":1350}},{\"start\":{\"dow\":5,\"mod\":1335},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1260},\"end\":{\"dow\":6,\"mod\":1275}},{\"start\":{\"dow\":0,\"mod\":1245},\"end\":{\"dow\":0,\"mod\":1260}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":0,\"mod\":1305}},{\"start\":{\"dow\":2,\"mod\":1230},\"end\":{\"dow\":2,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1230},\"end\":{\"dow\":5,\"mod\":1245}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1275}},{\"start\":{\"dow\":1,\"mod\":540},\"end\":{\"dow\":1,\"mod\":585}},{\"start\":{\"dow\":2,\"mod\":525},\"end\":{\"dow\":2,\"mod\":555}},{\"start\":{\"dow\":3,\"mod\":540},\"end\":{\"dow\":3,\"mod\":585}},{\"start\":{\"dow\":4,\"mod\":525},\"end\":{\"dow\":4,\"mod\":570}},{\"start\":{\"dow\":5,\"mod\":540},\"end\":{\"dow\":5,\"mod\":570}},{\"start\":{\"dow\":6,\"mod\":525},\"end\":{\"dow\":6,\"mod\":555}},{\"start\":{\"dow\":0,\"mod\":555},\"end\":{\"dow\":0,\"mod\":585}},{\"start\":{\"dow\":1,\"mod\":600},\"end\":{\"dow\":1,\"mod\":615}},{\"start\":{\"dow\":2,\"mod\":615},\"end\":{\"dow\":2,\"mod\":630}},{\"start\":{\"dow\":4,\"mod\":600},\"end\":{\"dow\":4,\"mod\":615}},{\"start\":{\"dow\":0,\"mod\":615},\"end\":{\"dow\":0,\"mod\":630}},{\"start\":{\"dow\":6,\"mod\":435},\"end\":{\"dow\":6,\"mod\":450}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"10","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":1830,"wires":[["59bb1526.3936bc"]]},{"id":"ea603bd8.6aec88","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Start","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1800,"wires":[["a5da5a2.3709ca8"]]},{"id":"336c6ba7.6f9f84","type":"change","z":"cae3de91.cc172","g":"4a94f2a1.94235c","name":"Stop","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":1860,"wires":[["a5da5a2.3709ca8"]]},{"id":"5234af17.1ef31","type":"light-scheduler","z":"cae3de91.cc172","g":"4a94f2a1.94235c","settings":"fc2a6602.88cb38","events":"[{\"start\":{\"dow\":1,\"mod\":90},\"end\":{\"dow\":1,\"mod\":105}},{\"start\":{\"dow\":2,\"mod\":180},\"end\":{\"dow\":2,\"mod\":195}},{\"start\":{\"dow\":4,\"mod\":120},\"end\":{\"dow\":4,\"mod\":135}},{\"start\":{\"dow\":6,\"mod\":180},\"end\":{\"dow\":6,\"mod\":195}},{\"start\":{\"dow\":5,\"mod\":150},\"end\":{\"dow\":5,\"mod\":165}},{\"start\":{\"dow\":0,\"mod\":240},\"end\":{\"dow\":0,\"mod\":255}},{\"start\":{\"dow\":1,\"mod\":1380},\"end\":{\"dow\":1,\"mod\":1395}},{\"start\":{\"dow\":3,\"mod\":1380},\"end\":{\"dow\":3,\"mod\":1395}},{\"start\":{\"dow\":5,\"mod\":1350},\"end\":{\"dow\":5,\"mod\":1365}},{\"start\":{\"dow\":4,\"mod\":1305},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1305},\"end\":{\"dow\":6,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1350},\"end\":{\"dow\":6,\"mod\":1365}},{\"start\":{\"dow\":0,\"mod\":1380},\"end\":{\"dow\":0,\"mod\":1395}},{\"start\":{\"dow\":1,\"mod\":1320},\"end\":{\"dow\":1,\"mod\":1335}},{\"start\":{\"dow\":2,\"mod\":1395},\"end\":{\"dow\":2,\"mod\":1410}},{\"start\":{\"dow\":4,\"mod\":1395},\"end\":{\"dow\":4,\"mod\":1410}}]","topic":"Schedule","name":"Schedule","onPayload":"{\"service\":\"turn_on\"}","onPayloadType":"json","offPayload":"{\"service\":\"turn_off\"}","offPayloadType":"json","onlyWhenDark":false,"scheduleRndMax":"5","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":855,"y":1185,"wires":[["4472af1c.0323a"]]},{"id":"fd8ff069.a6fec","type":"change","z":"34adfc8d.987374","name":"Setup Data","rules":[{"t":"set","p":"meta","pt":"msg","to":"{\t\"source_changed\":$.data.new_state.attributes.source != $.data.old_state.attributes.source,\t\"source\": $.data.new_state.attributes.source,\t\"state\":$.payload\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":565,"y":45,"wires":[["a653ed53.aea6"]]},{"id":"7dbb7ab3.66ca74","type":"server-state-changed","z":"34adfc8d.987374","name":"Luminance","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"${LUX_SENSOR}","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"${LUX_VALUE}","halt_if_type":"num","halt_if_compare":"lte","outputs":2,"output_only_on_state_change":false,"x":90,"y":120,"wires":[["fd1d5c93.e2426"],[]]},{"id":"8710d989.762638","type":"server-state-changed","z":"34adfc8d.987374","name":"Media Player","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"${MEDIA_PLAYER}","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":100,"y":45,"wires":[["7943249d.4ba6cc"],["7943249d.4ba6cc"]]},{"id":"7943249d.4ba6cc","type":"api-current-state","z":"34adfc8d.987374","name":"Luminance","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"${LUX_VALUE}","halt_if_type":"num","halt_if_compare":"lte","override_topic":false,"entity_id":"${LUX_SENSOR}","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":true,"x":310,"y":45,"wires":[["fd8ff069.a6fec"],[]]},{"id":"cc5fa642.07a038","type":"change","z":"34adfc8d.987374","name":"Setup Data","rules":[{"t":"set","p":"meta","pt":"msg","to":"{\t\"source_changed\":true,\t\"source\": $.data.attributes.source,\t\"state\":$.payload\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":565,"y":120,"wires":[["a653ed53.aea6"]]},{"id":"fd1d5c93.e2426","type":"api-current-state","z":"34adfc8d.987374","name":"Media Player: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"${MEDIA_PLAYER}","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":120,"wires":[["cc5fa642.07a038"],[]],"outputLabels":["Yes","No"]},{"id":"36833f52.c6249","type":"inject","z":"738f0112.d0a3e","name":"Reset","props":[{"p":"reset","v":"true","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":510,"y":720,"wires":[["b859d91f.a21d","97f8b7db.3f4f6"]]},{"id":"5c720a90.e37354","type":"function","z":"7e73eced.d8a9cc","name":"Check If Watching Movie","func":"const dateFns = global.get('dateFns');// import the script\n\nconst showerTimeMin = 30;\nconst showerTimeNotifyMin = 15;\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n// setup data\nlet sourceList = [\"Netflix\", \"Plex for Xbox One\", \"YouTube\"];\nlet state = msg.meta.state;\n\n// test conditions\nlet is_valid_source = sourceList.indexOf(msg.meta.source) != -1;\nlet is_new_source = msg.meta.source_changed;\n\nlet is_valid = is_valid_source && is_new_source && state;\n\n// set payload\nmsg.payload = {data:{}};\n\nif(is_valid){\n  node.status({ fill: \"green\", shape: \"dot\", text: msg.meta.source + nodeStatus });\n  msg.payload.data.effect = \"V4L\";\n  return [msg, null];\n} else {\n  node.status({ fill: \"red\", shape: \"dot\", text: msg.meta.source + nodeStatus });\n  return [null, msg];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":545,"y":645,"wires":[["eb6823a.c14efe"],["98627907.199e98"]],"outputLabels":["valid","invalid"]},{"id":"ae085134.4809d","type":"change","z":"7e73eced.d8a9cc","name":"Setup Data","rules":[{"t":"set","p":"meta","pt":"msg","to":"{\t\"source_changed\":$.data.new_state.attributes.source != $.data.old_state.attributes.source,\t\"source\": $.data.new_state.attributes.source,\t\"state\":$.payload\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":645,"wires":[["5c720a90.e37354"]]},{"id":"c7684c2.0cc52b","type":"server-state-changed","z":"7e73eced.d8a9cc","name":"Media Player","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.man_cave_xbox_one","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":115,"y":675,"wires":[["ae085134.4809d"],["e3b0c1a2.fdf64"]]},{"id":"8122cee6.fb5d5","type":"api-call-service","z":"7e73eced.d8a9cc","name":"TV Backlight: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.man_cave_tv_backlight","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1305,"y":615,"wires":[[]]},{"id":"e3b0c1a2.fdf64","type":"api-call-service","z":"7e73eced.d8a9cc","name":"TV Backlight: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.man_cave_tv_backlight","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":330,"y":705,"wires":[[]]},{"id":"eb6823a.c14efe","type":"api-current-state","z":"7e73eced.d8a9cc","name":"TV Backlight: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.man_cave_tv_backlight","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":795,"y":615,"wires":[["2d3c8356.538c2c"],[]],"outputLabels":["yes","no"]},{"id":"bdc84526.9f7f68","type":"api-current-state","z":"7e73eced.d8a9cc","name":"TV Backlight: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.man_cave_tv_backlight","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":960,"y":675,"wires":[["676aee8b.92f95"],[]],"outputLabels":["yes","no"]},{"id":"98627907.199e98","type":"delay","z":"7e73eced.d8a9cc","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":765,"y":680,"wires":[["bdc84526.9f7f68"]]},{"id":"676aee8b.92f95","type":"api-call-service","z":"7e73eced.d8a9cc","name":"TV Backlight: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.man_cave_tv_backlight","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1185,"y":675,"wires":[[]]},{"id":"4db9954c.7c8bbc","type":"server-state-changed","z":"7e73eced.d8a9cc","name":"Luminance < 30","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.man_cave_multisensor_luminance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"30","halt_if_type":"num","halt_if_compare":"lt","outputs":2,"output_only_on_state_change":true,"for":"10","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":125,"y":795,"wires":[["3efc164f.cf427a"],["2878c784.498d28"]]},{"id":"2d3c8356.538c2c","type":"api-current-state","z":"7e73eced.d8a9cc","name":"luminance < 30","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"30","halt_if_type":"num","halt_if_compare":"lt","override_topic":false,"entity_id":"sensor.man_cave_multisensor_luminance","state_type":"num","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1040,"y":615,"wires":[["8122cee6.fb5d5"],[]],"outputLabels":["Yes","No"]},{"id":"3efc164f.cf427a","type":"api-current-state","z":"7e73eced.d8a9cc","name":"Media Player: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.man_cave_xbox_one","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":795,"wires":[["bb659e5a.e15d"],["da4f4073.37377"]],"outputLabels":["Yes","No"]},{"id":"59448306.d86fec","type":"server-state-changed","z":"d1ecbf2b.eea86","name":"Sun","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sun.sun","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"above_horizon","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":95,"y":480,"wires":[["6dc47203.07dd4c","db8dcf.7c89b23"],[]]},{"id":"d353ee7c.d0a77","type":"server-state-changed","z":"7e73eced.d8a9cc","name":"Sun","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sun.sun","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"above_horizon","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":155,"y":435,"wires":[["ad8b0f56.2e2ce"],[]]},{"id":"bcc49512.6b0888","type":"inject","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Half hour backup","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1800","crontab":"","once":false,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":180,"y":3375,"wires":[["39ef9f0c.11af5"]]},{"id":"ae393bae.487188","type":"comment","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Save global variables","info":"","x":160,"y":3330,"wires":[]},{"id":"f70489cb.fb57b8","type":"comment","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Restore global variables","info":"","x":160,"y":3450,"wires":[]},{"id":"a56185f9.12d4e8","type":"inject","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Startup","repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":150,"y":3495,"wires":[["b9304c37.5c342"]]},{"id":"7db2aac.7443d54","type":"file","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","filename":"/data/data/global.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":790,"y":3375,"wires":[[]]},{"id":"b9304c37.5c342","type":"file in","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","filename":"/data/data/global.json","format":"utf8","sendError":true,"x":370,"y":3495,"wires":[["336c6ea8.5dee52"]]},{"id":"b4a5fc14.e8e5a","type":"function","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Restore","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nvar output = [];\n\nfor (var i=0; i<msg.payload.length; i++) {\n    switch (msg.payload[i].type) {\n        case 'undefined': \n            // the global variable probably had no value, nothing needs to be restored\n            output.push(msg.payload[i].key + \" is undefined.\");\n            break;\n        case 'number':\n            if (msg.payload[i].value===\"NaN\") {\n                // there is no valid value to be restored, skip this variable\n                output.push(msg.payload[i].key + \" is NaN.\");\n            } else {\n                if (msg.payload[i].value.toString().indexOf(\".\")>-1) {\n                    // the value appears to be a float\n                    global.set(msg.payload[i].key,parseFloat(msg.payload[i].value));\n                    output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n                } else {\n                    global.set(msg.payload[i].key,parseInt(msg.payload[i].value));\n                    output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n                }\n            }\n            break;\n        case 'string':\n            global.set(msg.payload[i].key,msg.payload[i].value);\n            output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n            break;\n        case 'boolean':\n            global.set(msg.payload[i].key,msg.payload[i].value===\"true\");\n            output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n            break;\n        default:\n            global.set(msg.payload[i].key,msg.payload[i].value);\n            output.push(msg.payload[i].key + \" is restored to object\");\n            break;\n    }\n}\n\nmsg.payload = output;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Restored\" + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":735,"y":3495,"wires":[["8f2660d1.07be9"]]},{"id":"d4010fb3.5571d","type":"json","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","x":580,"y":3375,"wires":[["7db2aac.7443d54"]]},{"id":"336c6ea8.5dee52","type":"json","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","x":575,"y":3495,"wires":[["b4a5fc14.e8e5a"]]},{"id":"8f2660d1.07be9","type":"debug","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Restored Global Variables","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":980,"y":3495,"wires":[]},{"id":"39ef9f0c.11af5","type":"function","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Prep data","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst excludeList = [\"homeassistant\"]; // list of global variables keys not to backup.\nconst globallist = global.keys(); // global variables keys\n\nexcludeList.forEach(item => {\n    const index = globallist.indexOf(item);\n    if (index !== -1) globallist.splice(index, 1);\n});\n\n\nvar outputs = [];\n\nfor (i=0; i<globallist.length; i++) {\n    outputs.push({ key : globallist[i], type: typeof global.get(globallist[i]), value: global.get(globallist[i])});\n}\n\nmsg.payload = outputs;\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Backup\" + nodeStatus });\nreturn msg;\n","outputs":1,"noerr":0,"x":390,"y":3375,"wires":[["d4010fb3.5571d"]]},{"id":"b237460a.4b8e28","type":"inject","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":3615,"wires":[["25d2a95c.ee9886"]]},{"id":"25d2a95c.ee9886","type":"function","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Set Global Variable","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst telegram = {\n    chatId: {\n        \"dick\":1082374373,\n        \"swart_ninja_smart_home_group\":-1001277388155\n    }\n}\nglobal.set(\"telegram\",telegram);\n\nmsg.topic = \"Set Global Variable\"\nmsg.payload = global.get(\"telegram\");\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Restored\" + nodeStatus });\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":3615,"wires":[["f9d4d31.e235e3"]]},{"id":"f9d4d31.e235e3","type":"debug","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":625,"y":3615,"wires":[]},{"id":"421b96d1.66b398","type":"comment","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"Set global variable","info":"","x":150,"y":3570,"wires":[]},{"id":"ce06cd07.32599","type":"comment","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"View global variable","info":"","x":150,"y":3690,"wires":[]},{"id":"2bba2950.22af16","type":"change","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"telegram.chatId.swart_ninja_smart_home_group","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":3735,"wires":[["eae0701e.ceec9"]]},{"id":"eae0701e.ceec9","type":"debug","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":625,"y":3735,"wires":[]},{"id":"fa2e9476.ef2cc8","type":"inject","z":"fe0fe1f5.2651","g":"c406c797.04a108","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":3735,"wires":[["2bba2950.22af16"]]},{"id":"bb659e5a.e15d","type":"change","z":"7e73eced.d8a9cc","name":"Setup Data","rules":[{"t":"set","p":"meta","pt":"msg","to":"{\t\"source_changed\":true,\t\"source\": $.data.attributes.source,\t\"state\":$.payload\t}","tot":"jsonata"},{"t":"delete","p":"data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":795,"wires":[["5c720a90.e37354"]]},{"id":"94527c38.33f14","type":"server-events","z":"9e300652.e09258","name":"Office 3 Gang Switch Event","server":"d2144d44.18e","event_type":"esphome.office_3gang_switch","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":165,"y":525,"wires":[["da8bade0.57e"]]},{"id":"da8bade0.57e","type":"template","z":"9e300652.e09258","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{payload.event.data}}","output":"str","x":390,"y":525,"wires":[["d9c26c97.f65f"]]},{"id":"e93d606c.aab7c","type":"api-call-service","z":"9e300652.e09258","name":"Toggle Door","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"cover","service":"toggle","entityId":"cover.office_door_system_cover","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":970,"y":495,"wires":[[]]},{"id":"4efe0921.c58368","type":"api-call-service","z":"9e300652.e09258","name":"Toggle Door","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"cover","service":"toggle","entityId":"cover.office_door_system_cover","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1495,"y":435,"wires":[[]]},{"id":"caed320.a3793d","type":"mqtt out","z":"9e300652.e09258","name":"Reset Door","topic":"E449D3/set","qos":"0","retain":"false","broker":"48e140b0.c7063","x":925,"y":585,"wires":[]},{"id":"3542f8bc.3ed378","type":"change","z":"9e300652.e09258","name":"set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":585,"wires":[["caed320.a3793d"]]},{"id":"dcfc3224.dc675","type":"server-state-changed","z":"7e73eced.d8a9cc","name":"Motion","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Man Cave Lights"},{"property":"icon","value":"mdi:pac-man"}],"entityidfilter":"binary_sensor.man_cave_motion","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":95,"y":120,"wires":[["9f11d5c1.27d0d8","86d7c79e.bb4ee8"],["86d7c79e.bb4ee8"]]},{"id":"7a5b0f28.4065c","type":"server-state-changed","z":"88e98901.be25b8","name":"Man Cave Kitchen Light: ON","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"NodeRed: Man Cave Kitchen Lights"},{"property":"icon","value":"mdi:space-invaders"}],"entityidfilter":"light.man_cave_kitchen_ceiling_\\w{3}","entityidfiltertype":"regex","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":165,"y":105,"wires":[["9cea8794.791108"],["9cea8794.791108"]]},{"id":"9e67836f.e28b1","type":"api-current-state","z":"69ac7f72.c2662","name":"Guest Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_guest","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":930,"y":825,"wires":[["fede4ee.82073b"],["6adea694.114748"]]},{"id":"74b1295e.23c5b8","type":"api-current-state","z":"69ac7f72.c2662","name":"Guest Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_guest","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":885,"y":1245,"wires":[["4df039b9.ccbad8"],["c95c3eb6.6ce1b"]]},{"id":"4df039b9.ccbad8","type":"api-call-service","z":"69ac7f72.c2662","name":"Notify: Dick","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"title\":\"Office Door Opened\",\"message\":\"Office door forced open and guest mode is on!\",\"data\":{\"push\":{\"category\":\"alarm\"}}}","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":1090,"y":1215,"wires":[[]]},{"id":"fede4ee.82073b","type":"function","z":"69ac7f72.c2662","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst triggered = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": \"Door Opened\",\n      \"message\": msg.data.new_state.attributes.friendly_name + \" opened \" + triggered + \". Guest mode is on.\",\n      \"data\": {\n        \"push\": {\n          \"category\": \"alarm\"\n        }\n      }\n    }\n  },\n  \"topic\": \"Door State Changed\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Door opened\" + triggered });\nreturn message;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1125,"y":795,"wires":[["95d8c642.3b7048"]]},{"id":"95d8c642.3b7048","type":"api-call-service","z":"69ac7f72.c2662","name":"Notify: Parents","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_parents","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"result","output_location_type":"msg","mustacheAltTags":false,"x":1310,"y":795,"wires":[[]]},{"id":"ffd6cf63.03035","type":"inject","z":"cf31d5a7.9b9f88","name":"Trigger Notification","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1290,"wires":[["96b80d4d.fe7c4"]]},{"id":"cfa4400d.dda83","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Notify Dick","server":"d2144d44.18e","version":1,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":595,"y":1290,"wires":[[]]},{"id":"96b80d4d.fe7c4","type":"function","z":"cf31d5a7.9b9f88","name":"Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst triggered = \"Triggered \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"title\": \"Test\",\n      \"message\": \"Test Man Cave image\",\n      \"data\": {\n        \"attachment\": {\n          \"content-type\": \"jpeg\",\n          \"url\": \"https://30egb3d13en0lpin3ucp0u0onyxaap1y.ui.nabu.casa/local/images/camera_snapshots/deepstack_object_mcc_latest.jpg\"\n        },\n        \"push\": {\n          \"sound\": {\n            \"name\": \"Update.caf\",\n            \"critical\": 1,\n            \"volume\": 1.0\n          }\n        },\n        \"entity_id\": \"camera.mcc\",\n      }\n    }\n  },\n  \"topic\": \"Some magic topic\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: triggered });\nreturn message;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":375,"y":1290,"wires":[["cfa4400d.dda83"]]},{"id":"49a1652a.cb9b3c","type":"comment","z":"cf31d5a7.9b9f88","name":"Image notification Test","info":"","x":130,"y":1230,"wires":[]},{"id":"1a1748ff.986c07","type":"api-current-state","z":"841dd090.abafb","name":"Away Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_away","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":350,"y":195,"wires":[["d87e5f7d.e541"],["af983f83.75ac6"]]},{"id":"af983f83.75ac6","type":"switch","z":"841dd090.abafb","name":"Indoor Cameras","property":"data.base_id","propertyType":"msg","rules":[{"t":"regex","v":"\\bDRC|\\bHLC|\\bLRC|\\bMCC|\\bOFC","vt":"str","case":true}],"checkall":"false","repair":false,"outputs":1,"x":575,"y":225,"wires":[["d87e5f7d.e541"]]},{"id":"857111e7.7f752","type":"api-current-state","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Guest Mode: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_guest","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":435,"y":600,"wires":[["b2f54843.8d6288"],[]],"outputLabels":["true","false"]},{"id":"b2f54843.8d6288","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Notify Dick","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_dick_iphone","entityId":"","data":"{\"message\":\"Everyone left home and the guest mode is on.\",\"data\":{\"push\":{\"category\":\"guest_mode\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":670,"y":600,"wires":[[]]},{"id":"3b379b83.1ae734","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Guest Mode: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.house_mode_guest","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":585,"y":840,"wires":[[]]},{"id":"1d2ed638.df077a","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Kids Sleep In Man Cave","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_kids_sleep_man_cave","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":830,"y":270,"wires":[[],["a6e20041.02c1c"]],"outputLabels":["false","true"]},{"id":"30822f9d.ad52","type":"api-current-state","z":"d1ecbf2b.eea86","name":"Kids Sleep In Man Cave","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_kids_sleep_man_cave","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":830,"y":75,"wires":[[],["9056f6bc.805a98"]],"outputLabels":["false","true"]},{"id":"c5116e59.335f8","type":"api-current-state","z":"738f0112.d0a3e","name":"Kids Sleep In Man Cave","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_kids_sleep_man_cave","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":695,"y":435,"wires":[[],["13f83eef.667791"]],"outputLabels":["false","true"]},{"id":"7d05f8d0.51b528","type":"api-current-state","z":"738f0112.d0a3e","name":"Kids Sleep In Man Cave","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_kids_sleep_man_cave","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":695,"y":495,"wires":[[],["440d609c.82c39"]],"outputLabels":["false","true"]},{"id":"da4f4073.37377","type":"api-current-state","z":"7e73eced.d8a9cc","name":"Kids Sleep In Man Cave","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_mode_kids_sleep_man_cave","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":620,"y":870,"wires":[["e2bd5253.11a2c"],[]],"outputLabels":["false","true"]},{"id":"e2bd5253.11a2c","type":"api-current-state","z":"7e73eced.d8a9cc","name":"TV Backlight: OFF","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.man_cave_tv_backlight","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":870,"y":870,"wires":[["cd53c7ca.854b58"],[]],"outputLabels":["yes","no"]},{"id":"cd53c7ca.854b58","type":"api-call-service","z":"7e73eced.d8a9cc","name":"TV Backlight: ON","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.man_cave_tv_backlight","data":"{\"effect\": \"Fire\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1110,"y":870,"wires":[[]]},{"id":"dbd4e247.8d416","type":"api-current-state","z":"7e73eced.d8a9cc","name":"TV Backlight: ON","server":"d2144d44.18e","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.man_cave_tv_backlight","state_type":"habool","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":525,"y":945,"wires":[["6e900b3b.0a1e34"],[]],"outputLabels":["yes","no"]},{"id":"2878c784.498d28","type":"delay","z":"7e73eced.d8a9cc","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":950,"wires":[["dbd4e247.8d416"]]},{"id":"6e900b3b.0a1e34","type":"api-call-service","z":"7e73eced.d8a9cc","name":"TV Backlight: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.man_cave_tv_backlight","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":750,"y":945,"wires":[[]]},{"id":"63d1b472.a9adbc","type":"server-state-changed","z":"cae3de91.cc172","g":"48728dbf.fb4df4","name":"Guest Mode","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.house_mode_guest","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":130,"y":2400,"wires":[["df53440.54e1cc"],["df53440.54e1cc"]]},{"id":"bd68572f.15d698","type":"comment","z":"cae3de91.cc172","g":"48728dbf.fb4df4","name":"Man Cave","info":"Turn off NodeRed automations if guest mode is enabled.","x":390,"y":2355,"wires":[]},{"id":"df53440.54e1cc","type":"function","z":"cae3de91.cc172","g":"48728dbf.fb4df4","name":"Automations ON/OFF","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"service\": (msg.payload)? \"turn_off\": \"turn_on\"\n  },\n  \"topic\": \"Automations\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"triggered\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":2400,"wires":[["130a79db.b26d66","93b2a52d.ed7c68"]]},{"id":"130a79db.b26d66","type":"api-call-service","z":"cae3de91.cc172","g":"48728dbf.fb4df4","name":"Man Cave Kitchen lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_man_cave_kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":860,"y":2385,"wires":[[]]},{"id":"93b2a52d.ed7c68","type":"api-call-service","z":"cae3de91.cc172","g":"48728dbf.fb4df4","name":"Man Cave: Main lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_man_cave_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":850,"y":2430,"wires":[[]]},{"id":"479d7dfd.72e714","type":"server-state-changed","z":"cae3de91.cc172","g":"4b19c391.e6820c","name":"Kids Sleep Man Cave Mode","server":"d2144d44.18e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.house_mode_kids_sleep_man_cave","entityidfiltertype":"exact","outputinitially":true,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":180,"y":2595,"wires":[["63c583f9.af06ec"],["63c583f9.af06ec"]]},{"id":"d8d1d7a8.d20d48","type":"comment","z":"cae3de91.cc172","g":"4b19c391.e6820c","name":"Man Cave","info":"Turn off NodeRed automations if guest mode is enabled.","x":390,"y":2550,"wires":[]},{"id":"63c583f9.af06ec","type":"function","z":"cae3de91.cc172","g":"4b19c391.e6820c","name":"Automations ON/OFF","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"service\": (msg.payload)? \"turn_off\": \"turn_on\"\n  },\n  \"topic\": \"Automations\"\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"triggered\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":2595,"wires":[["d97ec0c4.fc134","c26b3cf1.ddda"]]},{"id":"d97ec0c4.fc134","type":"api-call-service","z":"cae3de91.cc172","g":"4b19c391.e6820c","name":"Man Cave Kitchen lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_man_cave_kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":860,"y":2580,"wires":[[]]},{"id":"c26b3cf1.ddda","type":"api-call-service","z":"cae3de91.cc172","g":"4b19c391.e6820c","name":"Man Cave: Main lights","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.nodered_man_cave_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":850,"y":2625,"wires":[[]]},{"id":"86e7393c.f3bb68","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Alexa","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"<amazon:effect name='whispered'>I am whispering this.</amazon:effect>\",\"data\":{\"type\":\"announce\",\"method\":\"speak\"},\"target\":[\"media_player.man_cave_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":365,"y":1350,"wires":[[]]},{"id":"6f718575.c04fbc","type":"inject","z":"cf31d5a7.9b9f88","name":"Trigger Notification","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1350,"wires":[["86e7393c.f3bb68"]]},{"id":"d34ef537.a6fea8","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Alexa doorbell chime","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.man_cave_echo_dot","data":"{\"media_content_id\":\"amzn_sfx_doorbell_chime_02\",\"media_content_type\":\"sound\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":1410,"wires":[[]]},{"id":"12ff0af2.172585","type":"inject","z":"cf31d5a7.9b9f88","name":"Trigger Notification","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1410,"wires":[["60856749.2e42c8"]]},{"id":"60856749.2e42c8","type":"api-call-service","z":"cf31d5a7.9b9f88","name":"Set Volume: 1","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.man_cave_echo_dot","data":"{\"volume_level\":1}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":380,"y":1410,"wires":[["ea8f185f.a901d8"]]},{"id":"ea8f185f.a901d8","type":"delay","z":"cf31d5a7.9b9f88","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":555,"y":1410,"wires":[["d34ef537.a6fea8"]]},{"id":"16eca0f9.aef08f","type":"function","z":"841dd090.abafb","name":"Set Payload","func":"// import the script\nconst dateFns = global.get('dateFns');\nconst now = new Date();\nconst nodeStatus = \" at: \" + dateFns.format(now, 'd MMM, HH:mm:ss');\n\nconst message = {\n  payload: {\n    \"data\": {\n      \"entity_id\": msg.data.camera,\n      \"filename\": msg.data.camera_snapshot,\n    }\n  }\n}\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Payload set\" + nodeStatus });\nreturn message;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":525,"wires":[["1a15eb15.a5f205"]]},{"id":"3501b61.7f6a84a","type":"inject","z":"84b86f62.4bafe","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"My Test Topic","payload":"true","payloadType":"bool","x":180,"y":300,"wires":[["968366d1.398998"]]},{"id":"b1e504c5.0faf28","type":"api-call-service","z":"cae3de91.cc172","g":"aabc4094.fa7ea","name":"Light Switches: OFF","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"group.light_switches","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":715,"y":420,"wires":[[]]},{"id":"b2e3385e.c5c168","type":"comment","z":"b715c3d5.53027","name":"Curtains","info":"","x":85,"y":225,"wires":[]},{"id":"54770675.03ff98","type":"bigtimer","z":"b715c3d5.53027","outtopic":"","outpayload1":"","outpayload2":"","name":"Sun Event","comment":"On sunrise and sunset","lat":"-41.168705","lon":"174.818557","starttime":"5003","endtime":"5004","starttime2":0,"endtime2":0,"startoff":0,"endoff":"-30","startoff2":0,"endoff2":0,"offs":0,"outtext1":"open_cover","outtext2":"close_cover","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":true,"atstart":false,"odd":false,"even":false,"x":130,"y":285,"wires":[[],[],["52cedfc2.41b5f"]]},{"id":"c4ba91d3.b30b6","type":"api-call-service","z":"b715c3d5.53027","name":"Log it","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"logbook","service":"log","entityId":"","data":"{\t   \"name\":\"Node-Red\",\t   \"message\": $join([\"dining room curtains:\", $string($.payload)], \" \"),\t   \"domain\":\"logbook\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":650,"y":285,"wires":[["1e3b018a.c2e77e"]]},{"id":"1e3b018a.c2e77e","type":"api-call-service","z":"b715c3d5.53027","name":"Open/Close Curtains","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"cover","service":"{{payload}}","entityId":"cover.dining_room_curtains","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":940,"y":285,"wires":[[]]},{"id":"52cedfc2.41b5f","type":"ha-entity","z":"b715c3d5.53027","name":"NodeRed: Dining Room Curtains","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"NodeRed: Dining Room Curtains"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:blinds"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":390,"y":285,"wires":[["c4ba91d3.b30b6"],[]],"outputLabels":["On","Off"]},{"id":"285f50d6.1f433","type":"inject","z":"b715c3d5.53027","name":"open_cover","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Dining Room Curtains","payload":"open_cover","payloadType":"str","x":130,"y":360,"wires":[["52cedfc2.41b5f"]]},{"id":"63cec984.84d3a8","type":"inject","z":"b715c3d5.53027","name":"close_cover","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Dining Room Curtains","payload":"close_cover","payloadType":"str","x":130,"y":405,"wires":[["52cedfc2.41b5f"]]},{"id":"968366d1.398998","type":"api-call-service","z":"84b86f62.4bafe","name":"Log it","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"logbook","service":"log","entityId":"","data":"{\t   \"name\":\"Node-Red\",\t   \"message\": $join([$.topic,\"Payload:\", $string($.payload)], \" \"),\t   \"domain\":\"logbook\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":440,"y":300,"wires":[[]]},{"id":"ca642530.df9528","type":"comment","z":"827aa7bb.e776e8","name":"Curtains","info":"","x":75,"y":420,"wires":[]},{"id":"6f1e8146.3ce96","type":"bigtimer","z":"827aa7bb.e776e8","outtopic":"","outpayload1":"","outpayload2":"","name":"Sun Event","comment":"On sunrise and sunset","lat":"-41.168705","lon":"174.818557","starttime":"5003","endtime":"5004","starttime2":0,"endtime2":0,"startoff":0,"endoff":"-30","startoff2":0,"endoff2":0,"offs":0,"outtext1":"open_cover","outtext2":"close_cover","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":true,"atstart":false,"odd":false,"even":false,"x":115,"y":480,"wires":[[],[],["657c8f9e.cdf3f"]]},{"id":"20f6d4f.e927c2c","type":"api-call-service","z":"827aa7bb.e776e8","name":"Log it","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"logbook","service":"log","entityId":"","data":"{\t   \"name\":\"Node-Red\",\t   \"message\": $join([\"dining room curtains:\", $string($.payload)], \" \"),\t   \"domain\":\"logbook\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":640,"y":480,"wires":[["a86a0f8b.4f4"]]},{"id":"a86a0f8b.4f4","type":"api-call-service","z":"827aa7bb.e776e8","name":"Open/Close Curtains","server":"d2144d44.18e","version":1,"debugenabled":false,"service_domain":"cover","service":"{{payload}}","entityId":"cover.living_room_sliding_door_curtain","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":480,"wires":[[]]},{"id":"657c8f9e.cdf3f","type":"ha-entity","z":"827aa7bb.e776e8","name":"NodeRed: Living Room Curtains","server":"d2144d44.18e","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"NodeRed: Living Room Curtains"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:blinds"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":370,"y":480,"wires":[["20f6d4f.e927c2c"],[]],"outputLabels":["On","Off"]},{"id":"f2ebb85.618b448","type":"inject","z":"827aa7bb.e776e8","name":"open_cover","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Dining Room Curtains","payload":"open_cover","payloadType":"str","x":115,"y":540,"wires":[["657c8f9e.cdf3f"]]},{"id":"fb55bf22.14266","type":"inject","z":"827aa7bb.e776e8","name":"close_cover","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Dining Room Curtains","payload":"close_cover","payloadType":"str","x":115,"y":585,"wires":[["657c8f9e.cdf3f"]]}]
